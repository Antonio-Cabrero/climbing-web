(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{280:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=n(1),o=g(l),r=(n(68),n(133)),i=g(n(99)),s=n(131),u=n(303),d=g(n(461)),c=g(n(459)),f=g(n(311)),h=g(n(98)),m=g(n(134)),p=g(n(340)),y=g(n(101));function g(e){return e&&e.__esModule?e:{default:e}}n(100);var b=(0,u.withGoogleMap)(function(e){return o.default.createElement(u.GoogleMap,{defaultZoom:e.defaultZoom,defaultCenter:e.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN,onClick:e.onClick.bind(void 0)},e.markers)}),v=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;document.title=h.default.getTitle()+" | Problem edit",i.default.get(h.default.getUrl("grades?regionId="+h.default.getRegion())).end(function(t,n){e.setState({error:t||null,grades:t?null:n.body})}),i.default.get(h.default.getUrl("types?regionId="+h.default.getRegion())).end(function(t,n){e.setState({error:t||null,types:t?null:n.body})}),-1==this.props.match.params.problemId?this.setState({id:-1,visibility:0,name:"",comment:"",originalGrade:"n/a",fa:[],faDate:h.default.convertFromDateToString(new Date),nr:this.props.location.query.nr,lat:0,lng:0,newMedia:[]}):i.default.get(h.default.getUrl("problems?regionId="+h.default.getRegion()+"&id="+this.props.match.params.problemId)).withCredentials().end(function(t,n){t?e.setState({error:t}):e.setState({id:n.body[0].id,visibility:n.body[0].visibility,name:n.body[0].name,comment:n.body[0].comment,originalGrade:n.body[0].originalGrade,fa:n.body[0].fa,faDate:n.body[0].faDate,nr:n.body[0].nr,typeId:n.body[0].t.id,lat:n.body[0].lat,lng:n.body[0].lng,newMedia:[]})})}},{key:"onNameChanged",value:function(e){this.setState({name:e.target.value})}},{key:"onNrChanged",value:function(e){this.setState({nr:parseInt(e.target.value)})}},{key:"onLatChanged",value:function(e){this.setState({lat:parseFloat(e.target.value)})}},{key:"onLngChanged",value:function(e){this.setState({lng:parseFloat(e.target.value)})}},{key:"onVisibilityChanged",value:function(e,t){this.setState({visibility:e})}},{key:"onCommentChanged",value:function(e){this.setState({comment:e.target.value})}},{key:"onFaDateChanged",value:function(e){this.setState({faDate:e})}},{key:"onOriginalGradeChanged",value:function(e,t){this.setState({originalGrade:e})}},{key:"onTypeIdChanged",value:function(e,t){this.setState({typeId:e})}},{key:"onNewMediaChanged",value:function(e){this.setState({newMedia:e})}},{key:"save",value:function(e){var t=this;e.preventDefault(),this.setState({isSaving:!0});var n=this.state.newMedia.map(function(e){return{name:e.file.name.replace(/[^-a-z0-9.]/gi,"_"),photographer:e.photographer,inPhoto:e.inPhoto}}),a=i.default.post(h.default.getUrl("problems?regionId="+h.default.getRegion())).withCredentials().field("json",JSON.stringify({sectorId:this.props.location.query.idSector,id:this.state.id,visibility:this.state.visibility,name:this.state.name,comment:this.state.comment,originalGrade:this.state.originalGrade,fa:this.state.fa,faDate:this.state.faDate,nr:this.state.nr,t:this.state.typeId?this.state.types.find(function(e){return e.id===t.state.typeId}):this.state.types[0],lat:this.state.lat,lng:this.state.lng,newMedia:n})).set("Accept","application/json");this.state.newMedia.forEach(function(e){return a.attach(e.file.name.replace(/[^-a-z0-9.]/gi,"_"),e.file)}),a.end(function(e,n){e?t.setState({error:e}):t.setState({pushUrl:"/problem/"+n.body.id})})}},{key:"onMapClick",value:function(e){this.setState({lat:e.latLng.lat(),lng:e.latLng.lng()})}},{key:"onUsersUpdated",value:function(e){var t=e.map(function(e){return{id:"string"==typeof e.value||e.value instanceof String?-1:e.value,firstname:e.label,surname:null}});this.setState({fa:t})}},{key:"onCancel",value:function(){window.history.back()}},{key:"render",value:function(){var e=this;if(!(this.state&&this.state.id&&this.state.types&&this.state.grades))return o.default.createElement("center",null,o.default.createElement(y.default,{icon:"spinner",spin:!0,size:"3x"}));if(this.state.error)return o.default.createElement("span",null,o.default.createElement("h3",null,this.state.error.status),this.state.error.toString());if(this.state.pushUrl)return o.default.createElement(r.Redirect,{to:this.state.pushUrl,push:!0});var t=new Date;t.setDate(t.getDate()-1);var n="Visible for everyone";1===this.state.visibility?n="Only visible for administrators":2===this.state.visibility&&(n="Only visible for super administrators");var a,l,i=this.state.typeId?this.state.types.find(function(t){return t.id===e.state.typeId}):this.state.types[0];return 0!=this.state.lat&&0!=this.state.lng?(a={lat:this.state.lat,lng:this.state.lng},l=15):this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?(a={lat:parseFloat(this.props.location.query.lat),lng:parseFloat(this.props.location.query.lng)},l=14):(a=h.default.getDefaultCenter(),l=h.default.getDefaultZoom()),o.default.createElement(s.Well,null,o.default.createElement("form",{onSubmit:this.save.bind(this)},o.default.createElement(s.FormGroup,{controlId:"formControlsName"},o.default.createElement(s.ControlLabel,null,"Problem name"),o.default.createElement(s.FormControl,{type:"text",value:this.state.name,placeholder:"Enter name",onChange:this.onNameChanged.bind(this)})),o.default.createElement(s.FormGroup,{controlId:"formControlsFaDate"},o.default.createElement(s.ControlLabel,null,"FA date (yyyy-mm-dd)"),o.default.createElement("br",null),o.default.createElement(p.default,{format:"YYYY-MM-DD",computableFormat:"YYYY-MM-DD",date:this.state.faDate,onChange:this.onFaDateChanged.bind(this)}),o.default.createElement(s.ButtonGroup,null,o.default.createElement(s.Button,{onClick:this.onFaDateChanged.bind(this,h.default.convertFromDateToString(t))},"Yesterday"),o.default.createElement(s.Button,{onClick:this.onFaDateChanged.bind(this,h.default.convertFromDateToString(new Date))},"Today"))),o.default.createElement(s.FormGroup,{controlId:"formControlsTypeId"},o.default.createElement(s.ControlLabel,null,"Type"),o.default.createElement("br",null),o.default.createElement(s.DropdownButton,{title:i.type+(i.subType?" - "+i.subType:""),id:"bg-nested-dropdown"},this.state.types.map(function(t,n){return o.default.createElement(s.MenuItem,{key:n,eventKey:n,onSelect:e.onTypeIdChanged.bind(e,t.id)},t.type," ",t.subType?" - "+t.subType:"")}))),o.default.createElement(s.FormGroup,{controlId:"formControlsGrade"},o.default.createElement(s.ControlLabel,null,"Grade"),o.default.createElement("br",null),o.default.createElement(s.DropdownButton,{title:this.state.originalGrade,id:"bg-nested-dropdown"},this.state.grades.map(function(t,n){return o.default.createElement(s.MenuItem,{key:n,eventKey:n,onSelect:e.onOriginalGradeChanged.bind(e,t.grade)},t.grade)}))),o.default.createElement(s.FormGroup,{controlId:"formControlsFA"},o.default.createElement(s.ControlLabel,null,"FA"),o.default.createElement("br",null),o.default.createElement(d.default,{users:this.state.fa?this.state.fa.map(function(e){return{value:e.id,label:e.firstname+" "+e.surname}}):[],onUsersUpdated:this.onUsersUpdated.bind(this)})),o.default.createElement(s.FormGroup,{controlId:"formControlsVisibility"},o.default.createElement(s.ControlLabel,null,"Visibility"),o.default.createElement("br",null),o.default.createElement(s.DropdownButton,{title:n,id:"bg-nested-dropdown"},o.default.createElement(s.MenuItem,{eventKey:"0",onSelect:this.onVisibilityChanged.bind(this,0)},"Visible for everyone"),o.default.createElement(s.MenuItem,{eventKey:"1",onSelect:this.onVisibilityChanged.bind(this,1)},"Only visible for administrators"),m.default.isSuperAdmin()&&o.default.createElement(s.MenuItem,{eventKey:"2",onSelect:this.onVisibilityChanged.bind(this,2)},"Only visible for super administrators"))),o.default.createElement(s.FormGroup,{controlId:"formControlsSectorNr"},o.default.createElement(s.ControlLabel,null,"Sector number"),o.default.createElement(s.FormControl,{type:"text",value:this.state.nr,placeholder:"Enter sector number",onChange:this.onNrChanged.bind(this)})),o.default.createElement(s.FormGroup,{controlId:"formControlsComment"},o.default.createElement(s.ControlLabel,null,"Comment"),o.default.createElement(s.FormControl,{style:{height:"100px"},componentClass:"textarea",placeholder:"Enter comment",value:this.state.comment,onChange:this.onCommentChanged.bind(this)})),o.default.createElement(s.FormGroup,{controlId:"formControlsSections"},o.default.createElement(s.ControlLabel,null,"Sections"),o.default.createElement("br",null),o.default.createElement(c.default,{sections:this.state.sections})),o.default.createElement(s.FormGroup,{controlId:"formControlsMedia"},o.default.createElement(f.default,{onMediaChanged:this.onNewMediaChanged.bind(this)})),o.default.createElement(s.FormGroup,{controlId:"formControlsMap"},o.default.createElement(s.ControlLabel,null,"Click to mark problem on map"),o.default.createElement("br",null),o.default.createElement("section",{style:{height:"600px"}},o.default.createElement(b,{containerElement:o.default.createElement("div",{style:{height:"100%"}}),mapElement:o.default.createElement("div",{style:{height:"100%"}}),defaultZoom:l,defaultCenter:a,onClick:this.onMapClick.bind(this),markers:0!=this.state.lat&&0!=this.state.lng?o.default.createElement(u.Marker,{position:{lat:this.state.lat,lng:this.state.lng}}):""})),o.default.createElement(s.ControlLabel,null,"Latitude"),o.default.createElement(s.FormControl,{type:"text",value:this.state.lat,placeholder:"Latitude",onChange:this.onLatChanged.bind(this)}),o.default.createElement(s.ControlLabel,null,"Longitude"),o.default.createElement(s.FormControl,{type:"text",value:this.state.lng,placeholder:"Longitude",onChange:this.onLngChanged.bind(this)})),o.default.createElement(s.ButtonGroup,null,o.default.createElement(s.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),o.default.createElement(s.Button,{type:"submit",bsStyle:"success",disabled:this.state.isSaving},this.state.isSaving?"Saving...":"Save problem"))))}}]),t}();t.default=v},311:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=n(1),o=d(l),r=d(n(304)),i=d(n(99)),s=n(131),u=d(n(98));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e){function t(e){c(this,t);var n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchResults:[],value:""},n}return h(t,l.Component),a(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({value:e.value})}},{key:"inputChange",value:function(e){var t=this,n=e.target.value;this.props.onValueChanged(this.props.m,n),n.length>0?i.default.get(u.default.getUrl("users/search?value="+n)).withCredentials().end(function(e,a){e&&console.log(e);var l=a.body.filter(function(e){return e.name.toUpperCase()!==n.toUpperCase()});t.setState({searchResults:l})}):this.setState({searchResults:[]})}},{key:"menuItemSelect",value:function(e,t){this.setState({searchResults:[]}),this.props.onValueChanged(this.props.m,e.name)}},{key:"render",value:function(){var e=this,t=null;if(this.state.searchResults.length>0){var n=this.state.searchResults.map(function(t,n){return o.default.createElement(s.MenuItem,{key:n,href:"#",onSelect:e.menuItemSelect.bind(e,t)},t.name)});t=o.default.createElement("div",null,o.default.createElement("ul",{className:"dropdown-menu open",style:{position:"absolute",display:"inline"}},n))}return o.default.createElement("div",{style:{position:"relative",width:"100%"}},o.default.createElement("div",{style:{width:"100%"}},o.default.createElement(s.FormControl,{style:{display:"inline-block"},type:"text",placeholder:this.props.placeholder,value:this.state.value,onChange:this.inputChange.bind(this)})),t)}}]),t}(),p=function(e){function t(e){c(this,t);var n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={media:[]},n}return h(t,l.Component),a(t,[{key:"onDrop",value:function(e){var t=this.state.media;e.forEach(function(e){return t.push({file:e})}),this.setState({media:t}),this.props.onMediaChanged(t)}},{key:"onPhotographerChanged",value:function(e,t){e.photographer=t,this.props.onMediaChanged(this.state.media)}},{key:"onInPhotoChanged",value:function(e,t){e.inPhoto=t,this.props.onMediaChanged(this.state.media)}},{key:"onRemove",value:function(e){var t=this.state.media.filter(function(t){return t!=e});this.setState({media:t}),this.props.onMediaChanged(t)}},{key:"render",value:function(){var e=this;return o.default.createElement(s.FormGroup,null,o.default.createElement(s.ControlLabel,null,"Upload image(s)"),o.default.createElement("br",null),o.default.createElement(r.default,{onDrop:this.onDrop.bind(this),style:{width:"220px",height:"75px",padding:"15px",borderWidth:"1px",borderColor:"#666",borderStyle:"dashed",borderRadius:"5px"},accept:"image/*"},o.default.createElement("i",null,"Drop JPG-image(s) here or click to select files to upload.")),this.state.media.length>0?o.default.createElement(s.Grid,null,o.default.createElement(s.Row,null,this.state.media.map(function(t,n){return o.default.createElement(s.Col,{key:n,xs:8,sm:6,md:4,lg:2},o.default.createElement(s.Thumbnail,{src:t.file.preview},o.default.createElement(m,{m:t,placeholder:"In photo",value:t?t.inPhoto:"",onValueChanged:e.onInPhotoChanged.bind(e)}),o.default.createElement(m,{m:t,placeholder:"Photographer",value:t?t.photographer:"",onValueChanged:e.onPhotographerChanged.bind(e)}),o.default.createElement(s.Button,{style:{width:"100%"},bsStyle:"danger",onClick:e.onRemove.bind(e,t)},"Remove")))}))):null)}}]),t}();t.default=p},459:function(e,t,n){"use strict";var a=i(n(1)),l=i(n(414)),o=i(n(0)),r=n(131);function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,l.default)({displayName:"ProblemSection",propTypes:{label:o.default.string},getInitialState:function(){return{sections:this.props.sections,numberOfSections:this.props.sections?this.props.sections.length:1}},render:function(){return a.default.createElement(r.Well,null,a.default.createElement(r.FormGroup,{controlId:"formControlsSections"},a.default.createElement(r.ControlLabel,null,"Sections"),a.default.createElement(r.DropdownButton,{title:this.state.numberOfSections,id:"bg-nested-dropdown"},a.default.createElement(r.MenuItem,{key:1,eventKey:1,onSelect:this.onNumberOfSectionsChange.bind(this,1)},"1"),a.default.createElement(r.MenuItem,{key:2,eventKey:2,onSelect:this.onNumberOfSectionsChange.bind(this,2)},"2"),a.default.createElement(r.MenuItem,{key:3,eventKey:3,onSelect:this.onNumberOfSectionsChange.bind(this,3)},"3"),a.default.createElement(r.MenuItem,{key:4,eventKey:4,onSelect:this.onNumberOfSectionsChange.bind(this,4)},"4"),a.default.createElement(r.MenuItem,{key:5,eventKey:5,onSelect:this.onNumberOfSectionsChange.bind(this,5)},"5"),a.default.createElement(r.MenuItem,{key:6,eventKey:6,onSelect:this.onNumberOfSectionsChange.bind(this,6)},"6"),a.default.createElement(r.MenuItem,{key:7,eventKey:7,onSelect:this.onNumberOfSectionsChange.bind(this,7)},"7"),a.default.createElement(r.MenuItem,{key:8,eventKey:8,onSelect:this.onNumberOfSectionsChange.bind(this,8)},"8"),a.default.createElement(r.MenuItem,{key:9,eventKey:9,onSelect:this.onNumberOfSectionsChange.bind(this,9)},"9"),a.default.createElement(r.MenuItem,{key:10,eventKey:10,onSelect:this.onNumberOfSectionsChange.bind(this,10)},"10"))))}});e.exports=s},461:function(e,t,n){"use strict";var a=u(n(1)),l=u(n(414)),o=u(n(0)),r=u(n(140)),i=u(n(99)),s=u(n(98));function u(e){return e&&e.__esModule?e:{default:e}}var d=(0,l.default)({displayName:"UserSelector",propTypes:{label:o.default.string},getInitialState:function(){var e=this;return i.default.get(s.default.getUrl("users/search?value=")).withCredentials().end(function(t,n){t?console.log(t):e.setState({options:n.body.map(function(e){return{value:e.id,label:e.name}})})}),{multiValue:this.props.users,options:[]}},handleOnChange:function(e){this.props.onUsersUpdated(e),this.setState({multiValue:e})},render:function(){return a.default.createElement("div",{style:{position:"relative",width:"100%"}},a.default.createElement("div",{style:{width:"100%"}},a.default.createElement(r.default.Creatable,{multi:!0,options:this.state.options,onChange:this.handleOnChange,value:this.state.multiValue})))}});e.exports=d}}]);
//# sourceMappingURL=15.index.js.map