(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{611:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=a(1),n=p(l),i=p(a(617)),o=a(132),u=a(260),d=p(a(190)),s=p(a(632)),c=a(257),f=a(674),m=p(a(189)),h=p(a(192));function p(e){return e&&e.__esModule?e:{default:e}}a(191);var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={tabIndex:1,currLat:0,currLng:0},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),r(t,[{key:"toRad",value:function(e){return e*Math.PI/180}},{key:"calcCrow",value:function(e,t,a,r){var l=this.toRad(a-e),n=this.toRad(r-t),i=(e=this.toRad(e),a=this.toRad(a),Math.sin(l/2)*Math.sin(l/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(e)*Math.cos(a));return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}},{key:"refresh",value:function(e){var t=this;d.default.get(m.default.getUrl("problems?regionId="+m.default.getRegion()+"&grade="+e)).withCredentials().end(function(e,a){e?t.setState({error:e}):t.setState({problems:a.body})})}},{key:"componentDidMount",value:function(){var e=this;this.refresh(this.props.match.params.grade),navigator.geolocation.getCurrentPosition(function(t){e.setState({currLat:t.coords.latitude,currLng:t.coords.longitude})})}},{key:"componentWillReceiveProps",value:function(e){this.refresh(e.match.params.grade)}},{key:"handleTabsSelection",value:function(e){this.setState({tabIndex:e})}},{key:"trClassFormat",value:function(e,t){return e.ticked?"success":""}},{key:"formatAreaName",value:function(e,t){return n.default.createElement("span",null,n.default.createElement(o.Link,{to:"/area/"+t.areaId},t.areaName)," ",1===t.areaVisibility&&n.default.createElement(h.default,{icon:"lock"}),2===t.areaVisibility&&n.default.createElement(h.default,{icon:"user-secret"}))}},{key:"formatSectorName",value:function(e,t){return n.default.createElement("span",null,n.default.createElement(o.Link,{to:"/sector/"+t.sectorId},t.sectorName)," ",1===t.sectorVisibility&&n.default.createElement(h.default,{icon:"lock"}),2===t.sectorVisibility&&n.default.createElement(h.default,{icon:"user-secret"}))}},{key:"formatName",value:function(e,t){return n.default.createElement("span",null,n.default.createElement(o.Link,{to:"/problem/"+t.id},t.name)," ",1===t.visibility&&n.default.createElement(h.default,{icon:"lock"}),2===t.visibility&&n.default.createElement(h.default,{icon:"user-secret"}))}},{key:"formatType",value:function(e,t){var a;switch(t.t.id){case 2:a=n.default.createElement("img",{height:"20",src:"/jpg/bolt.jpg",alt:"Bolt"});break;case 3:a=n.default.createElement("img",{height:"20",src:"/jpg/trad.jpg",alt:"Trad"});break;case 4:a=n.default.createElement("img",{height:"20",src:"/jpg/mixed.jpg",alt:"Mixed"})}return n.default.createElement(c.OverlayTrigger,{placement:"top",overlay:n.default.createElement(c.Popover,{id:t.t.id,title:"Type"}," ",t.t.type+" - "+t.t.subType)},a)}},{key:"formatFa",value:function(e,t){var a=t.fa?t.fa.map(function(e,t){var a=n.default.createElement(c.Tooltip,{id:t},e.firstname," ",e.surname);return n.default.createElement(c.OverlayTrigger,{key:t,placement:"top",overlay:a},n.default.createElement(u.LinkContainer,{key:t,to:"/user/"+e.id},n.default.createElement(c.Button,{key:t,bsStyle:"default"},e.initials)))}):[];return n.default.createElement(c.ButtonToolbar,null,n.default.createElement(c.ButtonGroup,{bsSize:"xsmall"},a))}},{key:"formatStars",value:function(e,t){var a=null;if(.5===t.stars)a=n.default.createElement(h.default,{icon:"star-half"});else if(1===t.stars)a=n.default.createElement("div",{style:{whiteSpace:"nowrap"},id:2},n.default.createElement(h.default,{icon:"star"}));else if(1.5===t.stars)a=n.default.createElement("div",{style:{whiteSpace:"nowrap"},id:3},n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star-half"}));else if(2===t.stars)a=n.default.createElement("div",{style:{whiteSpace:"nowrap"},id:4},n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"}));else if(2.5===t.stars)a=n.default.createElement("div",{style:{whiteSpace:"nowrap"},id:5},n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star-half"}));else{if(3!==t.stars)return"";a=n.default.createElement("div",{style:{whiteSpace:"nowrap"},id:6},n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"}))}return n.default.createElement(c.OverlayTrigger,{placement:"top",overlay:n.default.createElement(c.Popover,{id:0,title:"Guidelines"},n.default.createElement(h.default,{icon:"star"})," Nice",n.default.createElement("br",null),n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"})," Very nice",n.default.createElement("br",null),n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"}),n.default.createElement(h.default,{icon:"star"})," Fantastic!")},a)}},{key:"formatNumImages",value:function(e,t){return t.media?t.media.filter(function(e){return 1===e.idType}).length:0}},{key:"formatNumMovies",value:function(e,t){return t.media?t.media.filter(function(e){return 2===e.idType}).length:0}},{key:"formatDistance",value:function(e,t){return this.state.currLat>0&&this.state.currLng>0&&t.lat>0&&t.lng>0?this.calcCrow(this.state.currLat,this.state.currLng,t.lat,t.lng).toFixed(1)+" km":""}},{key:"sortFa",value:function(e,t,a){var r=e.fa?e.fa[0].initials:"",l=t.fa?t.fa[0].initials:"";return"asc"===a?r.localeCompare(l):l.localeCompare(r)}},{key:"sortNumImages",value:function(e,t,a){var r=e.media?e.media.filter(function(e){return 1===e.idType}).length:0,l=t.media?t.media.filter(function(e){return 1===e.idType}).length:0;return"asc"===a?r<l?-1:r>l?1:0:r<l?1:r>l?-1:0}},{key:"sortNumMovies",value:function(e,t,a){var r=e.media?e.media.filter(function(e){return 2===e.idType}).length:0,l=t.media?t.media.filter(function(e){return 2===e.idType}).length:0;return"asc"===a?r<l?-1:r>l?1:0:r<l?1:r>l?-1:0}},{key:"sortDistance",value:function(e,t,a){var r=this.state.currLat>0&&this.state.currLng>0&&e.lat>0&&e.lng>0?this.calcCrow(this.state.currLat,this.state.currLng,e.lat,e.lng):0,l=this.state.currLat>0&&this.state.currLng>0&&t.lat>0&&t.lng>0?this.calcCrow(this.state.currLat,this.state.currLng,t.lat,t.lng):0;return"asc"===a?r<l?-1:r>l?1:0:r<l?1:r>l?-1:0}},{key:"render",value:function(){if(!this.state.problems)return n.default.createElement("center",null,n.default.createElement(h.default,{icon:"spinner",spin:!0,size:"3x"}));if(this.state.error)return n.default.createElement("span",null,n.default.createElement("h3",null,this.state.error.status),this.state.error.toString());var e,t=this.state.problems.filter(function(e){return 0!=e.lat&&0!=e.lng}).map(function(e){return{lat:e.lat,lng:e.lng,title:e.nr+" - "+e.name+" ["+e.grade+"]",label:e.name.charAt(0),url:"/problem/"+e.id,icon:{url:e.ticked?"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-a.png":"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-b.png",labelOrigin:new google.maps.Point(11,13)}}}),a=t.length>0?n.default.createElement(s.default,{markers:t,defaultCenter:m.default.getDefaultCenter(),defaultZoom:7}):null;return e=m.default.isBouldering()?n.default.createElement(f.BootstrapTable,{data:this.state.problems,trClassName:this.trClassFormat.bind(this),condensed:!0,hover:!0,columnFilter:!1},n.default.createElement(f.TableHeaderColumn,{dataField:"id",isKey:!0,hidden:!0},"id"),n.default.createElement(f.TableHeaderColumn,{dataField:"areaName",dataSort:!0,dataFormat:this.formatAreaName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Area"),n.default.createElement(f.TableHeaderColumn,{dataField:"sectorName",dataSort:!0,dataFormat:this.formatSectorName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Sector"),n.default.createElement(f.TableHeaderColumn,{dataField:"name",dataSort:!0,dataFormat:this.formatName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Name"),n.default.createElement(f.TableHeaderColumn,{dataField:"grade",dataSort:!0,dataAlign:"center",width:"70"},"Grade"),n.default.createElement(f.TableHeaderColumn,{dataField:"fa",dataSort:!0,dataFormat:this.formatFa.bind(this),sortFunc:this.sortFa.bind(this),dataAlign:"center",width:"70"},"FA"),n.default.createElement(f.TableHeaderColumn,{dataField:"numTicks",dataSort:!0,dataAlign:"center",width:"50"},"Ticks"),n.default.createElement(f.TableHeaderColumn,{dataField:"stars",dataSort:!0,dataFormat:this.formatStars.bind(this),dataAlign:"center",width:"70"},"Stars"),n.default.createElement(f.TableHeaderColumn,{dataField:"numImages",dataSort:!0,dataFormat:this.formatNumImages.bind(this),sortFunc:this.sortNumImages.bind(this),dataAlign:"center",width:"50"},n.default.createElement(h.default,{icon:"camera"})),n.default.createElement(f.TableHeaderColumn,{dataField:"numMovies",dataSort:!0,dataFormat:this.formatNumMovies.bind(this),sortFunc:this.sortNumMovies.bind(this),dataAlign:"center",width:"50"},n.default.createElement(h.default,{icon:"video"})),n.default.createElement(f.TableHeaderColumn,{dataField:"distance",dataSort:!0,dataFormat:this.formatDistance.bind(this),sortFunc:this.sortDistance.bind(this),dataAlign:"center",width:"60"},n.default.createElement(h.default,{icon:"plane"}))):n.default.createElement(f.BootstrapTable,{data:this.state.problems,trClassName:this.trClassFormat.bind(this),condensed:!0,hover:!0,columnFilter:!1},n.default.createElement(f.TableHeaderColumn,{dataField:"id",isKey:!0,hidden:!0},"id"),n.default.createElement(f.TableHeaderColumn,{dataField:"areaName",dataSort:!0,dataFormat:this.formatAreaName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Area"),n.default.createElement(f.TableHeaderColumn,{dataField:"sectorName",dataSort:!0,dataFormat:this.formatSectorName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Sector"),n.default.createElement(f.TableHeaderColumn,{dataField:"name",dataSort:!0,dataFormat:this.formatName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Name"),n.default.createElement(f.TableHeaderColumn,{dataField:"type",dataFormat:this.formatType.bind(this),dataAlign:"center",width:"70"},"Type"),n.default.createElement(f.TableHeaderColumn,{dataField:"grade",dataSort:!0,dataAlign:"center",width:"70"},"Grade"),n.default.createElement(f.TableHeaderColumn,{dataField:"fa",dataSort:!0,dataFormat:this.formatFa.bind(this),sortFunc:this.sortFa.bind(this),dataAlign:"center",width:"70"},"FA"),n.default.createElement(f.TableHeaderColumn,{dataField:"numTicks",dataSort:!0,dataAlign:"center",width:"50"},"Ticks"),n.default.createElement(f.TableHeaderColumn,{dataField:"stars",dataSort:!0,dataFormat:this.formatStars.bind(this),dataAlign:"center",width:"70"},"Stars"),n.default.createElement(f.TableHeaderColumn,{dataField:"numImages",dataSort:!0,dataFormat:this.formatNumImages.bind(this),sortFunc:this.sortNumImages.bind(this),dataAlign:"center",width:"50"},n.default.createElement(h.default,{icon:"camera"})),n.default.createElement(f.TableHeaderColumn,{dataField:"numMovies",dataSort:!0,dataFormat:this.formatNumMovies.bind(this),sortFunc:this.sortNumMovies.bind(this),dataAlign:"center",width:"50"},n.default.createElement(h.default,{icon:"video"}))),n.default.createElement("span",null,n.default.createElement(i.default,null,n.default.createElement("title",null,m.default.getTitle("Finder")),n.default.createElement("meta",{name:"description",content:m.default.getMetaDescription("Search by difficulty")})),n.default.createElement(c.Breadcrumb,null,n.default.createElement(o.Link,{to:"/"},"Home")," / ",n.default.createElement("font",{color:"#777"},"Finder (problems: ",this.state.problems.length,")")),a,e)}}]),t}();t.default=g},632:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=a(1),n=d(l),i=a(258),o=a(633),u=d(a(643));function d(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return navigator.geolocation.getCurrentPosition(function(e){a.setState({currLat:e.coords.latitude,currLng:e.coords.longitude})}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.Component),r(t,[{key:"handleOnClick",value:function(e){this.setState({pushUrl:e})}},{key:"render",value:function(){var e=this;if(this.state&&this.state.pushUrl)return n.default.createElement(i.Redirect,{to:this.state.pushUrl,push:!0});var t=null;this.props.markers&&(t=this.props.markers.map(function(t,a){return n.default.createElement(o.Marker,{icon:t.icon,key:a,position:{lat:t.lat,lng:t.lng},label:t.label,title:t.title,clickable:!0,onClick:e.handleOnClick.bind(e,t.url)})})),this.state&&this.state.currLat&&this.state.currLng&&this.state.currLat>0&&this.state.currLng>0&&t.push(n.default.createElement(o.Marker,{key:-1,icon:"https://maps.gstatic.com/mapfiles/markers2/measle_blue.png",position:{lat:this.state.currLat,lng:this.state.currLng}}));var a=null;this.props.polygons&&(a=this.props.polygons.map(function(t,a){return n.default.createElement(o.Polygon,{key:a,paths:t.triangleCoords,options:{strokeColor:"#FF3300",strokeOpacity:"0.5",strokeWeight:"2",fillColor:"#FF3300",fillOpacity:"0.15"},onClick:e.handleOnClick.bind(e,t.url)})}));var r=(0,o.withGoogleMap)(function(r){return n.default.createElement(o.GoogleMap,{defaultZoom:e.props.defaultZoom,defaultCenter:e.props.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN},n.default.createElement(u.default,{averageCenter:!1,minimumClusterSize:60,enableRetinaIcons:!1,imagePath:"https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m",gridSize:60},t,a))});return n.default.createElement("section",{style:{height:"600px"}},n.default.createElement(r,{containerElement:n.default.createElement("div",{style:{height:"100%"}}),mapElement:n.default.createElement("div",{style:{height:"100%"}})}))}}]),t}();t.default=s}}]);
//# sourceMappingURL=21.index.js.map