{"version":3,"sources":["webpack:///./app/components/Area.js"],"names":["_react","__webpack_require__","r","h","l","_reactRouterDom","o","_reactBootstrap","_reactRouterBootstrap","c","d","m","f","p","e","__esModule","default","b","t","TypeError","y","ReferenceError","E","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","TableRow","comment","this","props","sector","length","tooltip","_react2","createElement","Tooltip","id","OverlayTrigger","key","placement","overlay","substring","Link","to","name","visibility","_reactFontawesome2","icon","numProblems","Area","_classCallCheck","_this2","_possibleConstructorReturn","getPrototypeOf","call","state","tabIndex","_this3","_superagent2","get","_config2","getUrl","match","params","areaId","withCredentials","end","err","res","setState","error","body","media","lat","lng","sectors","document","title","getTitle","idMediaToRemove","allMedia","filter","spin","size","status","toString","rows","map","i","markers","s","url","scaledSize","google","maps","Size","polygons","polygonCoords","triangleCoords","split","latLng","parseFloat","defaultCenter","getDefaultCenter","defaultZoom","getDefaultZoom","_map2","gallery","_gallery2","showThumbnails","removeMedia","onRemoveMedia","bind","topoContent","Tabs","activeKey","animation","onSelect","handleTabsSelection","unmountOnExit","Tab","eventKey","Breadcrumb","_auth2","isAdmin","style","float","ButtonGroup","LinkContainer","pathname","query","idArea","Button","bsStyle","bsSize","inverse","color","Well","dangerouslySetInnerHTML","__html","Table","striped","condensed","hover"],"mappings":"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","file":"0.index.js","sourcesContent":["import React, {Component} from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport Request from 'superagent';\r\nimport { Tabs, Tab, Well, OverlayTrigger, Tooltip, ButtonGroup, Button, Table, Breadcrumb } from 'react-bootstrap';\r\nimport { LinkContainer } from 'react-router-bootstrap';\r\nimport Map from './common/map/map';\r\nimport Gallery from './common/gallery/gallery';\r\nimport auth from '../utils/auth.js';\r\nimport config from '../utils/config.js';\r\nimport FontAwesomeIcon from '@fortawesome/react-fontawesome';\r\nimport { faSpinner, faLock, faUserSecret, faPlusSquare, faEdit } from '@fortawesome/fontawesome-free-solid';\r\n\r\nclass TableRow extends Component {\r\n  render() {\r\n    var comment = \"\";\r\n    if (this.props.sector.comment) {\r\n      if (this.props.sector.comment.length>100) {\r\n        const tooltip = (<Tooltip id={this.props.sector.id}>{this.props.sector.comment}</Tooltip>);\r\n        comment = <OverlayTrigger key={this.props.sector.id} placement=\"top\" overlay={tooltip}><span>{this.props.sector.comment.substring(0,100) + \"...\"}</span></OverlayTrigger>;\r\n      } else {\r\n        comment = this.props.sector.comment;\r\n      }\r\n    }\r\n    return (\r\n      <tr>\r\n        <td><Link to={`/sector/${this.props.sector.id}`}>{this.props.sector.name}</Link> {this.props.sector.visibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.props.sector.visibility===2 && <FontAwesomeIcon icon=\"user-secret\" />}</td>\r\n        <td>{comment}</td>\r\n        <td>{this.props.sector.numProblems}</td>\r\n      </tr>\r\n    )\r\n  }\r\n}\r\n\r\nexport default class Area extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      tabIndex: 1\r\n    };\r\n  }\r\n  componentDidMount() {\r\n    Request.get(config.getUrl(\"areas?id=\" + this.props.match.params.areaId)).withCredentials().end((err, res) => {\r\n      if (err) {\r\n        this.setState({error: err});\r\n      } else {\r\n        this.setState({\r\n          id: res.body.id,\r\n          visibility: res.body.visibility,\r\n          name: res.body.name,\r\n          media: res.body.media,\r\n          comment: res.body.comment,\r\n          lat: res.body.lat,\r\n          lng: res.body.lng,\r\n          sectors: res.body.sectors\r\n        });\r\n        document.title=config.getTitle() + \" | \" + this.state.name;\r\n      }\r\n    });\r\n  }\r\n\r\n  handleTabsSelection(key) {\r\n    this.setState({tabIndex: key});\r\n  }\r\n\r\n  onRemoveMedia(idMediaToRemove) {\r\n    const allMedia = this.state.media.filter(m => m.id!=idMediaToRemove);\r\n    this.setState({media: allMedia});\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.id) {\r\n      return <center><FontAwesomeIcon icon=\"spinner\" spin size=\"3x\" /></center>;\r\n    }\r\n    if (this.state.error) {\r\n      return <span><h3>{this.state.error.status}</h3>{this.state.error.toString()}</span>;\r\n    }\r\n    const rows = this.state.sectors.map((sector, i) => {\r\n      return (\r\n        <TableRow sector={sector} key={i} />\r\n      )\r\n    });\r\n    const markers = this.state.sectors.filter(s => s.lat!=0 && s.lng!=0).map(s => {\r\n      return {\r\n          lat: s.lat,\r\n          lng: s.lng,\r\n          title: s.name,\r\n          icon: {\r\n            url: 'https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png',\r\n            scaledSize: new google.maps.Size(32, 32)\r\n          },\r\n          url: '/sector/' + s.id\r\n        }\r\n    });\r\n    const polygons = this.state.sectors.filter(s => s.polygonCoords).map(s => {\r\n      const triangleCoords = s.polygonCoords.split(\";\").map((p, i) => {\r\n        const latLng = p.split(\",\");\r\n        return {lat: parseFloat(latLng[0]), lng: parseFloat(latLng[1])};\r\n      });\r\n      return {\r\n        triangleCoords: triangleCoords,\r\n        url: '/sector/' + s.id\r\n      }\r\n    });\r\n    const defaultCenter = this.state.lat && this.state.lat>0? {lat: this.state.lat, lng: this.state.lng} : config.getDefaultCenter();\r\n    const defaultZoom = this.state.lat && this.state.lat>0? 14 : config.getDefaultZoom();\r\n    const map = markers.length>0 || polygons.length>0? <Map markers={markers} polygons={polygons} defaultCenter={defaultCenter} defaultZoom={defaultZoom}/> : null;\r\n    const gallery = this.state.media && this.state.media.length>0? <Gallery media={this.state.media} showThumbnails={this.state.media.length>1} removeMedia={this.onRemoveMedia.bind(this)}/> : null;\r\n    var topoContent = null;\r\n    if (map && gallery) {\r\n      topoContent = (\r\n        <Tabs activeKey={this.state.tabIndex} animation={false} onSelect={this.handleTabsSelection.bind(this)} id=\"area_tab\" unmountOnExit={true}>\r\n          <Tab eventKey={1} title=\"Topo\">{this.state.tabIndex==1? gallery : false}</Tab>\r\n          <Tab eventKey={2} title=\"Map\">{this.state.tabIndex==2? map : false}</Tab>\r\n        </Tabs>\r\n      );\r\n    } else if (map) {\r\n      topoContent = map;\r\n    } else if (gallery) {\r\n      topoContent = gallery;\r\n    }\r\n\r\n    return (\r\n      <span>\r\n        <Breadcrumb>\r\n          {auth.isAdmin()?\r\n            <div style={{float: 'right'}}>\r\n              <ButtonGroup>\r\n                <OverlayTrigger placement=\"top\" overlay={<Tooltip id={-1}>Add sector</Tooltip>}>\r\n                  <LinkContainer to={{ pathname: `/sector/edit/-1`, query: { idArea: this.state.id, lat: this.state.lat, lng: this.state.lng } }}><Button bsStyle=\"primary\" bsSize=\"xsmall\"><FontAwesomeIcon icon=\"plus-square\" inverse /></Button></LinkContainer>\r\n                </OverlayTrigger>\r\n                <OverlayTrigger placement=\"top\" overlay={<Tooltip id={this.state.id}>Edit area</Tooltip>}>\r\n                  <LinkContainer to={{ pathname: `/area/edit/${this.state.id}`, query: { lat: this.state.lat, lng: this.state.lng } }}><Button bsStyle=\"primary\" bsSize=\"xsmall\"><FontAwesomeIcon icon=\"edit\" inverse /></Button></LinkContainer>\r\n                </OverlayTrigger>\r\n              </ButtonGroup>\r\n            </div>:\r\n            null\r\n          }\r\n          <Link to={`/`}>Home</Link> / <Link to={`/browse`}>Browse</Link> / <font color='#777'>{this.state.name}</font> {this.state.visibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.visibility===2 && <FontAwesomeIcon icon=\"user-secret\" />}\r\n        </Breadcrumb>\r\n        {topoContent}\r\n        {this.state.comment? <Well><div dangerouslySetInnerHTML={{ __html: this.state.comment }} /></Well> : null}\r\n        <Table striped condensed hover>\r\n          <thead>\r\n            <tr>\r\n              <th>Name</th>\r\n              <th>Description</th>\r\n              <th>#problems</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows}\r\n          </tbody>\r\n        </Table>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n"],"sourceRoot":""}