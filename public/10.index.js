(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{237:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),a=n(1),l=f(a),i=(n(54),n(254)),r=f(n(86)),s=n(124),u=n(267),d=f(n(364)),c=f(n(85)),p=f(n(125)),h=f(n(88));function f(t){return t&&t.__esModule?t:{default:t}}n(87);var m=(0,u.withGoogleMap)(function(t){return l.default.createElement(u.GoogleMap,{defaultZoom:t.defaultZoom,defaultCenter:t.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN,onClick:t.onClick.bind(void 0),onRightClick:t.onRightClick.bind(void 0)},t.markers,t.outline)}),g=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.Component),o(e,[{key:"componentWillMount",value:function(){p.default.isAdmin()||this.setState({pushUrl:"/login",error:null})}},{key:"componentDidMount",value:function(){var t=this;document.title=c.default.getTitle()+" | Sector edit",-1==this.props.match.params.sectorId?this.setState({id:-1,visibility:0,name:"",comment:"",lat:0,lng:0,polygonCoords:null,newMedia:[]}):r.default.get(c.default.getUrl("sectors?regionId="+c.default.getRegion()+"&id="+this.props.match.params.sectorId)).withCredentials().end(function(e,n){e?t.setState({error:e}):t.setState({id:n.body.id,visibility:n.body.visibility,name:n.body.name,comment:n.body.comment,lat:n.body.lat,lng:n.body.lng,polygonCoords:n.body.polygonCoords,newMedia:[]})})}},{key:"onNameChanged",value:function(t){this.setState({name:t.target.value})}},{key:"onVisibilityChanged",value:function(t,e){this.setState({visibility:t})}},{key:"onCommentChanged",value:function(t){this.setState({comment:t.target.value})}},{key:"onNewMediaChanged",value:function(t){this.setState({newMedia:t})}},{key:"save",value:function(t){var e=this;t.preventDefault(),this.setState({isSaving:!0});var n=this.state.newMedia.map(function(t){return{name:t.file.name.replace(/[^-a-z0-9.]/gi,"_"),photographer:t.photographer,inPhoto:t.inPhoto}}),o=r.default.post(c.default.getUrl("sectors?regionId="+c.default.getRegion())).withCredentials().field("json",JSON.stringify({areaId:this.props.location.query.idArea,id:this.state.id,visibility:this.state.visibility,name:this.state.name,comment:this.state.comment,lat:this.state.lat,lng:this.state.lng,polygonCoords:this.state.polygonCoords,newMedia:n})).set("Accept","application/json");this.state.newMedia.forEach(function(t){return o.attach(t.file.name.replace(/[^-a-z0-9.]/gi,"_"),t.file)}),o.end(function(t,n){t?e.setState({error:t}):e.setState({pushUrl:"/sector/"+n.body.id})})}},{key:"onMapClick",value:function(t){this.setState({lat:t.latLng.lat(),lng:t.latLng.lng()})}},{key:"onMapRightClick",value:function(t){this.state.polygonCoords?this.setState({polygonCoords:this.state.polygonCoords+";"+t.latLng.lat()+","+t.latLng.lng()}):this.setState({polygonCoords:t.latLng.lat()+","+t.latLng.lng()})}},{key:"resetMapPolygon",value:function(t){this.setState({polygonCoords:null})}},{key:"onCancel",value:function(){window.history.back()}},{key:"render",value:function(){if(!this.state)return l.default.createElement("center",null,l.default.createElement(h.default,{icon:"spinner",spin:!0,size:"3x"}));if(this.state.error)return l.default.createElement("span",null,l.default.createElement("h3",null,this.state.error.status),this.state.error.toString());if(this.state.pushUrl)return l.default.createElement(i.Redirect,{to:this.state.pushUrl,push:!0});var t=this.state.polygonCoords?this.state.polygonCoords.split(";").map(function(t,e){var n=t.split(",");return{lat:parseFloat(n[0]),lng:parseFloat(n[1])}}):[],e="";1==t.length?e=l.default.createElement(u.Marker,{position:{lat:t[0].lat,lng:t[0].lng}}):t.length>1&&(e=l.default.createElement(u.Polygon,{paths:t,options:{strokeColor:"#FF3300",strokeOpacity:"0.5",strokeWeight:"2",fillColor:"#FF3300",fillOpacity:"0.15"},onClick:this.onMapClick.bind(this),onRightclick:this.onMapRightClick.bind(this)}));var n="Visible for everyone";1===this.state.visibility?n="Only visible for administrators":2===this.state.visibility&&(n="Only visible for super administrators");var o=this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?{lat:parseFloat(this.props.location.query.lat),lng:parseFloat(this.props.location.query.lng)}:c.default.getDefaultCenter(),a=this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?14:c.default.getDefaultZoom();return l.default.createElement(s.Well,null,l.default.createElement("form",{onSubmit:this.save.bind(this)},l.default.createElement(s.FormGroup,{controlId:"formControlsName"},l.default.createElement(s.ControlLabel,null,"Sector name"),l.default.createElement(s.FormControl,{type:"text",value:this.state.name,placeholder:"Enter name",onChange:this.onNameChanged.bind(this)})),l.default.createElement(s.FormGroup,{controlId:"formControlsComment"},l.default.createElement(s.ControlLabel,null,"Comment"),l.default.createElement(s.FormControl,{style:{height:"100px"},componentClass:"textarea",placeholder:"Enter comment",value:this.state.comment,onChange:this.onCommentChanged.bind(this)})),l.default.createElement(s.FormGroup,{controlId:"formControlsVisibility"},l.default.createElement(s.ControlLabel,null,"Visibility"),l.default.createElement("br",null),l.default.createElement(s.DropdownButton,{title:n,id:"bg-nested-dropdown"},l.default.createElement(s.MenuItem,{eventKey:"0",onSelect:this.onVisibilityChanged.bind(this,0)},"Visible for everyone"),l.default.createElement(s.MenuItem,{eventKey:"1",onSelect:this.onVisibilityChanged.bind(this,1)},"Only visible for administrators"),p.default.isSuperAdmin()&&l.default.createElement(s.MenuItem,{eventKey:"2",onSelect:this.onVisibilityChanged.bind(this,2)},"Only visible for super administrators"))),l.default.createElement(s.FormGroup,{controlId:"formControlsMedia"},l.default.createElement(d.default,{onMediaChanged:this.onNewMediaChanged.bind(this)})),l.default.createElement(s.FormGroup,{controlId:"formControlsMap"},l.default.createElement(s.ControlLabel,null,"Left mouse button to position parking coordinate, right mouse button to add polygon points (sector outline)"),l.default.createElement("br",null),l.default.createElement("section",{style:{height:"600px"}},l.default.createElement(m,{containerElement:l.default.createElement("div",{style:{height:"100%"}}),mapElement:l.default.createElement("div",{style:{height:"100%"}}),defaultZoom:a,defaultCenter:o,onClick:this.onMapClick.bind(this),onRightClick:this.onMapRightClick.bind(this),markers:0!=this.state.lat&&0!=this.state.lng?l.default.createElement(u.Marker,{position:{lat:this.state.lat,lng:this.state.lng},icon:{url:"https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png",scaledSize:new google.maps.Size(32,32)}}):"",outline:e}))),l.default.createElement(s.ButtonGroup,null,l.default.createElement(s.Button,{bsStyle:"warning",onClick:this.resetMapPolygon.bind(this)},"Clear polygon"),l.default.createElement(s.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),l.default.createElement(s.Button,{type:"submit",bsStyle:"success",disabled:this.state.isSaving},this.state.isSaving?"Saving...":"Save sector"))))}}]),e}();e.default=g}}]);
//# sourceMappingURL=10.index.js.map