{"version":3,"sources":["webpack:///./app/components/common/svg/svg-edit.js"],"names":["_react","__webpack_require__","r","f","i","_reactRouterDom","_reactBootstrap","_svgPathParser","u","c","_reactRouter","h","t","__esModule","default","SvgEdit","_this2","this","document","title","_config2","getTitle","_superagent2","get","getUrl","getRegion","props","match","params","problemId","withCredentials","end","err","res","setState","error","m","body","media","filter","x","id","mediaId","readOnlySvgs","svgId","points","svgs","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","svg","value","parsePath","path","push","nr","hasAnchor","return","w","width","height","ctrl","activePoint","draggedPoint","draggedCubic","areaId","areaName","areaVisibility","sectorId","sectorName","sectorVisibility","name","grade","visibility","addEventListener","handleKeyDown","bind","handleKeyUp","removeEventListener","e","ctrlKey","key","anchor","window","history","back","event","_this3","preventDefault","post","state","send","delete","length","generatePath","pushUrl","dim","refs","getBoundingClientRect","dx","dy","Math","round","clientX","left","y","clientY","top","coords","getMouseCoords","d","forEach","p","q","a","rx","ry","rot","laf","sf","setPointCoords","setCubicCoords","active","index","v","splice","shapes","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_react2","createElement","className","strokeWidth","strokeDasharray","commands","parseSVG","makeAbsolute","generateSvgNrAndAnchor","ixNr","ixAnchor","maxY","minY","len","cx","cy","fontSize","map","code","x1","y1","x2","y2","x0","y0","_this4","_reactFontawesome2","icon","spin","size","status","toString","Redirect","to","circles","anchors","onMouseDown","setDraggedCubic","setDraggedPoint","Breadcrumb","Link","Well","bsSize","onMouseUp","cancelDragging","onMouseLeave","onSubmit","save","FormGroup","controlId","Alert","bsStyle","ButtonGroup","DropdownButton","MenuItem","eventKey","onSelect","setPointType","Button","onClick","removeActivePoint","disabled","setHasAnchor","reset","onCancel","type","viewBox","addPoint","onMouseMove","handleMouseMove","ref","xlinkHref","parseReadOnlySvgs"],"mappings":"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","file":"9.index.js","sourcesContent":["import React, {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Link } from 'react-router-dom';\r\nimport { Well, FormGroup, MenuItem, ButtonGroup, Button, DropdownButton, Alert, Breadcrumb } from 'react-bootstrap';\r\nimport {parseSVG, makeAbsolute} from 'svg-path-parser';\r\nimport config from '../../../utils/config.js';\r\nimport Request from 'superagent';\r\nimport { Redirect } from 'react-router';\r\nimport FontAwesomeIcon from '@fortawesome/react-fontawesome';\r\nimport { faSpinner, faLock, faUserSecret } from '@fortawesome/fontawesome-free-solid';\r\n\r\nexport default class SvgEdit extends Component {\r\n  componentDidMount() {\r\n    document.title=config.getTitle() + \" | Problem edit (SVG)\";\r\n    Request.get(config.getUrl(\"problems?regionId=\" + config.getRegion() + \"&id=\" + this.props.match.params.problemId)).withCredentials().end((err, res) => {\r\n      if (err) {\r\n        this.setState({error: err});\r\n      } else {\r\n        const m = res.body[0].media.filter(x => x.id==this.props.match.params.mediaId)[0];\r\n        const readOnlySvgs = [];\r\n        var svgId = 0;\r\n        var points = [];\r\n        if (m.svgs) {\r\n          for (let svg of m.svgs) {\r\n            if (svg.problemId===res.body[0].id) {\r\n              svgId = svg.id;\r\n              points = this.parsePath(svg.path);\r\n            }\r\n            else {\r\n              readOnlySvgs.push({ nr: svg.nr, hasAnchor: svg.hasAnchor, path: svg.path });\r\n            }\r\n          }\r\n        }\r\n        this.setState({\r\n          mediaId: m.id,\r\n          nr: res.body[0].nr,\r\n          w: m.width,\r\n          h: m.height,\r\n          ctrl: false,\r\n          svgId: svgId,\r\n          points: points,\r\n          readOnlySvgs: readOnlySvgs,\r\n          activePoint: 0,\r\n          draggedPoint: false,\r\n          draggedCubic: false,\r\n          hasAnchor: true,\r\n          areaId: res.body[0].areaId,\r\n          areaName: res.body[0].areaName,\r\n          areaVisibility: res.body[0].areaVisibility,\r\n          sectorId: res.body[0].sectorId,\r\n          sectorName: res.body[0].sectorName,\r\n          sectorVisibility: res.body[0].sectorVisibility,\r\n          id: res.body[0].id,\r\n          name: res.body[0].name,\r\n          grade: res.body[0].grade,\r\n          visibility: res.body[0].visibility\r\n        });\r\n      }\r\n    });\r\n    document.addEventListener(\"keydown\", this.handleKeyDown.bind(this));\r\n    document.addEventListener(\"keyup\", this.handleKeyUp.bind(this));\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown.bind(this));\r\n    document.removeEventListener(\"keyup\", this.handleKeyUp.bind(this));\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.ctrlKey) this.setState({ctrl: true});\r\n  };\r\n\r\n  handleKeyUp(e) {\r\n    if (!e.ctrlKey) this.setState({ctrl: false});\r\n  };\r\n\r\n  setHasAnchor(anchor) {\r\n    this.setState({hasAnchor: anchor});\r\n  }\r\n\r\n  onCancel() {\r\n    window.history.back();\r\n  }\r\n\r\n  save(event) {\r\n    event.preventDefault();\r\n    Request.post(config.getUrl(\"problems/svg?problemId=\" + this.state.id + \"&mediaId=\" + this.state.mediaId))\r\n    .withCredentials()\r\n    .send({delete: this.state.points.length<2, id: this.state.svgId, path: this.generatePath(), hasAnchor: this.state.hasAnchor})\r\n    .end((err, res) => {\r\n      if (err) {\r\n        this.setState({error: err});\r\n      } else {\r\n        this.setState({pushUrl: \"/problem/\" + this.state.id});\r\n      }\r\n    });\r\n  }\r\n\r\n  cancelDragging(e) {\r\n    this.setState({\r\n      draggedPoint: false,\r\n      draggedCubic: false\r\n    });\r\n  }\r\n\r\n  getMouseCoords(e) {\r\n    const dim = this.refs[\"buldreinfo-svg-edit-img\"].getBoundingClientRect();\r\n    const dx = this.state.w/dim.width;\r\n    const dy = this.state.h/dim.height;\r\n    const x = Math.round((e.clientX - dim.left) * dx);\r\n    const y = Math.round((e.clientY - dim.top) * dy);\r\n    return {x, y};\r\n  };\r\n\r\n  addPoint(e) {\r\n    if (this.state.ctrl) {\r\n      let coords = this.getMouseCoords(e);\r\n      let points = this.state.points;\r\n      points.push(coords);\r\n      this.setState({\r\n        points,\r\n        activePoint: points.length - 1\r\n      });\r\n    }\r\n  };\r\n\r\n  generatePath() {\r\n    var d = \"\";\r\n    this.state.points.forEach((p, i) => {\r\n      if (i === 0) { // first point\r\n        d += \"M \";\r\n      } else if (p.q) { // quadratic\r\n        d += `Q ${ p.q.x } ${ p.q.y } `;\r\n      } else if (p.c) { // cubic\r\n        d += `C ${ p.c[0].x } ${ p.c[0].y } ${ p.c[1].x } ${ p.c[1].y } `;\r\n      } else if (p.a) { // arc\r\n        d += `A ${ p.a.rx } ${ p.a.ry } ${ p.a.rot } ${ p.a.laf } ${ p.a.sf } `;\r\n      } else {\r\n        d += \"L \";\r\n      }\r\n      d += `${ p.x } ${ p.y } `;\r\n    })\r\n    return d;\r\n  }\r\n\r\n  handleMouseMove(e) {\r\n    e.preventDefault();\r\n    if (!this.state.ctrl) {\r\n      if (this.state.draggedPoint) {\r\n        this.setPointCoords(this.getMouseCoords(e));\r\n      } else if (this.state.draggedCubic !== false) {\r\n        this.setCubicCoords(this.getMouseCoords(e), this.state.draggedCubic);\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  setPointCoords(coords) {\r\n    const points = this.state.points;\r\n    const active = this.state.activePoint;\r\n    points[active].x = coords.x;\r\n    points[active].y = coords.y;\r\n    this.setState({points});\r\n  };\r\n\r\n  setCubicCoords(coords, anchor) {\r\n    const points = this.state.points;\r\n    const active = this.state.activePoint;\r\n    points[active].c[anchor].x = coords.x;\r\n    points[active].c[anchor].y = coords.y;\r\n    this.setState({ points });\r\n  };\r\n\r\n  setDraggedPoint(index) {\r\n    if (!this.state.ctrl) {\r\n      this.setState({activePoint: index, draggedPoint: true});\r\n    }\r\n  };\r\n\r\n  setDraggedCubic(index, anchor) {\r\n    if (!this.state.ctrl) {\r\n      this.setState({activePoint: index, draggedCubic: anchor});\r\n    }\r\n  };\r\n\r\n  setPointType(v) {\r\n    const points = this.state.points;\r\n    const active = this.state.activePoint;\r\n    if (active !== 0) { // not the first point\r\n      switch (v) {\r\n        case \"L\":\r\n          points[active] = {x: points[active].x, y: points[active].y};\r\n          break;\r\n        case \"C\":\r\n          points[active] = {\r\n            x: points[active].x,\r\n            y: points[active].y,\r\n            c: [\r\n                {\r\n                  x: (points[active].x + points[active - 1].x - 50) / 2,\r\n                  y: (points[active].y + points[active - 1].y) / 2\r\n                },\r\n                {\r\n                  x: (points[active].x + points[active - 1].x + 50) / 2,\r\n                  y: (points[active].y + points[active - 1].y) / 2\r\n                }\r\n            ]\r\n          };\r\n        break;\r\n      }\r\n      this.setState({points});\r\n    }\r\n  };\r\n\r\n  removeActivePoint(e) {\r\n    let points = this.state.points;\r\n    let active = this.state.activePoint;\r\n    if (points.length > 1 && active !== 0) {\r\n      points.splice(active, 1);\r\n      this.setState({points, activePoint: points.length-1});\r\n    }\r\n  };\r\n\r\n  reset(e) {\r\n    this.setState({\r\n      ctrl: false,\r\n      points: [],\r\n      activePoint: 0,\r\n      draggedPoint: false,\r\n      draggedCubic: false,\r\n      hasAnchor: false\r\n    });\r\n  };\r\n\r\n  parseReadOnlySvgs() {\r\n    const shapes = [];\r\n    for (let svg of this.state.readOnlySvgs) {\r\n      shapes.push(<path key={shapes.length} d={svg.path} className=\"buldreinfo-svg-opacity buldreinfo-svg-route\" strokeWidth={0.003*this.state.w} strokeDasharray={0.006*this.state.w}/>);\r\n      const commands = parseSVG(svg.path);\r\n      makeAbsolute(commands); // Note: mutates the commands in place!\r\n      shapes.push(this.generateSvgNrAndAnchor(commands, svg.nr, svg.hasAnchor));\r\n    }\r\n    return shapes;\r\n  }\r\n\r\n  generateSvgNrAndAnchor(path, nr, hasAnchor) {\r\n    var ixNr;\r\n    var maxY = 0;\r\n    var ixAnchor;\r\n    var minY = 99999999;\r\n    for (var i=0, len=path.length; i < len; i++) {\r\n      if (path[i].y > maxY) {\r\n        ixNr = i;\r\n        maxY = path[i].y;\r\n      }\r\n      if (path[i].y < minY) {\r\n        ixAnchor = i;\r\n        minY = path[i].y;\r\n      }\r\n    }\r\n    var x = path[ixNr].x;\r\n    var y = path[ixNr].y;\r\n    const r = 0.012*this.state.w;\r\n    if (x < r) x = r;\r\n    if (x > (this.state.w-r)) x = this.state.w-r;\r\n    if (y < r) y = r;\r\n    if (y > (this.state.h-r)) y = this.state.h-r;\r\n    var anchor = null;\r\n    if (hasAnchor === true) {\r\n      anchor = <circle className=\"buldreinfo-svg-ring\" cx={path[ixAnchor].x} cy={path[ixAnchor].y} r={0.006*this.state.w}/>\r\n    }\r\n    return (\r\n      <g className=\"buldreinfo-svg-opacity\">\r\n        <circle className=\"buldreinfo-svg-ring\" cx={x} cy={y} r={r}/>\r\n        <text className=\"buldreinfo-svg-routenr\" x={x} y={y} fontSize={0.02*this.state.w}>{nr}</text>\r\n        {anchor}\r\n      </g>\r\n    );\r\n  }\r\n\r\n  parsePath(d) {\r\n    if (d) {\r\n      const commands = parseSVG(d);\r\n      makeAbsolute(commands); // Note: mutates the commands in place!\r\n      return commands.map(c => {\r\n        switch (c.code) {\r\n          case \"L\": case \"M\": return { x: Math.round(c.x), y: Math.round(c.y) };\r\n          case \"C\": return { x: Math.round(c.x), y: Math.round(c.y), c: [{x: Math.round(c.x1), y: Math.round(c.y1)}, {x: Math.round(c.x2), y: Math.round(c.y2)}] };\r\n          case \"S\": return { x: Math.round(c.x), y: Math.round(c.y), c: [{x: Math.round(c.x0), y: Math.round(c.y0)}, {x: Math.round(c.x2), y: Math.round(c.y2)}] };\r\n        }\r\n      });\r\n    }\r\n    return [];\r\n  }\r\n\r\n  render() {\r\n    if (!this.state) {\r\n      return <center><FontAwesomeIcon icon=\"spinner\" spin size=\"3x\" /></center>;\r\n    }\r\n    else if (this.state.error) {\r\n      return <span><h3>{this.state.error.status}</h3>{this.state.error.toString()}</span>;\r\n    }\r\n    else if (this.state.pushUrl) {\r\n      return (<Redirect to={this.state.pushUrl} push />);\r\n    }\r\n\r\n    var circles = this.state.points.map((p, i, a) => {\r\n      var anchors = [];\r\n      if (p.c) {\r\n        anchors.push(\r\n          <g className=\"buldreinfo-svg-edit-opacity\">\r\n            <line className=\"buldreinfo-svg-pointer buldreinfo-svg-route\" x1={a[i-1].x} y1={a[i-1].y} x2={p.c[0].x} y2={p.c[0].y} strokeWidth={0.0026*this.state.w} strokeDasharray={0.003*this.state.w}/>\r\n            <line className=\"buldreinfo-svg-pointer buldreinfo-svg-route\" x1={p.x} y1={p.y} x2={p.c[1].x} y2={p.c[1].y} strokeWidth={0.0026*this.state.w} strokeDasharray={0.003*this.state.w}/>\r\n            <circle className=\"buldreinfo-svg-pointer buldreinfo-svg-ring\" cx={p.c[0].x} cy={p.c[0].y} r={0.003*this.state.w} onMouseDown={this.setDraggedCubic.bind(this, i, 0)}/>\r\n            <circle className=\"buldreinfo-svg-pointer buldreinfo-svg-ring\" cx={p.c[1].x} cy={p.c[1].y} r={0.003*this.state.w} onMouseDown={this.setDraggedCubic.bind(this, i, 1)}/>\r\n          </g>\r\n        );\r\n      }\r\n      return (\r\n        <g className={\"buldreinfo-svg-ring-group\" + (this.state.activePoint === i ? \"  is-active\" : \"\")}>\r\n          {anchors}\r\n          <circle className=\"buldreinfo-svg-pointer buldreinfo-svg-ring\" cx={p.x} cy={p.y} r={0.003*this.state.w} onMouseDown={this.setDraggedPoint.bind(this, i)}/>\r\n        </g>\r\n      );\r\n    });\r\n    const path = this.generatePath();\r\n    return (\r\n      <span>\r\n        <Breadcrumb>\r\n          <Link to={`/`}>Home</Link> / <Link to={`/browse`}>Browse</Link> / <Link to={`/area/${this.state.areaId}`}>{this.state.areaName}</Link> {this.state.areaVisibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.areaVisibility===2 && <FontAwesomeIcon icon=\"user-secret\" />} / <Link to={`/sector/${this.state.sectorId}`}>{this.state.sectorName}</Link> {this.state.sectorVisibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.sectorVisibility===2 && <FontAwesomeIcon icon=\"user-secret\" />} / <Link to={`/problem/${this.state.id}`}>{this.state.nr} {this.state.name} {this.state.grade}</Link> {this.state.visibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.visibility===2 && <FontAwesomeIcon icon=\"user-secret\" />}\r\n        </Breadcrumb>\r\n        <Well bsSize=\"small\" onMouseUp={this.cancelDragging.bind(this)} onMouseLeave={this.cancelDragging.bind(this)}>\r\n          <form onSubmit={this.save.bind(this)}>\r\n            <FormGroup controlId=\"formControlsInfo\">\r\n              <Alert bsStyle=\"info\">\r\n                <center>\r\n                  <strong>CTRL + CLICK</strong> to add a point | <strong>CLICK</strong> to select a point | <strong>CLICK AND DRAG</strong> to move a point<br/>\r\n                  <ButtonGroup>\r\n                    {this.state.activePoint !== 0 && (\r\n                      <DropdownButton title={!!this.state.points[this.state.activePoint].c? \"Selected point: Curve to\" : \"Selected point: Line to\"} id=\"bg-nested-dropdown\">\r\n                        <MenuItem eventKey=\"0\" onSelect={this.setPointType.bind(this, \"L\")}>Selected point: Line to</MenuItem>\r\n                        <MenuItem eventKey=\"1\" onSelect={this.setPointType.bind(this, \"C\")}>Selected point: Curve to</MenuItem>\r\n                      </DropdownButton>\r\n                    )}\r\n                    {this.state.activePoint !== 0 && (\r\n                      <Button onClick={this.removeActivePoint.bind(this)}>Remove this point</Button>\r\n                    )}\r\n                    <DropdownButton title={this.state.hasAnchor === true? \"Route has anchor\" : \"No anchor on route\"} disabled={this.state.points.length===0} id=\"bg-nested-dropdown\">\r\n                      <MenuItem eventKey=\"0\" onSelect={this.setHasAnchor.bind(this, false)}>No anchor on route</MenuItem>\r\n                      <MenuItem eventKey=\"1\" onSelect={this.setHasAnchor.bind(this, true)}>Route has anchor</MenuItem>\r\n                    </DropdownButton>\r\n                    <Button bsStyle=\"warning\" disabled={this.state.points.length===0} onClick={this.reset.bind(this)}>Reset path</Button>\r\n                    <Button bsStyle=\"danger\" onClick={this.onCancel.bind(this)}>Cancel</Button>\r\n                    <Button type=\"submit\" bsStyle=\"success\">{this.state.points.length>=2? 'Save' : 'Delete path'}</Button>\r\n                  </ButtonGroup>\r\n                </center>\r\n              </Alert>\r\n            </FormGroup>\r\n            <FormGroup controlId=\"formControlsImage\">\r\n              <svg viewBox={\"0 0 \" + this.state.w + \" \" + this.state.h} onClick={this.addPoint.bind(this)} onMouseMove={this.handleMouseMove.bind(this)}>\r\n                <image ref=\"buldreinfo-svg-edit-img\" xlinkHref={config.getUrl(`images?id=${this.state.mediaId}`)} width=\"100%\" height=\"100%\"/>\r\n                {this.parseReadOnlySvgs()}\r\n                <path className=\"buldreinfo-svg-route\" d={path} strokeWidth={0.002*this.state.w}/>\r\n                {circles}\r\n              </svg>\r\n            </FormGroup>\r\n            <FormGroup controlId=\"formControlsPath\">\r\n              {path}\r\n            </FormGroup>\r\n          </form>\r\n        </Well>\r\n      </span>\r\n    )\r\n  }\r\n}\r\n"],"sourceRoot":""}