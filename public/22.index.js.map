{"version":3,"sources":["webpack:///./app/components/common/svg/svg-edit.js"],"names":["_react","__webpack_require__","s","f","i","_reactRouterDom","_reactBootstrap","_svgPathParser","c","u","_reactRouter","_reactFontawesome","e","__esModule","default","SvgEdit","Component","_this2","this","Request","get","config","getUrl","getRegion","props","match","params","problemId","withCredentials","end","err","res","setState","error","m","body","media","filter","x","id","mediaId","readOnlySvgs","svgId","points","svgs","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","svg","value","parsePath","path","push","nr","hasAnchor","return","w","width","h","height","ctrl","activePoint","draggedPoint","draggedCubic","areaId","areaName","areaVisibility","sectorId","sectorName","sectorVisibility","name","grade","visibility","document","addEventListener","handleKeyDown","bind","handleKeyUp","removeEventListener","ctrlKey","key","anchor","window","history","back","event","_this3","preventDefault","post","state","send","delete","length","generatePath","pushUrl","dim","refs","getBoundingClientRect","dx","dy","Math","round","clientX","left","y","clientY","top","coords","getMouseCoords","d","forEach","p","q","a","rx","ry","rot","laf","sf","setPointCoords","setCubicCoords","active","index","v","splice","shapes","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_react2","createElement","className","strokeWidth","strokeDasharray","commands","parseSVG","makeAbsolute","generateSvgNrAndAnchor","ixNr","ixAnchor","maxY","minY","len","r","cx","cy","fontSize","map","code","x1","y1","x2","y2","x0","y0","_this4","FontAwesomeIcon","icon","spin","size","status","toString","Redirect","to","circles","anchors","onMouseDown","setDraggedCubic","setDraggedPoint","Breadcrumb","Link","Well","bsSize","onMouseUp","cancelDragging","onMouseLeave","onSubmit","save","FormGroup","controlId","Alert","bsStyle","ButtonGroup","DropdownButton","title","MenuItem","eventKey","onSelect","setPointType","Button","onClick","removeActivePoint","disabled","setHasAnchor","reset","onCancel","type","viewBox","addPoint","onMouseMove","handleMouseMove","ref","xlinkHref","parseReadOnlySvgs"],"mappings":"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","file":"22.index.js","sourcesContent":["import React, {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Link } from 'react-router-dom';\r\nimport { Well, FormGroup, MenuItem, ButtonGroup, Button, DropdownButton, Alert, Breadcrumb } from 'react-bootstrap';\r\nimport {parseSVG, makeAbsolute} from 'svg-path-parser';\r\nimport config from '../../../utils/config.js';\r\nimport Request from 'superagent';\r\nimport { Redirect } from 'react-router';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n\r\nexport default class SvgEdit extends Component {\r\n  componentDidMount() {\r\n    Request.get(config.getUrl(\"problems?regionId=\" + config.getRegion() + \"&id=\" + this.props.match.params.problemId)).withCredentials().end((err, res) => {\r\n      if (err) {\r\n        this.setState({error: err});\r\n      } else {\r\n        const m = res.body[0].media.filter(x => x.id==this.props.match.params.mediaId)[0];\r\n        const readOnlySvgs = [];\r\n        var svgId = 0;\r\n        var points = [];\r\n        if (m.svgs) {\r\n          for (let svg of m.svgs) {\r\n            if (svg.problemId===res.body[0].id) {\r\n              svgId = svg.id;\r\n              points = this.parsePath(svg.path);\r\n            }\r\n            else {\r\n              readOnlySvgs.push({ nr: svg.nr, hasAnchor: svg.hasAnchor, path: svg.path });\r\n            }\r\n          }\r\n        }\r\n        this.setState({\r\n          mediaId: m.id,\r\n          nr: res.body[0].nr,\r\n          w: m.width,\r\n          h: m.height,\r\n          ctrl: false,\r\n          svgId: svgId,\r\n          points: points,\r\n          readOnlySvgs: readOnlySvgs,\r\n          activePoint: 0,\r\n          draggedPoint: false,\r\n          draggedCubic: false,\r\n          hasAnchor: true,\r\n          areaId: res.body[0].areaId,\r\n          areaName: res.body[0].areaName,\r\n          areaVisibility: res.body[0].areaVisibility,\r\n          sectorId: res.body[0].sectorId,\r\n          sectorName: res.body[0].sectorName,\r\n          sectorVisibility: res.body[0].sectorVisibility,\r\n          id: res.body[0].id,\r\n          name: res.body[0].name,\r\n          grade: res.body[0].grade,\r\n          visibility: res.body[0].visibility\r\n        });\r\n      }\r\n    });\r\n    document.addEventListener(\"keydown\", this.handleKeyDown.bind(this));\r\n    document.addEventListener(\"keyup\", this.handleKeyUp.bind(this));\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown.bind(this));\r\n    document.removeEventListener(\"keyup\", this.handleKeyUp.bind(this));\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.ctrlKey) this.setState({ctrl: true});\r\n  };\r\n\r\n  handleKeyUp(e) {\r\n    if (!e.ctrlKey) this.setState({ctrl: false});\r\n  };\r\n\r\n  setHasAnchor(anchor) {\r\n    this.setState({hasAnchor: anchor});\r\n  }\r\n\r\n  onCancel() {\r\n    window.history.back();\r\n  }\r\n\r\n  save(event) {\r\n    event.preventDefault();\r\n    Request.post(config.getUrl(\"problems/svg?problemId=\" + this.state.id + \"&mediaId=\" + this.state.mediaId))\r\n    .withCredentials()\r\n    .send({delete: this.state.points.length<2, id: this.state.svgId, path: this.generatePath(), hasAnchor: this.state.hasAnchor})\r\n    .end((err, res) => {\r\n      if (err) {\r\n        this.setState({error: err});\r\n      } else {\r\n        this.setState({pushUrl: \"/problem/\" + this.state.id});\r\n      }\r\n    });\r\n  }\r\n\r\n  cancelDragging(e) {\r\n    this.setState({\r\n      draggedPoint: false,\r\n      draggedCubic: false\r\n    });\r\n  }\r\n\r\n  getMouseCoords(e) {\r\n    const dim = this.refs[\"buldreinfo-svg-edit-img\"].getBoundingClientRect();\r\n    const dx = this.state.w/dim.width;\r\n    const dy = this.state.h/dim.height;\r\n    const x = Math.round((e.clientX - dim.left) * dx);\r\n    const y = Math.round((e.clientY - dim.top) * dy);\r\n    return {x, y};\r\n  };\r\n\r\n  addPoint(e) {\r\n    if (this.state.ctrl) {\r\n      let coords = this.getMouseCoords(e);\r\n      let points = this.state.points;\r\n      points.push(coords);\r\n      this.setState({\r\n        points,\r\n        activePoint: points.length - 1\r\n      });\r\n    }\r\n  };\r\n\r\n  generatePath() {\r\n    var d = \"\";\r\n    this.state.points.forEach((p, i) => {\r\n      if (i === 0) { // first point\r\n        d += \"M \";\r\n      } else if (p.q) { // quadratic\r\n        d += `Q ${ p.q.x } ${ p.q.y } `;\r\n      } else if (p.c) { // cubic\r\n        d += `C ${ p.c[0].x } ${ p.c[0].y } ${ p.c[1].x } ${ p.c[1].y } `;\r\n      } else if (p.a) { // arc\r\n        d += `A ${ p.a.rx } ${ p.a.ry } ${ p.a.rot } ${ p.a.laf } ${ p.a.sf } `;\r\n      } else {\r\n        d += \"L \";\r\n      }\r\n      d += `${ p.x } ${ p.y } `;\r\n    })\r\n    return d;\r\n  }\r\n\r\n  handleMouseMove(e) {\r\n    e.preventDefault();\r\n    if (!this.state.ctrl) {\r\n      if (this.state.draggedPoint) {\r\n        this.setPointCoords(this.getMouseCoords(e));\r\n      } else if (this.state.draggedCubic !== false) {\r\n        this.setCubicCoords(this.getMouseCoords(e), this.state.draggedCubic);\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  setPointCoords(coords) {\r\n    const points = this.state.points;\r\n    const active = this.state.activePoint;\r\n    points[active].x = coords.x;\r\n    points[active].y = coords.y;\r\n    this.setState({points});\r\n  };\r\n\r\n  setCubicCoords(coords, anchor) {\r\n    const points = this.state.points;\r\n    const active = this.state.activePoint;\r\n    points[active].c[anchor].x = coords.x;\r\n    points[active].c[anchor].y = coords.y;\r\n    this.setState({ points });\r\n  };\r\n\r\n  setDraggedPoint(index) {\r\n    if (!this.state.ctrl) {\r\n      this.setState({activePoint: index, draggedPoint: true});\r\n    }\r\n  };\r\n\r\n  setDraggedCubic(index, anchor) {\r\n    if (!this.state.ctrl) {\r\n      this.setState({activePoint: index, draggedCubic: anchor});\r\n    }\r\n  };\r\n\r\n  setPointType(v) {\r\n    const points = this.state.points;\r\n    const active = this.state.activePoint;\r\n    if (active !== 0) { // not the first point\r\n      switch (v) {\r\n        case \"L\":\r\n          points[active] = {x: points[active].x, y: points[active].y};\r\n          break;\r\n        case \"C\":\r\n          points[active] = {\r\n            x: points[active].x,\r\n            y: points[active].y,\r\n            c: [\r\n                {\r\n                  x: (points[active].x + points[active - 1].x - 50) / 2,\r\n                  y: (points[active].y + points[active - 1].y) / 2\r\n                },\r\n                {\r\n                  x: (points[active].x + points[active - 1].x + 50) / 2,\r\n                  y: (points[active].y + points[active - 1].y) / 2\r\n                }\r\n            ]\r\n          };\r\n        break;\r\n      }\r\n      this.setState({points});\r\n    }\r\n  };\r\n\r\n  removeActivePoint(e) {\r\n    let points = this.state.points;\r\n    let active = this.state.activePoint;\r\n    if (points.length > 1 && active !== 0) {\r\n      points.splice(active, 1);\r\n      this.setState({points, activePoint: points.length-1});\r\n    }\r\n  };\r\n\r\n  reset(e) {\r\n    this.setState({\r\n      ctrl: false,\r\n      points: [],\r\n      activePoint: 0,\r\n      draggedPoint: false,\r\n      draggedCubic: false,\r\n      hasAnchor: false\r\n    });\r\n  };\r\n\r\n  parseReadOnlySvgs() {\r\n    const shapes = [];\r\n    for (let svg of this.state.readOnlySvgs) {\r\n      shapes.push(<path key={shapes.length} d={svg.path} className=\"buldreinfo-svg-opacity buldreinfo-svg-route\" strokeWidth={0.003*this.state.w} strokeDasharray={0.006*this.state.w}/>);\r\n      const commands = parseSVG(svg.path);\r\n      makeAbsolute(commands); // Note: mutates the commands in place!\r\n      shapes.push(this.generateSvgNrAndAnchor(commands, svg.nr, svg.hasAnchor));\r\n    }\r\n    return shapes;\r\n  }\r\n\r\n  generateSvgNrAndAnchor(path, nr, hasAnchor) {\r\n    var ixNr;\r\n    var maxY = 0;\r\n    var ixAnchor;\r\n    var minY = 99999999;\r\n    for (var i=0, len=path.length; i < len; i++) {\r\n      if (path[i].y > maxY) {\r\n        ixNr = i;\r\n        maxY = path[i].y;\r\n      }\r\n      if (path[i].y < minY) {\r\n        ixAnchor = i;\r\n        minY = path[i].y;\r\n      }\r\n    }\r\n    var x = path[ixNr].x;\r\n    var y = path[ixNr].y;\r\n    const r = 0.012*this.state.w;\r\n    if (x < r) x = r;\r\n    if (x > (this.state.w-r)) x = this.state.w-r;\r\n    if (y < r) y = r;\r\n    if (y > (this.state.h-r)) y = this.state.h-r;\r\n    var anchor = null;\r\n    if (hasAnchor === true) {\r\n      anchor = <circle className=\"buldreinfo-svg-ring\" cx={path[ixAnchor].x} cy={path[ixAnchor].y} r={0.006*this.state.w}/>\r\n    }\r\n    return (\r\n      <g className=\"buldreinfo-svg-opacity\">\r\n        <circle className=\"buldreinfo-svg-ring\" cx={x} cy={y} r={r}/>\r\n        <text className=\"buldreinfo-svg-routenr\" x={x} y={y} fontSize={0.02*this.state.w}>{nr}</text>\r\n        {anchor}\r\n      </g>\r\n    );\r\n  }\r\n\r\n  parsePath(d) {\r\n    if (d) {\r\n      const commands = parseSVG(d);\r\n      makeAbsolute(commands); // Note: mutates the commands in place!\r\n      return commands.map(c => {\r\n        switch (c.code) {\r\n          case \"L\": case \"M\": return { x: Math.round(c.x), y: Math.round(c.y) };\r\n          case \"C\": return { x: Math.round(c.x), y: Math.round(c.y), c: [{x: Math.round(c.x1), y: Math.round(c.y1)}, {x: Math.round(c.x2), y: Math.round(c.y2)}] };\r\n          case \"S\": return { x: Math.round(c.x), y: Math.round(c.y), c: [{x: Math.round(c.x0), y: Math.round(c.y0)}, {x: Math.round(c.x2), y: Math.round(c.y2)}] };\r\n        }\r\n      });\r\n    }\r\n    return [];\r\n  }\r\n\r\n  render() {\r\n    if (!this.state) {\r\n      return <center><FontAwesomeIcon icon=\"spinner\" spin size=\"3x\" /></center>;\r\n    }\r\n    else if (this.state.error) {\r\n      return <span><h3>{this.state.error.status}</h3>{this.state.error.toString()}</span>;\r\n    }\r\n    else if (this.state.pushUrl) {\r\n      return (<Redirect to={this.state.pushUrl} push />);\r\n    }\r\n\r\n    var circles = this.state.points.map((p, i, a) => {\r\n      var anchors = [];\r\n      if (p.c) {\r\n        anchors.push(\r\n          <g className=\"buldreinfo-svg-edit-opacity\">\r\n            <line className=\"buldreinfo-svg-pointer buldreinfo-svg-route\" x1={a[i-1].x} y1={a[i-1].y} x2={p.c[0].x} y2={p.c[0].y} strokeWidth={0.0026*this.state.w} strokeDasharray={0.003*this.state.w}/>\r\n            <line className=\"buldreinfo-svg-pointer buldreinfo-svg-route\" x1={p.x} y1={p.y} x2={p.c[1].x} y2={p.c[1].y} strokeWidth={0.0026*this.state.w} strokeDasharray={0.003*this.state.w}/>\r\n            <circle className=\"buldreinfo-svg-pointer buldreinfo-svg-ring\" cx={p.c[0].x} cy={p.c[0].y} r={0.003*this.state.w} onMouseDown={this.setDraggedCubic.bind(this, i, 0)}/>\r\n            <circle className=\"buldreinfo-svg-pointer buldreinfo-svg-ring\" cx={p.c[1].x} cy={p.c[1].y} r={0.003*this.state.w} onMouseDown={this.setDraggedCubic.bind(this, i, 1)}/>\r\n          </g>\r\n        );\r\n      }\r\n      return (\r\n        <g className={\"buldreinfo-svg-ring-group\" + (this.state.activePoint === i ? \"  is-active\" : \"\")}>\r\n          {anchors}\r\n          <circle className=\"buldreinfo-svg-pointer buldreinfo-svg-ring\" cx={p.x} cy={p.y} r={0.003*this.state.w} onMouseDown={this.setDraggedPoint.bind(this, i)}/>\r\n        </g>\r\n      );\r\n    });\r\n    const path = this.generatePath();\r\n    return (\r\n      <span>\r\n        <Breadcrumb>\r\n          <Link to={`/`}>Home</Link> / <Link to={`/browse`}>Browse</Link> / <Link to={`/area/${this.state.areaId}`}>{this.state.areaName}</Link> {this.state.areaVisibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.areaVisibility===2 && <FontAwesomeIcon icon=\"user-secret\" />} / <Link to={`/sector/${this.state.sectorId}`}>{this.state.sectorName}</Link> {this.state.sectorVisibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.sectorVisibility===2 && <FontAwesomeIcon icon=\"user-secret\" />} / <Link to={`/problem/${this.state.id}`}>{this.state.nr} {this.state.name} {this.state.grade}</Link> {this.state.visibility===1 && <FontAwesomeIcon icon=\"lock\" />}{this.state.visibility===2 && <FontAwesomeIcon icon=\"user-secret\" />}\r\n        </Breadcrumb>\r\n        <Well bsSize=\"small\" onMouseUp={this.cancelDragging.bind(this)} onMouseLeave={this.cancelDragging.bind(this)}>\r\n          <form onSubmit={this.save.bind(this)}>\r\n            <FormGroup controlId=\"formControlsInfo\">\r\n              <Alert bsStyle=\"info\">\r\n                <center>\r\n                  <strong>CTRL + CLICK</strong> to add a point | <strong>CLICK</strong> to select a point | <strong>CLICK AND DRAG</strong> to move a point<br/>\r\n                  <ButtonGroup>\r\n                    {this.state.activePoint !== 0 && (\r\n                      <DropdownButton title={!!this.state.points[this.state.activePoint].c? \"Selected point: Curve to\" : \"Selected point: Line to\"} id=\"bg-nested-dropdown\">\r\n                        <MenuItem eventKey=\"0\" onSelect={this.setPointType.bind(this, \"L\")}>Selected point: Line to</MenuItem>\r\n                        <MenuItem eventKey=\"1\" onSelect={this.setPointType.bind(this, \"C\")}>Selected point: Curve to</MenuItem>\r\n                      </DropdownButton>\r\n                    )}\r\n                    {this.state.activePoint !== 0 && (\r\n                      <Button onClick={this.removeActivePoint.bind(this)}>Remove this point</Button>\r\n                    )}\r\n                    <DropdownButton title={this.state.hasAnchor === true? \"Route has anchor\" : \"No anchor on route\"} disabled={this.state.points.length===0} id=\"bg-nested-dropdown\">\r\n                      <MenuItem eventKey=\"0\" onSelect={this.setHasAnchor.bind(this, false)}>No anchor on route</MenuItem>\r\n                      <MenuItem eventKey=\"1\" onSelect={this.setHasAnchor.bind(this, true)}>Route has anchor</MenuItem>\r\n                    </DropdownButton>\r\n                    <Button bsStyle=\"warning\" disabled={this.state.points.length===0} onClick={this.reset.bind(this)}>Reset path</Button>\r\n                    <Button bsStyle=\"danger\" onClick={this.onCancel.bind(this)}>Cancel</Button>\r\n                    <Button type=\"submit\" bsStyle=\"success\">{this.state.points.length>=2? 'Save' : 'Delete path'}</Button>\r\n                  </ButtonGroup>\r\n                </center>\r\n              </Alert>\r\n            </FormGroup>\r\n            <FormGroup controlId=\"formControlsImage\">\r\n              <svg viewBox={\"0 0 \" + this.state.w + \" \" + this.state.h} onClick={this.addPoint.bind(this)} onMouseMove={this.handleMouseMove.bind(this)}>\r\n                <image ref=\"buldreinfo-svg-edit-img\" xlinkHref={config.getUrl(`images?id=${this.state.mediaId}`)} width=\"100%\" height=\"100%\"/>\r\n                {this.parseReadOnlySvgs()}\r\n                <path className=\"buldreinfo-svg-route\" d={path} strokeWidth={0.002*this.state.w}/>\r\n                {circles}\r\n              </svg>\r\n            </FormGroup>\r\n            <FormGroup controlId=\"formControlsPath\">\r\n              {path}\r\n            </FormGroup>\r\n          </form>\r\n        </Well>\r\n      </span>\r\n    )\r\n  }\r\n}\r\n"],"sourceRoot":""}