(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{624:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(1),i=p(r),o=p(n(628)),s=(p(n(16)),n(137)),l=n(265),u=n(674),c=p(n(191)),d=p(n(192)),h=n(267),f=p(n(138));function p(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;d.default.get(c.default.getUrl("problems?regionId="+c.default.getRegion()+"&id="+this.props.match.params.problemId)).withCredentials().end(function(t,n){if(t)e.setState({error:t});else{var a=n.body[0].media.filter(function(t){return t.id==e.props.match.params.mediaId})[0],r=[],i=0,o=[];if(a.svgs){var s=!0,l=!1,u=void 0;try{for(var c,d=a.svgs[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;h.problemId===n.body[0].id?(i=h.id,o=e.parsePath(h.path)):r.push({nr:h.nr,hasAnchor:h.hasAnchor,path:h.path})}}catch(t){l=!0,u=t}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}}e.setState({mediaId:a.id,nr:n.body[0].nr,w:a.width,h:a.height,ctrl:!1,svgId:i,points:o,readOnlySvgs:r,activePoint:0,draggedPoint:!1,draggedCubic:!1,hasAnchor:!0,areaId:n.body[0].areaId,areaName:n.body[0].areaName,areaVisibility:n.body[0].areaVisibility,sectorId:n.body[0].sectorId,sectorName:n.body[0].sectorName,sectorVisibility:n.body[0].sectorVisibility,id:n.body[0].id,name:n.body[0].name,grade:n.body[0].grade,visibility:n.body[0].visibility})}}),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.removeEventListener("keyup",this.handleKeyUp.bind(this))}},{key:"handleKeyDown",value:function(e){e.ctrlKey&&this.setState({ctrl:!0})}},{key:"handleKeyUp",value:function(e){e.ctrlKey||this.setState({ctrl:!1})}},{key:"setHasAnchor",value:function(e){this.setState({hasAnchor:e})}},{key:"onCancel",value:function(){window.history.back()}},{key:"save",value:function(e){var t=this;e.preventDefault(),d.default.post(c.default.getUrl("problems/svg?problemId="+this.state.id+"&mediaId="+this.state.mediaId)).withCredentials().send({delete:this.state.points.length<2,id:this.state.svgId,path:this.generatePath(),hasAnchor:this.state.hasAnchor}).end(function(e,n){e?t.setState({error:e}):t.setState({pushUrl:"/problem/"+t.state.id})})}},{key:"cancelDragging",value:function(e){this.setState({draggedPoint:!1,draggedCubic:!1})}},{key:"getMouseCoords",value:function(e){var t=this.refs["buldreinfo-svg-edit-img"].getBoundingClientRect(),n=this.state.w/t.width,a=this.state.h/t.height;return{x:Math.round((e.clientX-t.left)*n),y:Math.round((e.clientY-t.top)*a)}}},{key:"addPoint",value:function(e){if(this.state.ctrl){var t=this.getMouseCoords(e),n=this.state.points;n.push(t),this.setState({points:n,activePoint:n.length-1})}}},{key:"generatePath",value:function(){var e="";return this.state.points.forEach(function(t,n){0===n?e+="M ":t.q?e+="Q "+t.q.x+" "+t.q.y+" ":t.c?e+="C "+t.c[0].x+" "+t.c[0].y+" "+t.c[1].x+" "+t.c[1].y+" ":t.a?e+="A "+t.a.rx+" "+t.a.ry+" "+t.a.rot+" "+t.a.laf+" "+t.a.sf+" ":e+="L ",e+=t.x+" "+t.y+" "}),e}},{key:"handleMouseMove",value:function(e){return e.preventDefault(),this.state.ctrl||(this.state.draggedPoint?this.setPointCoords(this.getMouseCoords(e)):!1!==this.state.draggedCubic&&this.setCubicCoords(this.getMouseCoords(e),this.state.draggedCubic)),!1}},{key:"setPointCoords",value:function(e){var t=this.state.points,n=this.state.activePoint;t[n].x=e.x,t[n].y=e.y,this.setState({points:t})}},{key:"setCubicCoords",value:function(e,t){var n=this.state.points,a=this.state.activePoint;n[a].c[t].x=e.x,n[a].c[t].y=e.y,this.setState({points:n})}},{key:"setDraggedPoint",value:function(e){this.state.ctrl||this.setState({activePoint:e,draggedPoint:!0})}},{key:"setDraggedCubic",value:function(e,t){this.state.ctrl||this.setState({activePoint:e,draggedCubic:t})}},{key:"setPointType",value:function(e){var t=this.state.points,n=this.state.activePoint;if(0!==n){switch(e){case"L":t[n]={x:t[n].x,y:t[n].y};break;case"C":t[n]={x:t[n].x,y:t[n].y,c:[{x:(t[n].x+t[n-1].x-50)/2,y:(t[n].y+t[n-1].y)/2},{x:(t[n].x+t[n-1].x+50)/2,y:(t[n].y+t[n-1].y)/2}]}}this.setState({points:t})}}},{key:"removeActivePoint",value:function(e){var t=this.state.points,n=this.state.activePoint;t.length>1&&0!==n&&(t.splice(n,1),this.setState({points:t,activePoint:t.length-1}))}},{key:"reset",value:function(e){this.setState({ctrl:!1,points:[],activePoint:0,draggedPoint:!1,draggedCubic:!1,hasAnchor:!1})}},{key:"parseReadOnlySvgs",value:function(){var e=[],t=!0,n=!1,a=void 0;try{for(var r,o=this.state.readOnlySvgs[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;e.push(i.default.createElement("path",{key:e.length,d:s.path,className:"buldreinfo-svg-opacity buldreinfo-svg-route",strokeWidth:.003*this.state.w,strokeDasharray:.006*this.state.w}));var l=(0,u.parseSVG)(s.path);(0,u.makeAbsolute)(l),e.push(this.generateSvgNrAndAnchor(l,s.nr,s.hasAnchor))}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}return e}},{key:"generateSvgNrAndAnchor",value:function(e,t,n){for(var a,r,o=0,s=99999999,l=0,u=e.length;l<u;l++)e[l].y>o&&(a=l,o=e[l].y),e[l].y<s&&(r=l,s=e[l].y);var c=e[a].x,d=e[a].y,h=.012*this.state.w;c<h&&(c=h),c>this.state.w-h&&(c=this.state.w-h),d<h&&(d=h),d>this.state.h-h&&(d=this.state.h-h);var f=null;return!0===n&&(f=i.default.createElement("circle",{className:"buldreinfo-svg-ring",cx:e[r].x,cy:e[r].y,r:.006*this.state.w})),i.default.createElement("g",{className:"buldreinfo-svg-opacity"},i.default.createElement("circle",{className:"buldreinfo-svg-ring",cx:c,cy:d,r:h}),i.default.createElement("text",{className:"buldreinfo-svg-routenr",x:c,y:d,fontSize:.02*this.state.w},t),f)}},{key:"parsePath",value:function(e){if(e){var t=(0,u.parseSVG)(e);return(0,u.makeAbsolute)(t),t.map(function(e){switch(e.code){case"L":case"M":return{x:Math.round(e.x),y:Math.round(e.y)};case"C":return{x:Math.round(e.x),y:Math.round(e.y),c:[{x:Math.round(e.x1),y:Math.round(e.y1)},{x:Math.round(e.x2),y:Math.round(e.y2)}]};case"S":return{x:Math.round(e.x),y:Math.round(e.y),c:[{x:Math.round(e.x0),y:Math.round(e.y0)},{x:Math.round(e.x2),y:Math.round(e.y2)}]}}})}return[]}},{key:"render",value:function(){var e=this;if(!this.state)return i.default.createElement("center",null,i.default.createElement(f.default,{icon:"spinner",spin:!0,size:"3x"}));if(this.state.error)return i.default.createElement("span",null,i.default.createElement("h3",null,this.state.error.status),this.state.error.toString());if(this.state.pushUrl)return i.default.createElement(h.Redirect,{to:this.state.pushUrl,push:!0});var t=this.state.points.map(function(t,n,a){var r=[];return t.c&&r.push(i.default.createElement("g",{className:"buldreinfo-svg-edit-opacity"},i.default.createElement("line",{className:"buldreinfo-svg-pointer buldreinfo-svg-route",x1:a[n-1].x,y1:a[n-1].y,x2:t.c[0].x,y2:t.c[0].y,strokeWidth:.0026*e.state.w,strokeDasharray:.003*e.state.w}),i.default.createElement("line",{className:"buldreinfo-svg-pointer buldreinfo-svg-route",x1:t.x,y1:t.y,x2:t.c[1].x,y2:t.c[1].y,strokeWidth:.0026*e.state.w,strokeDasharray:.003*e.state.w}),i.default.createElement("circle",{className:"buldreinfo-svg-pointer buldreinfo-svg-ring",cx:t.c[0].x,cy:t.c[0].y,r:.003*e.state.w,onMouseDown:e.setDraggedCubic.bind(e,n,0)}),i.default.createElement("circle",{className:"buldreinfo-svg-pointer buldreinfo-svg-ring",cx:t.c[1].x,cy:t.c[1].y,r:.003*e.state.w,onMouseDown:e.setDraggedCubic.bind(e,n,1)}))),i.default.createElement("g",{className:"buldreinfo-svg-ring-group"+(e.state.activePoint===n?"  is-active":"")},r,i.default.createElement("circle",{className:"buldreinfo-svg-pointer buldreinfo-svg-ring",cx:t.x,cy:t.y,r:.003*e.state.w,onMouseDown:e.setDraggedPoint.bind(e,n)}))}),n=this.generatePath();return i.default.createElement("span",null,i.default.createElement(o.default,null,i.default.createElement("title",null,c.default.getTitle("Problem edit (SVG)")),i.default.createElement("meta",{name:"description",content:"Edit topo"})),i.default.createElement(l.Breadcrumb,null,i.default.createElement(s.Link,{to:"/"},"Home")," / ",i.default.createElement(s.Link,{to:"/browse"},"Browse")," / ",i.default.createElement(s.Link,{to:"/area/"+this.state.areaId},this.state.areaName)," ",1===this.state.areaVisibility&&i.default.createElement(f.default,{icon:"lock"}),2===this.state.areaVisibility&&i.default.createElement(f.default,{icon:"user-secret"})," / ",i.default.createElement(s.Link,{to:"/sector/"+this.state.sectorId},this.state.sectorName)," ",1===this.state.sectorVisibility&&i.default.createElement(f.default,{icon:"lock"}),2===this.state.sectorVisibility&&i.default.createElement(f.default,{icon:"user-secret"})," / ",i.default.createElement(s.Link,{to:"/problem/"+this.state.id},this.state.nr," ",this.state.name," ",this.state.grade)," ",1===this.state.visibility&&i.default.createElement(f.default,{icon:"lock"}),2===this.state.visibility&&i.default.createElement(f.default,{icon:"user-secret"})),i.default.createElement(l.Well,{bsSize:"small",onMouseUp:this.cancelDragging.bind(this),onMouseLeave:this.cancelDragging.bind(this)},i.default.createElement("form",{onSubmit:this.save.bind(this)},i.default.createElement(l.FormGroup,{controlId:"formControlsInfo"},i.default.createElement(l.Alert,{bsStyle:"info"},i.default.createElement("center",null,i.default.createElement("strong",null,"CTRL + CLICK")," to add a point | ",i.default.createElement("strong",null,"CLICK")," to select a point | ",i.default.createElement("strong",null,"CLICK AND DRAG")," to move a point",i.default.createElement("br",null),i.default.createElement(l.ButtonGroup,null,0!==this.state.activePoint&&i.default.createElement(l.DropdownButton,{title:this.state.points[this.state.activePoint].c?"Selected point: Curve to":"Selected point: Line to",id:"bg-nested-dropdown"},i.default.createElement(l.MenuItem,{eventKey:"0",onSelect:this.setPointType.bind(this,"L")},"Selected point: Line to"),i.default.createElement(l.MenuItem,{eventKey:"1",onSelect:this.setPointType.bind(this,"C")},"Selected point: Curve to")),0!==this.state.activePoint&&i.default.createElement(l.Button,{onClick:this.removeActivePoint.bind(this)},"Remove this point"),i.default.createElement(l.DropdownButton,{title:!0===this.state.hasAnchor?"Route has anchor":"No anchor on route",disabled:0===this.state.points.length,id:"bg-nested-dropdown"},i.default.createElement(l.MenuItem,{eventKey:"0",onSelect:this.setHasAnchor.bind(this,!1)},"No anchor on route"),i.default.createElement(l.MenuItem,{eventKey:"1",onSelect:this.setHasAnchor.bind(this,!0)},"Route has anchor")),i.default.createElement(l.Button,{bsStyle:"warning",disabled:0===this.state.points.length,onClick:this.reset.bind(this)},"Reset path"),i.default.createElement(l.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),i.default.createElement(l.Button,{type:"submit",bsStyle:"success"},this.state.points.length>=2?"Save":"Delete path"))))),i.default.createElement(l.FormGroup,{controlId:"formControlsImage"},i.default.createElement("svg",{viewBox:"0 0 "+this.state.w+" "+this.state.h,onClick:this.addPoint.bind(this),onMouseMove:this.handleMouseMove.bind(this)},i.default.createElement("image",{ref:"buldreinfo-svg-edit-img",xlinkHref:c.default.getUrl("images?id="+this.state.mediaId),width:"100%",height:"100%"}),this.parseReadOnlySvgs(),i.default.createElement("path",{className:"buldreinfo-svg-route",d:n,strokeWidth:.002*this.state.w}),t)),i.default.createElement(l.FormGroup,{controlId:"formControlsPath"},n))))}}]),t}();t.default=y},627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(190)),r=f(n(3)),i=f(n(79)),o=f(n(4)),s=f(n(5)),l=n(1),u=f(l),c=f(n(0)),d=f(n(16)),h=n(631);function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"extractChildren",value:function(){var e=this.context.extract;e&&e(this.props.children)}},{key:"handleChildrens",value:function(){var e=this,t=this.props.children;if(!this.context.extract){var n=u.default.createElement("div",{className:"react-head-temp"},t),a=document.createElement("div");d.default.render(n,a,function(){var t=a.innerHTML;if(e.lastChildStr!==t){e.lastChildStr=t;var n=Array.prototype.slice.call(a.querySelector(".react-head-temp").children),r=document.head,i=r.innerHTML;(n=n.filter(function(e){return-1===i.indexOf((0,h.getDomAsString)(e))})).forEach(function(e){var t=e.tagName.toLowerCase();if("title"===t){var n=(0,h.getDuplicateTitle)();n&&(0,h.removeChild)(r,n)}else if("meta"===t){var a=(0,h.getDuplicateMeta)(e);a&&(0,h.removeChild)(r,a)}else if("link"===t&&"canonical"===e.rel){var i=(0,h.getDuplicateCanonical)(e);i&&(0,h.removeChild)(r,i)}}),(0,h.appendChild)(document.head,n)}})}}},{key:"componentDidMount",value:function(){this.handleChildrens()}},{key:"componentDidUpdate",value:function(e){e.children!==this.props.children&&this.handleChildrens()}},{key:"render",value:function(){return this.extractChildren(),null}}]),t}(l.Component);p.contextTypes={extract:c.default.func},t.default=p},628:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactTitle=t.MetaTagsContext=t.MetaTags=void 0;var a=o(n(630)),r=o(n(627)),i=o(n(632));function o(e){return e&&e.__esModule?e:{default:e}}t.default=r.default,t.MetaTags=r.default,t.MetaTagsContext=a.default,t.ReactTitle=i.default},630:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(190)),r=c(n(3)),i=c(n(79)),o=c(n(4)),s=c(n(5)),l=n(1),u=c(n(0));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getChildContext",value:function(){return{extract:this.props.extract}}},{key:"render",value:function(){return l.Children.only(this.props.children)}}]),t}(l.Component);d.childContextTypes={extract:u.default.func},t.default=d},631:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(2)),r=i(n(139));function i(e){return e&&e.__esModule?e:{default:e}}t.extractMetaAndTitle=function(e){var t=void 0,n=void 0,r=[];return e=(e=(e=e.replace(l,function(e){return t=e,""})).replace(s,function(e){return n=e,""})).replace(o,function(e){return r.push((0,a.default)({},function(e){var t={};if(!e)return t;for(var n=u.exec(e);null!==n;)t[n[1]]=n[3]||n[4]||n[5],n=u.exec(e);return t}(e),{_tagString:e})),""}),{title:t,metas:r,canonicalLink:n,rest:e}},t.removeDuplicateMetas=function(e){for(var t={},n={},a={},r=[],i=e.length-1;i>=0;i--){var o=e[i],s=o.id,l=o.property,u=o.name,c=!1;if(s)c=!a[s];else if(l||u){var d=t[l]||n[u];c=!d||d.id}s&&(a[s]=o),l&&(t[l]=o),u&&(n[u]=o),c&&r.push(o)}return r},t.getDuplicateTitle=function(){return document.head.querySelectorAll("title")},t.getDuplicateCanonical=function(){return document.head.querySelectorAll('link[rel="canonical"]')},t.getDuplicateMeta=function(e){var t=document.head,n=e.id,a=e.property,r=e.name;return n?n&&t.querySelector("#"+n):r?c(t.querySelectorAll('[name = "'+r+'"]')):a?c(t.querySelectorAll('[property = "'+a+'"]')):null},t.appendChild=function(e,t){void 0===t.length&&(t=[t]);for(var n=document.createDocumentFragment(),a=0,r=t.length;a<r;a++)n.appendChild(t[a]);e.appendChild(n)},t.removeChild=function(e,t){void 0===t.length&&(t=[t]);for(var n=0,a=t.length;n<a;n++)e.removeChild(t[n])},t.getDomAsString=function(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML};var o=/<meta[^<>]*?=(['"].*?['"]|[^<>]*?)*?\/?>/g,s=/<link[^<>]*?rel=['"]canonical['"].*?(\/>|<\/link>)/g,l=/<title[^<>]*?>(.*?)<\/title>/g,u=/(\S*?)=("(.*?)"|'(.*?)'|([^<>\s]*))/g;function c(e){return(e=(0,r.default)(e||[])).filter(function(e){return!e.id})}},632:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(190)),r=h(n(3)),i=h(n(79)),o=h(n(4)),s=h(n(5)),l=n(1),u=h(l),c=h(n(0)),d=h(n(627));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return u.default.createElement(d.default,null,u.default.createElement("title",null,this.props.title))}}]),t}(l.Component);f.propTypes={title:c.default.string},t.default=f}}]);
//# sourceMappingURL=22.index.js.map