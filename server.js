!function(t){var e={};function a(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=35)}([function(t,e){t.exports=require("react")},function(t,e){t.exports=require("react-bootstrap")},function(t,e){t.exports=require("@fortawesome/react-fontawesome")},function(t,e){t.exports=require("react-router-dom")},function(t,e){t.exports=require("react-bootstrap-table")},function(t,e){t.exports=require("react-meta-tags")},function(t,e){t.exports=require("react-google-maps")},function(t,e){t.exports=require("react-router")},function(t,e){t.exports=require("react-router-bootstrap")},function(t,e){t.exports=require("@fortawesome/fontawesome-svg-core")},function(t,e){t.exports=require("@fortawesome/free-solid-svg-icons")},function(t,e){t.exports=require("svg-path-parser")},function(t,e){t.exports=require("react-cookie")},function(t,e){t.exports=require("react-input-calendar")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("serialize-javascript")},function(t,e){t.exports=require("react-avatar")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("react-dom/server")},function(t,e){t.exports=require("react-meta-tags/server")},function(t,e){t.exports=require("react-dom")},function(t,e){t.exports=require("prop-types")},function(t,e){t.exports=require("react-google-maps/lib/components/addons/MarkerClusterer")},function(t,e){t.exports=require("react-image-gallery")},function(t,e){t.exports=require("react-player")},function(t,e){t.exports=require("object-fit-images")},function(t,e){t.exports=require("isomorphic-fetch")},function(t,e){t.exports=require("react-dropzone")},function(t,e){t.exports=require("react-select/lib/Creatable")},function(t,e){t.exports=require("react-select/lib/Async")},function(t,e){t.exports=require("react-select")},function(t,e){t.exports=require("auth0-js")},function(t,e){t.exports=require("es6-promise")},function(t,e){t.exports=require("react-ga")},function(t,e){t.exports=require("universal-cookie-express")},function(t,e,a){"use strict";a.r(e);var n=a(14),r=a.n(n),o=a(17),i=a.n(o),s=a(0),l=a.n(s),c=a(18),m=a(3),p=a(15),u=a.n(p),d=a(12),h=a(19),f=a.n(h),g=a(5),y=a.n(g),b=a(20),E=a.n(b),v=a(21),w=a(1),C=a(8),S=a(7),k=a(6),I=a(22),A=a.n(I),F=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=function(t){function e(e){return t.call(this,e)||this}return F(e,t),e.prototype.componentDidMount=function(){var t=this;navigator.geolocation.getCurrentPosition(function(e){t.setState({currLat:e.coords.latitude,currLng:e.coords.longitude})})},e.prototype.handleOnClick=function(t){this.setState({pushUrl:t})},e.prototype.render=function(){var t=this;if(this.state&&this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});var e=Object(k.withScriptjs)(Object(k.withGoogleMap)(function(e){var a=null;t.props.markers&&(a=t.props.markers.map(function(e,a){var n=null;return e.icon&&(n={},e.icon.url&&(n.url=e.icon.url),e.icon.scaledSizeW&&e.icon.scaledSizeH&&(n.scaledSize=new google.maps.Size(e.icon.scaledSizeW,e.icon.scaledSizeH)),e.icon.labelOriginX&&e.icon.labelOriginY&&(n.labelOrigin=new google.maps.Point(e.icon.labelOriginX,e.icon.labelOriginY))),l.a.createElement(k.Marker,{icon:n,key:a,position:{lat:e.lat,lng:e.lng},label:e.label,title:e.title,clickable:!0,onClick:t.handleOnClick.bind(t,e.url)})})),t.state&&t.state.currLat&&t.state.currLng&&t.state.currLat>0&&t.state.currLng>0&&a.push(l.a.createElement(k.Marker,{key:-1,icon:"https://maps.gstatic.com/mapfiles/markers2/measle_blue.png",position:{lat:t.state.currLat,lng:t.state.currLng}}));var n=null;return t.props.polygons&&(n=t.props.polygons.map(function(e,a){return l.a.createElement(k.Polygon,{key:a,paths:e.triangleCoords,options:{strokeColor:"#FF3300",strokeOpacity:.5,strokeWeight:2,fillColor:"#FF3300",fillOpacity:.15},onClick:t.handleOnClick.bind(t,e.url)})})),l.a.createElement(k.GoogleMap,{defaultZoom:t.props.defaultZoom,defaultCenter:t.props.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN},l.a.createElement(A.a,{averageCenter:!1,minimumClusterSize:60,enableRetinaIcons:!1,imagePath:"https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m",gridSize:60},a,n))}));return l.a.createElement("section",{style:{height:"600px"}},l.a.createElement(e,{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyCpaVd5518yMB-oiIyP5JnTVWMfrOv4sAI&v=3.exp",loadingElement:l.a.createElement("div",{style:{height:"100%"}}),containerElement:l.a.createElement("div",{style:{height:"100%"}}),mapElement:l.a.createElement("div",{style:{height:"100%"}})}))},e}(s.Component),M=a(23),_=a.n(M),T=a(24),O=a.n(T),P=a(11),L=a(25),N=a.n(L),j=a(2),D=a(26),B=a.n(D);function G(t,e,a,n,r){for(var o,i,s=0,c=99999999,m=0,p=t.length;m<p;m++)t[m].y>s&&(o=m,s=t[m].y),t[m].y<c&&(i=m,c=t[m].y);var u=t[o].x,d=t[o].y,h=.012*n;u<h&&(u=h),u>n-h&&(u=n-h),d<h&&(d=h),d>r-h&&(d=r-h);var f=null;return!0===a&&(f=l.a.createElement("circle",{className:"buldreinfo-svg-ring",cx:t[i].x,cy:t[i].y,r:.006*n})),l.a.createElement("g",{className:"buldreinfo-svg-opacity"},l.a.createElement("circle",{className:"buldreinfo-svg-ring",cx:u,cy:d,r:h}),l.a.createElement("text",{className:"buldreinfo-svg-routenr",x:u,y:d,fontSize:.02*n},e),f)}function R(t){if(t){var e=Object(P.parseSVG)(t);return Object(P.makeAbsolute)(e),e.map(function(t){switch(t.code){case"L":case"M":return{x:Math.round(t.x),y:Math.round(t.y)};case"C":return{x:Math.round(t.x),y:Math.round(t.y),c:[{x:Math.round(t.x1),y:Math.round(t.y1)},{x:Math.round(t.x2),y:Math.round(t.y2)}]};case"S":return{x:Math.round(t.x),y:Math.round(t.y),c:[{x:Math.round(t.x0),y:Math.round(t.y0)},{x:Math.round(t.x2),y:Math.round(t.y2)}]}}})}return[]}function U(t){var e=global.myOrigin;return"http://localhost:3000"===e&&(e="https://buldreinfo.com"),encodeURI((e||"")+"/com.buldreinfo.jersey.jaxb/v2"+t)}function V(t,e,a){return(a=a||{}).headers=a.headers||{},a.mode="cors",t&&(a.headers.Authorization="Bearer "+t),B()(U(e),a)}function H(t,e){return U(e?"/images?id="+t+"&targetHeight="+e:"/images?id="+t)}function q(t){var e=t.getDate(),a=t.getMonth()+1;return t.getFullYear()+"-"+(a<=9?"0"+a:a)+"-"+(e<=9?"0"+e:e)}function K(t){return V(t,"/meta",null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}function z(t,e){return V(t,"/problems?id="+e,null).then(function(t){return t.json()}).then(function(t){return t[0]}).catch(function(t){return console.warn(t),null})}function W(t,e){return V(t,"/users?id="+e,null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}function Y(t,e){return V(t,"/users/search?value="+e,null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}function Z(t,e,a,n,r,o,i,s){return V(t,"/ticks",{method:"POST",body:JSON.stringify({delete:e,id:a,idProblem:n,comment:r,date:o,stars:i,grade:s}),headers:{"Content-Type":"application/json"}})}a(32).polyfill();var J=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),X=function(t){function e(e){var a=t.call(this,e)||this;return a.state={mediaIndex:0,hoverTrash:!1,hoverEdit:!1,showFullscreenButton:!0,showGalleryFullscreenButton:!0,showPlayButton:!0,showGalleryPlayButton:!1,showVideo:{},isFullscreen:!1,pushUrl:null},a}return J(e,t),e.prototype.componentWillReceiveProps=function(t){this.setState({mediaIndex:0,hoverTrash:!1,hoverEdit:!1,showFullscreenButton:!0,showGalleryFullscreenButton:!0,showPlayButton:!0,showGalleryPlayButton:!1,showVideo:{},isFullscreen:!1,pushUrl:null}),this.imageGallery&&this.imageGallery.slideToIndex(0)},e.prototype.toggleHoverTrash=function(){this.setState({hoverTrash:!this.state.hoverTrash})},e.prototype.toggleHoverEdit=function(){this.setState({hoverEdit:!this.state.hoverEdit})},e.prototype.onDeleteImage=function(t){var e=this;if(confirm("Are you sure you want to delete this image?")){var a=this.props.media[this.state.mediaIndex].id;(function(t,e){return V(t,"/media?id="+e,{method:"DELETE"})})(this.props.auth.getAccessToken(),a).then(function(t){if(e.props.media.length>1&&e.state.mediaIndex>=e.props.media.length-1){var n=e.state.mediaIndex-1;e.setState({mediaIndex:n}),e.imageGallery.slideToIndex(n)}e.props.removeMedia(a)}).catch(function(t){console.warn(t)})}},e.prototype.onSlide=function(t){this.resetVideo(),this.setState({mediaIndex:t})},e.prototype.onScreenChange=function(t){this.setState({isFullscreen:t})},e.prototype.resetVideo=function(){this.setState({showVideo:{}}),this.state.showPlayButton&&this.setState({showGalleryPlayButton:!0}),this.state.showFullscreenButton&&this.setState({showGalleryFullscreenButton:!0})},e.prototype.toggleShowVideo=function(t){this.state.showVideo[t]=!Boolean(this.state.showVideo[t]),this.setState({showVideo:this.state.showVideo}),this.state.showVideo[t]&&(this.state.showPlayButton&&this.setState({showGalleryPlayButton:!1}),this.state.showFullscreenButton&&this.setState({showGalleryFullscreenButton:!1}))},e.prototype.renderVideo=function(t){var e=this;return l.a.createElement("div",{className:"image-gallery-image"},this.state.showVideo[t.embedUrl]?l.a.createElement("span",null,l.a.createElement("a",{className:"gallery-close-video",onClick:this.toggleShowVideo.bind(this,t.embedUrl)}),l.a.createElement(O.a,{ref:function(t){e.player=t},className:"react-player",width:"100%",height:"100%",url:t.embedUrl,onDuration:function(t){return e.setState({duration:t})},onStart:function(){return e.player.seekTo(parseFloat(t.seekTo)/e.state.duration.toFixed(1))},controls:!0,playing:!0})):l.a.createElement("a",{onClick:this.toggleShowVideo.bind(this,t.embedUrl)},l.a.createElement("div",{className:"gallery-play-button"}),l.a.createElement("img",{src:t.original,alt:this.props.alt})))},e.prototype.pushUrl=function(t){this.setState({pushUrl:t})},e.prototype.generateShapes=function(t,e,a,n){var r=this;return t.map(function(t,o){var i,s=Object(P.parseSVG)(t.path);Object(P.makeAbsolute)(s);for(var c,m=0,p=99999999,u=0,d=s.length;u<d;u++)s[u].y>m&&(i=u,m=s[u].y),s[u].y<p&&(c=u,p=s[u].y);var h=s[i].x,f=s[i].y,g=.012*a;h<g&&(h=g),h>a-g&&(h=a-g),f<g&&(f=g),f>n-g&&(f=n-g);var y=null;return t.hasAnchor&&(y=l.a.createElement("circle",{className:"buldreinfo-svg-ring",cx:s[c].x,cy:s[c].y,r:.006*a})),l.a.createElement("g",{className:"buldreinfo-svg-pointer buldreinfo-svg-hover"+(0===e||t.problemId===e?"":" buldreinfo-svg-opacity"),key:o,onClick:r.pushUrl.bind(r,"/problem/"+t.problemId)},l.a.createElement("path",{d:t.path,className:"buldreinfo-svg-route",strokeWidth:.003*a,strokeDasharray:.006*a}),l.a.createElement("circle",{className:"buldreinfo-svg-ring",cx:h,cy:f,r:g}),l.a.createElement("text",{className:"buldreinfo-svg-routenr",x:h,y:f,fontSize:.02*a,dy:".3em"},t.nr),y)})},e.prototype.renderImage=function(t){return t.svgs?l.a.createElement("div",{className:"image-gallery-image"},l.a.createElement("canvas",{className:"buldreinfo-svg-canvas-ie-hack",width:t.width,height:t.height}),l.a.createElement("svg",{className:"buldreinfo-svg",viewBox:"0 0 "+t.width+" "+t.height,preserveAspectRatio:"xMidYMid meet"},l.a.createElement("image",{xlinkHref:H(t.id,null),width:"100%",height:"100%"}),this.generateShapes(t.svgs,t.svgProblemId,t.width,t.height))):l.a.createElement("div",{className:"image-gallery-image"},l.a.createElement("img",{src:H(t.id,null),className:"buldreinfo-scale-img",alt:this.props.alt}))},e.prototype.render=function(){var t=this;if(N()(null,{watchMQ:!0}),this.state&&this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});var e=this.props.media.map(function(e,a){return 1==e.idType?{original:H(e.id,null),thumbnail:H(e.id,null),originalClass:"featured-slide",thumbnailClass:"featured-thumb",originalAlt:"original-alt",thumbnailAlt:"thumbnail-alt",renderItem:t.renderImage.bind(t,e)}:{original:H(e.id,null),thumbnail:H(e.id,null),originalClass:"featured-slide",thumbnailClass:"featured-thumb",originalAlt:"original-alt",thumbnailAlt:"thumbnail-alt",embedUrl:"https://buldreinfo.com/buldreinfo_media/mp4/"+100*Math.floor(e.id/100)+"/"+e.id+".mp4",seekTo:e.t,renderItem:t.renderVideo.bind(t)}}),a=null,n=this.props.media[this.state.mediaIndex];return!this.state.isFullscreen&&1==n.idType&&this.props.isAdmin&&(n.svgProblemId>0?a=l.a.createElement("span",{style:{position:"absolute",zIndex:4,background:"rgba(0, 0, 0, 0.4)",padding:"8px 20px"}},l.a.createElement(m.Link,{to:"/problem/svg-edit/"+n.svgProblemId+"-"+n.id,onMouseEnter:this.toggleHoverEdit.bind(this),onMouseLeave:this.toggleHoverEdit.bind(this)},l.a.createElement(j.FontAwesomeIcon,{icon:"edit",style:this.state.hoverEdit?{transform:"scale(1.1)",color:"#fff"}:{color:"#fff"}}))):n.svgs||(a=l.a.createElement("span",{style:{position:"absolute",zIndex:4,background:"rgba(0, 0, 0, 0.4)",padding:"8px 20px"}},l.a.createElement("a",{href:"#",onMouseEnter:this.toggleHoverTrash.bind(this),onMouseLeave:this.toggleHoverTrash.bind(this),onClick:this.onDeleteImage.bind(this)},l.a.createElement(j.FontAwesomeIcon,{icon:"trash",style:this.state.hoverTrash?{transform:"scale(1.1)",color:"#fff"}:{color:"#fff"}}))))),l.a.createElement(w.Well,{className:"app"},a,l.a.createElement(_.a,{ref:function(e){return t.imageGallery=e},items:e,onSlide:this.onSlide.bind(this),onScreenChange:this.onScreenChange.bind(this),showThumbnails:this.props.showThumbnails,showBullets:this.state.showFullscreenButton&&this.state.showGalleryFullscreenButton&&this.props.media.length>1,showIndex:this.state.showFullscreenButton&&this.state.showGalleryFullscreenButton,showPlayButton:!1,showFullscreenButton:this.state.showFullscreenButton&&this.state.showGalleryFullscreenButton}))},e}(s.Component);function Q(t){return 1===t.visibility?l.a.createElement(j.FontAwesomeIcon,{icon:"lock"}):2===t.visibility?l.a.createElement(j.FontAwesomeIcon,{icon:"user-secret"}):null}var $=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.render=function(){var t="";if(this.props.sector.comment)if(this.props.sector.comment.length>100){var e=l.a.createElement(w.Tooltip,{id:this.props.sector.id},this.props.sector.comment);t=l.a.createElement(w.OverlayTrigger,{key:this.props.sector.id,placement:"top",overlay:e},l.a.createElement("span",null,this.props.sector.comment.substring(0,100)+"..."))}else t=this.props.sector.comment;return l.a.createElement("tr",null,l.a.createElement("td",null,l.a.createElement(m.Link,{to:"/sector/"+this.props.sector.id},this.props.sector.name)," ",l.a.createElement(Q,{visibility:this.props.sector.visibility})),l.a.createElement("td",null,t),l.a.createElement("td",null,this.props.sector.numProblems))},e}(s.Component),et=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a,tabIndex:1},n}return $(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.areaId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.areaId===this.props.match.params.areaId||this.refresh(this.props.match.params.areaId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.handleTabsSelection=function(t){this.setState({tabIndex:t})},e.prototype.onRemoveMedia=function(t){var e=this.state.data.media.filter(function(e){return e.id!=t});this.setState({media:e})},e.prototype.render=function(){if(!this.state.data)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var t=this.state.data.sectors.map(function(t,e){return l.a.createElement(tt,{sector:t,key:e})}),e=this.state.data.sectors.filter(function(t){return 0!=t.lat&&0!=t.lng}).map(function(t){return{lat:t.lat,lng:t.lng,title:t.name,icon:{url:"https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png",scaledSizeW:32,scaledSizeH:32},url:"/sector/"+t.id}}),a=this.state.data.sectors.filter(function(t){return t.polygonCoords}).map(function(t){return{triangleCoords:t.polygonCoords.split(";").map(function(t,e){var a=t.split(",");return{lat:parseFloat(a[0]),lng:parseFloat(a[1])}}),url:"/sector/"+t.id}}),n=this.state.data.lat&&this.state.data.lat>0?{lat:this.state.data.lat,lng:this.state.data.lng}:this.state.data.metadata.defaultCenter,r=this.state.data.lat&&this.state.data.lat>0?14:this.state.data.metadata.defaultZoom,o=e.length>0||a.length>0?l.a.createElement(x,{markers:e,polygons:a,defaultCenter:n,defaultZoom:r}):null,i=this.state.data.media&&this.state.data.media.length>0?l.a.createElement(X,{auth:this.props.auth,isAdmin:this.state.data.metadata.isAdmin,alt:this.state.data.name,media:this.state.data.media,showThumbnails:this.state.data.media.length>1,removeMedia:this.onRemoveMedia.bind(this)}):null,s=null;return o&&i?s=l.a.createElement(w.Tabs,{activeKey:this.state.tabIndex,animation:!1,onSelect:this.handleTabsSelection.bind(this),id:"area_tab",unmountOnExit:!0},l.a.createElement(w.Tab,{eventKey:1,title:"Topo"},1==this.state.tabIndex&&i),l.a.createElement(w.Tab,{eventKey:2,title:"Map"},2==this.state.tabIndex&&o)):o?s=o:i&&(s=i),l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,this.state.data.metadata.canonical&&l.a.createElement("link",{rel:"canonical",href:this.state.data.metadata.canonical}),l.a.createElement("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(this.state.data.metadata.jsonLd)}}),l.a.createElement("title",null,this.state.data.metadata.title),l.a.createElement("meta",{name:"description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:url",content:this.state.data.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:this.state.data.metadata.title}),l.a.createElement("meta",{property:"og:image",content:this.state.data.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:this.state.data.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:this.state.data.metadata.og.imageHeight})),l.a.createElement(w.Breadcrumb,null,this.state.data.metadata.isAdmin?l.a.createElement("div",{style:{float:"right"}},l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:"Add sector"},"Add sector")},l.a.createElement(C.LinkContainer,{to:{pathname:"/sector/edit/-1",query:{idArea:this.state.data.id,lat:this.state.data.lat,lng:this.state.data.lng}}},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"plus-square",inverse:!0})))),l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:this.state.data.id},"Edit area")},l.a.createElement(C.LinkContainer,{to:{pathname:"/area/edit/"+this.state.data.id,query:{lat:this.state.data.lat,lng:this.state.data.lng}}},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"edit",inverse:!0})))))):null,l.a.createElement(m.Link,{to:"/"},"Home")," / ",l.a.createElement(m.Link,{to:"/browse"},"Browse")," / ",this.state.data.name," ",l.a.createElement(Q,{visibility:this.state.data.visibility})),s,this.state.data.comment?l.a.createElement(w.Well,null,l.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.data.comment}})):null,l.a.createElement(w.Table,{striped:!0,condensed:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Name"),l.a.createElement("th",null,"Description"),l.a.createElement("th",null,"#problems"))),l.a.createElement("tbody",null,t)))},e}(s.Component),at=a(27),nt=a.n(at),rt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),ot=function(t){function e(e){var a=t.call(this,e)||this;return a.state={searchResults:[],value:""},a}return rt(e,t),e.prototype.componentWillReceiveProps=function(t){this.setState({value:t.value})},e.prototype.inputChange=function(t){var e=this,a=t.target.value;this.props.onValueChanged(this.props.m,a),a.length>0?Y(this.props.accessToken,a).then(function(t){var n=t.filter(function(t){return t.name.toUpperCase()!==a.toUpperCase()});e.setState({searchResults:n})}):this.setState({searchResults:[]})},e.prototype.menuItemSelect=function(t,e){this.setState({searchResults:[]}),this.props.onValueChanged(this.props.m,t.name)},e.prototype.render=function(){var t=this,e=null;if(this.state.searchResults.length>0){var a=this.state.searchResults.map(function(e,a){return l.a.createElement(w.MenuItem,{key:a,href:"#",onSelect:t.menuItemSelect.bind(t,e)},e.name)});e=l.a.createElement("div",null,l.a.createElement("ul",{className:"dropdown-menu open",style:{position:"absolute",display:"inline"}},a))}return l.a.createElement("div",{style:{position:"relative",width:"100%"}},l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(w.FormControl,{style:{display:"inline-block"},type:"text",placeholder:this.props.placeholder,value:this.state.value,onChange:this.inputChange.bind(this)})),e)},e}(s.Component),it=function(t){function e(e){var a=t.call(this,e)||this;return a.state={media:[]},a}return rt(e,t),e.prototype.onDrop=function(t){var e=this.state.media;t.forEach(function(t){return e.push({file:t})}),this.setState({media:e}),this.props.onMediaChanged(e)},e.prototype.onPhotographerChanged=function(t,e){t.photographer=e,this.props.onMediaChanged(this.state.media)},e.prototype.onInPhotoChanged=function(t,e){t.inPhoto=e,this.props.onMediaChanged(this.state.media)},e.prototype.onRemove=function(t){var e=this.state.media.filter(function(e){return e!=t});this.setState({media:e}),this.props.onMediaChanged(e)},e.prototype.render=function(){var t=this,e=this.props.auth.getAccessToken();return l.a.createElement(w.FormGroup,null,l.a.createElement(w.ControlLabel,null,"Upload image(s)"),l.a.createElement("br",null),l.a.createElement(nt.a,{onDrop:this.onDrop.bind(this),style:{width:"220px",height:"75px",padding:"15px",borderWidth:"1px",borderColor:"#666",borderStyle:"dashed",borderRadius:"5px"},accept:"image/*"},l.a.createElement("i",null,"Drop JPG-image(s) here or click to select files to upload.")),this.state.media.length>0?l.a.createElement(w.Grid,null,l.a.createElement(w.Row,null,this.state.media.map(function(a,n){return l.a.createElement(w.Col,{key:n,xs:8,sm:6,md:4,lg:2},l.a.createElement(w.Thumbnail,{src:a.file.preview},l.a.createElement(ot,{accessToken:e,m:a,placeholder:"In photo",value:a?a.inPhoto:"",onValueChanged:t.onInPhotoChanged.bind(t)}),l.a.createElement(ot,{accessToken:e,m:a,placeholder:"Photographer",value:a?a.photographer:"",onValueChanged:t.onPhotographerChanged.bind(t)}),l.a.createElement(w.Button,{style:{width:"100%"},bsStyle:"danger",onClick:t.onRemove.bind(t,a)},"Remove")))}))):null)},e}(s.Component),st=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),lt=Object(k.withScriptjs)(Object(k.withGoogleMap)(function(t){return l.a.createElement(k.GoogleMap,{defaultZoom:t.defaultZoom,defaultCenter:t.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN,onClick:t.onClick.bind(void 0)},t.markers)})),ct=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a},n}return st(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.areaId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.areaId===this.props.match.params.areaId||this.refresh(this.props.match.params.areaId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.onNameChanged=function(t){var e=this.state.data;e.name=t.target.value,this.setState({data:e})},e.prototype.onVisibilityChanged=function(t,e){var a=this.state.data;a.visibility=t,this.setState({data:a})},e.prototype.onCommentChanged=function(t){var e=this.state.data;e.comment=t.target.value,this.setState({data:e})},e.prototype.onNewMediaChanged=function(t){var e=this.state.data;e.newMedia=t,this.setState({data:e})},e.prototype.save=function(t){var e=this;t.preventDefault(),this.setState({isSaving:!0}),function(t,e,a,n,r,o,i,s){var l=new FormData,c=s.map(function(t){return{name:t.file.name.replace(/[^-a-z0-9.]/gi,"_"),photographer:t.photographer,inPhoto:t.inPhoto}});return l.append("json",JSON.stringify({id:e,visibility:a,name:n,comment:r,lat:o,lng:i,newMedia:c})),s.forEach(function(t){return l.append(t.file.name.replace(/[^-a-z0-9.]/gi,"_"),t.file)}),V(t,"/areas",{method:"POST",body:l,headers:{Accept:"application/json"}}).then(function(t){return t.json()})}(this.props.auth.getAccessToken(),this.state.data.id,this.state.data.visibility,this.state.data.name,this.state.data.comment,this.state.data.lat,this.state.data.lng,this.state.data.newMedia).then(function(t){e.setState({pushUrl:"/area/"+t.id})}).catch(function(t){console.warn(t),e.setState({error:t})})},e.prototype.onMarkerClick=function(t){var e=this.state.data;e.lat=t.latLng.lat(),e.lng=t.latLng.lng(),this.setState({data:e})},e.prototype.onCancel=function(){window.history.back()},e.prototype.render=function(){if(this.state.error)return l.a.createElement("h3",null,this.state.error.toString());if(this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});if(!(this.props&&this.props.match&&this.props.match.params&&this.props.match.params.areaId))return l.a.createElement("span",null,l.a.createElement("h3",null,"Invalid action..."));if(!this.state.data)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));this.state.data.metadata.isAdmin||this.setState({pushUrl:"/login",error:null});var t="Visible for everyone";1===this.state.data.visibility?t="Only visible for administrators":2===this.state.data.visibility&&(t="Only visible for super administrators");var e=this.props&&this.props.location&&this.props.location.query&&this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?{lat:parseFloat(this.props.location.query.lat),lng:parseFloat(this.props.location.query.lng)}:this.state.data.metadata.defaultCenter,a=this.props&&this.props.location&&this.props.location.query&&this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?8:this.state.data.metadata.defaultZoom;return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,this.state.data.metadata.title)),l.a.createElement(w.Well,null,l.a.createElement("form",{onSubmit:this.save.bind(this)},l.a.createElement(w.FormGroup,{controlId:"formControlsName"},l.a.createElement(w.ControlLabel,null,"Area name"),l.a.createElement(w.FormControl,{type:"text",value:this.state.data.name,placeholder:"Enter name",onChange:this.onNameChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsComment"},l.a.createElement(w.ControlLabel,null,"Comment"),l.a.createElement(w.FormControl,{style:{height:"100px"},componentClass:"textarea",placeholder:"Enter comment",value:this.state.data.comment,onChange:this.onCommentChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsVisibility"},l.a.createElement(w.ControlLabel,null,"Visibility"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:t,id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{eventKey:"0",onSelect:this.onVisibilityChanged.bind(this,0)},"Visible for everyone"),l.a.createElement(w.MenuItem,{eventKey:"1",onSelect:this.onVisibilityChanged.bind(this,1)},"Only visible for administrators"),this.state.data.metadata.isSuperAdmin&&l.a.createElement(w.MenuItem,{eventKey:"2",onSelect:this.onVisibilityChanged.bind(this,2)},"Only visible for super administrators"))),l.a.createElement(w.FormGroup,{controlId:"formControlsMedia"},l.a.createElement(it,{auth:this.props.auth,onMediaChanged:this.onNewMediaChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsMap"},l.a.createElement(w.ControlLabel,null,"Click to mark area center on map"),l.a.createElement("br",null),l.a.createElement("section",{style:{height:"600px"}},l.a.createElement(lt,{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyCpaVd5518yMB-oiIyP5JnTVWMfrOv4sAI&v=3.exp",loadingElement:l.a.createElement("div",{style:{height:"100%"}}),containerElement:l.a.createElement("div",{style:{height:"100%"}}),mapElement:l.a.createElement("div",{style:{height:"100%"}}),defaultZoom:a,defaultCenter:e,onClick:this.onMarkerClick.bind(this),markers:0!=this.state.data.lat&&0!=this.state.data.lng?l.a.createElement(k.Marker,{position:{lat:this.state.data.lat,lng:this.state.data.lng}}):""}))),l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),l.a.createElement(w.Button,{type:"submit",bsStyle:"success",disabled:this.state.isSaving},this.state.isSaving?"Saving...":"Save area")))))},e}(s.Component),mt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),pt=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a},n}return mt(e,t),e.prototype.componentDidMount=function(){var t=this;navigator.geolocation.getCurrentPosition(function(e){t.setState({currLat:e.coords.latitude,currLng:e.coords.longitude})}),this.state.data||this.props.fetchInitialData(this.props.auth.getAccessToken()).then(function(e){return t.setState(function(){return{data:e}})})},e.prototype.toRad=function(t){return t*Math.PI/180},e.prototype.calcCrow=function(t,e,a,n){var r=this.toRad(a-t),o=this.toRad(n-e),i=this.toRad(t),s=this.toRad(a),l=Math.sin(r/2)*Math.sin(r/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(i)*Math.cos(s);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},e.prototype.render=function(){var t=this;if(!this.state||!this.state.data)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var e=this.state.data.areas.filter(function(t){return 0!=t.lat&&0!=t.lng}).map(function(t){return{lat:t.lat,lng:t.lng,title:t.name,label:t.name.charAt(0),url:"/area/"+t.id}}),a=e.length>0?l.a.createElement(x,{markers:e,defaultCenter:this.state.data.metadata.defaultCenter,defaultZoom:this.state.data.metadata.defaultZoom}):null,n=this.state.data.areas.map(function(e,a){var n=null;return t.state.currLat>0&&t.state.currLng>0&&e.lat>0&&e.lng>0&&(n=t.calcCrow(t.state.currLat,t.state.currLng,e.lat,e.lng).toFixed(1)+" km"),l.a.createElement("tr",{key:a},l.a.createElement("td",null,l.a.createElement(m.Link,{to:"/area/"+e.id},e.name)," ",l.a.createElement(Q,{visibility:e.visibility})),l.a.createElement("td",null,e.numSectors),l.a.createElement("td",null,e.numProblems),l.a.createElement("td",null,n))});return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,this.state.data.metadata.title),l.a.createElement("meta",{name:"description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:url",content:this.state.data.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:this.state.data.metadata.title}),l.a.createElement("meta",{property:"og:image",content:this.state.data.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:this.state.data.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:this.state.data.metadata.og.imageHeight})),l.a.createElement(w.Breadcrumb,null,this.state.data.metadata.isAdmin&&l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:"Add area"},"Add area")},l.a.createElement("div",{style:{float:"right"}},l.a.createElement(C.LinkContainer,{to:"/area/edit/-1"},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"plus-square",inverse:!0}))))),l.a.createElement(m.Link,{to:"/"},"Home")," / Browse"),a,l.a.createElement(w.Table,{striped:!0,condensed:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Name"),l.a.createElement("th",null,"#sectors"),l.a.createElement("th",null,"#problems"),l.a.createElement("th",null,l.a.createElement(j.FontAwesomeIcon,{icon:"plane"})))),l.a.createElement("tbody",null,n)))},e}(s.Component),ut=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ut(e,t),e.prototype.componentDidMount=function(){if(/access_token|id_token|error/.test(window.location.hash)){this.props.auth.handleAuthentication();var t=localStorage.getItem("redirect")||"/";localStorage.removeItem("redirect"),this.setState({pushUrl:t})}},e.prototype.render=function(){return this.state&&this.state.pushUrl?l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0}):l.a.createElement(w.Well,null,"Signing in, please wait...")},e}(s.Component),ht=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),ft=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a},n}return ht(e,t),e.prototype.componentDidMount=function(){var t=this;this.state.data||this.props.fetchInitialData(this.props.auth.getAccessToken()).then(function(e){return t.setState(function(){return{data:e}})})},e.prototype.render=function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,this.state.data&&l.a.createElement("title",null,"Ethics | "+this.state.data.metadata.title),l.a.createElement("meta",{name:"description",content:"Ethics and privacy policy"})),l.a.createElement(w.Breadcrumb,null,l.a.createElement(m.Link,{to:"/"},"Home")," / Ethics"),l.a.createElement(w.Well,null,"If you're going out climbing, we ask you to please follow these guidelines for the best possible bouldering experience now, and for the future generations of climbers.",l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("ul",null,l.a.createElement("li",null,"Show respect for the landowners, issue care and be polite."),l.a.createElement("li",null,"Follow paths where possible, and do not cross cultivated land."),l.a.createElement("li",null,"Take your trash back with you."),l.a.createElement("li",null,"Park with reason, and think of others. Make room for potential tractors and such if necessary."),l.a.createElement("li",null,"Start where directed, and don't hesitate to ask if your unsure."),l.a.createElement("li",null,"Sit start means that the behind should be the last thing to leave the ground/crashpad."),l.a.createElement("li",null,"No chipping allowed."),l.a.createElement("li",null,"Remember climbing can be dangerous and always involves risk. Your safety is your own responsibility."),l.a.createElement("li",null,"Use common sense!"))),l.a.createElement(w.Well,null,l.a.createElement("h3",null,"Privacy Policy"),"We respect your privacy and handle your data with the care that we would expect our own data to be handled. We will never sell or pass on your information to any third party. You can delete any of your profile information at any time, ",l.a.createElement("a",{href:"mailto:jostein.oygarden@gmail.com"},"send us an e-mail")," with the data you want to delete. The Android app requests permissions like accounts and camera. Accounts are used to give you correct data according to your permissions in buldreinfo. The camera can be used inside the app to append new images to existing bouldering problems (pending approval by an administrator)."))},e}(s.Component),gt=a(4),yt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),bt=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a,tabIndex:1,currLat:0,currLng:0},n}return yt(e,t),e.prototype.toRad=function(t){return t*Math.PI/180},e.prototype.calcCrow=function(t,e,a,n){var r=this.toRad(a-t),o=this.toRad(n-e),i=this.toRad(t),s=this.toRad(a),l=Math.sin(r/2)*Math.sin(r/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(i)*Math.cos(s);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},e.prototype.componentDidMount=function(){var t=this;this.state.data||this.refresh(this.props.match.params.grade),navigator.geolocation.getCurrentPosition(function(e){t.setState({currLat:e.coords.latitude,currLng:e.coords.longitude})})},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.grade===this.props.match.params.grade||this.refresh(this.props.match.params.grade)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.handleTabsSelection=function(t){this.setState({tabIndex:t})},e.prototype.trClassFormat=function(t,e){return t.ticked?"success":""},e.prototype.formatAreaName=function(t,e){return l.a.createElement("span",null,l.a.createElement(m.Link,{to:"/area/"+e.areaId},e.areaName)," ",l.a.createElement(Q,{visibility:e.areaVisibility}))},e.prototype.formatSectorName=function(t,e){return l.a.createElement("span",null,l.a.createElement(m.Link,{to:"/sector/"+e.sectorId},e.sectorName)," ",l.a.createElement(Q,{visibility:e.sectorVisibility}))},e.prototype.formatName=function(t,e){return l.a.createElement("span",null,l.a.createElement(m.Link,{to:"/problem/"+e.id},e.name)," ",l.a.createElement(Q,{visibility:e.visibility}))},e.prototype.formatType=function(t,e){var a,n=e.t.subtype;switch(e.t.id){case 2:a=l.a.createElement("img",{height:"20",src:"/jpg/bolt.jpg",alt:n});break;case 3:a=l.a.createElement("img",{height:"20",src:"/jpg/trad.jpg",alt:n});break;case 4:a=l.a.createElement("img",{height:"20",src:"/jpg/mixed.jpg",alt:n});break;case 5:a=l.a.createElement("img",{height:"20",src:"/jpg/toprope.jpg",alt:n})}return l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Popover,{id:e.t.id,title:"Type"}," ",e.t.type+" - "+e.t.subType)},a)},e.prototype.formatFa=function(t,e){var a=e.fa?e.fa.map(function(t,e){var a=l.a.createElement(w.Tooltip,{id:e},t.firstname," ",t.surname);return l.a.createElement(w.OverlayTrigger,{key:e,placement:"top",overlay:a},l.a.createElement(C.LinkContainer,{key:e,to:"/user/"+t.id},l.a.createElement(w.Button,{key:e,bsStyle:"default"},t.initials)))}):[];return l.a.createElement(w.ButtonToolbar,null,l.a.createElement(w.ButtonGroup,{bsSize:"xsmall"},a))},e.prototype.formatStars=function(t,e){var a=null;if(.5===e.stars)a=l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"});else if(1===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}));else if(1.5===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"}));else if(2===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}));else if(2.5===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"}));else{if(3!==e.stars)return"";a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}))}return l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Popover,{id:"Guidelines",title:"Guidelines"},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Very nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Fantastic!")},a)},e.prototype.formatNumImages=function(t,e){return e.media?e.media.filter(function(t){return 1===t.idType}).length:0},e.prototype.formatNumMovies=function(t,e){return e.media?e.media.filter(function(t){return 2===t.idType}).length:0},e.prototype.formatDistance=function(t,e){return this.state.currLat>0&&this.state.currLng>0&&e.lat>0&&e.lng>0?this.calcCrow(this.state.currLat,this.state.currLng,e.lat,e.lng).toFixed(1)+" km":""},e.prototype.sortFa=function(t,e,a){var n=t.fa?t.fa[0].initials:"",r=e.fa?e.fa[0].initials:"";return"asc"===a?n.localeCompare(r):r.localeCompare(n)},e.prototype.sortNumImages=function(t,e,a){var n=t.media?t.media.filter(function(t){return 1===t.idType}).length:0,r=e.media?e.media.filter(function(t){return 1===t.idType}).length:0;return"asc"===a?n<r?-1:n>r?1:0:n<r?1:n>r?-1:0},e.prototype.sortNumMovies=function(t,e,a){var n=t.media?t.media.filter(function(t){return 2===t.idType}).length:0,r=e.media?e.media.filter(function(t){return 2===t.idType}).length:0;return"asc"===a?n<r?-1:n>r?1:0:n<r?1:n>r?-1:0},e.prototype.sortDistance=function(t,e,a){var n=this.state.currLat>0&&this.state.currLng>0&&t.lat>0&&t.lng>0?this.calcCrow(this.state.currLat,this.state.currLng,t.lat,t.lng):0,r=this.state.currLat>0&&this.state.currLng>0&&e.lat>0&&e.lng>0?this.calcCrow(this.state.currLat,this.state.currLng,e.lat,e.lng):0;return"asc"===a?n<r?-1:n>r?1:0:n<r?1:n>r?-1:0},e.prototype.render=function(){if(!this.state.data||!this.state.data.problems)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var t=this.state.data.problems.filter(function(t){return 0!=t.lat&&0!=t.lng}).map(function(t){return{lat:t.lat,lng:t.lng,title:t.nr+" - "+t.name+" ["+t.grade+"]",label:t.name.charAt(0),url:"/problem/"+t.id,icon:{url:t.ticked?"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-a.png":"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-b.png",labelOriginX:11,labelOriginY:13}}}),e=t.length>0?l.a.createElement(x,{markers:t,defaultCenter:this.state.data.metadata.defaultCenter,defaultZoom:7}):null,a=null;return a=this.state.data.metadata.isBouldering?l.a.createElement(gt.BootstrapTable,{data:this.state.data.problems,trClassName:this.trClassFormat.bind(this),condensed:!0,hover:!0,columnFilter:!1},l.a.createElement(gt.TableHeaderColumn,{dataField:"id",isKey:!0,hidden:!0},"id"),l.a.createElement(gt.TableHeaderColumn,{dataField:"areaName",dataSort:!0,dataFormat:this.formatAreaName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Area"),l.a.createElement(gt.TableHeaderColumn,{dataField:"sectorName",dataSort:!0,dataFormat:this.formatSectorName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Sector"),l.a.createElement(gt.TableHeaderColumn,{dataField:"name",dataSort:!0,dataFormat:this.formatName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Name"),l.a.createElement(gt.TableHeaderColumn,{dataField:"grade",dataSort:!0,dataAlign:"center",width:"70"},"Grade"),l.a.createElement(gt.TableHeaderColumn,{dataField:"fa",dataSort:!0,dataFormat:this.formatFa.bind(this),sortFunc:this.sortFa.bind(this),dataAlign:"center",width:"70"},"FA"),l.a.createElement(gt.TableHeaderColumn,{dataField:"numTicks",dataSort:!0,dataAlign:"center",width:"50"},"Ticks"),l.a.createElement(gt.TableHeaderColumn,{dataField:"stars",dataSort:!0,dataFormat:this.formatStars.bind(this),dataAlign:"center",width:"70"},"Stars"),l.a.createElement(gt.TableHeaderColumn,{dataField:"numImages",dataSort:!0,dataFormat:this.formatNumImages.bind(this),sortFunc:this.sortNumImages.bind(this),dataAlign:"center",width:"50"},l.a.createElement(j.FontAwesomeIcon,{icon:"camera"})),l.a.createElement(gt.TableHeaderColumn,{dataField:"numMovies",dataSort:!0,dataFormat:this.formatNumMovies.bind(this),sortFunc:this.sortNumMovies.bind(this),dataAlign:"center",width:"50"},l.a.createElement(j.FontAwesomeIcon,{icon:"video"})),l.a.createElement(gt.TableHeaderColumn,{dataField:"distance",dataSort:!0,dataFormat:this.formatDistance.bind(this),sortFunc:this.sortDistance.bind(this),dataAlign:"center",width:"60"},l.a.createElement(j.FontAwesomeIcon,{icon:"plane"}))):l.a.createElement(gt.BootstrapTable,{data:this.state.data.problems,trClassName:this.trClassFormat.bind(this),condensed:!0,hover:!0,columnFilter:!1},l.a.createElement(gt.TableHeaderColumn,{dataField:"id",isKey:!0,hidden:!0},"id"),l.a.createElement(gt.TableHeaderColumn,{dataField:"areaName",dataSort:!0,dataFormat:this.formatAreaName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Area"),l.a.createElement(gt.TableHeaderColumn,{dataField:"sectorName",dataSort:!0,dataFormat:this.formatSectorName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Sector"),l.a.createElement(gt.TableHeaderColumn,{dataField:"name",dataSort:!0,dataFormat:this.formatName.bind(this),width:"150",filter:{type:"TextFilter",placeholder:"Filter"}},"Name"),l.a.createElement(gt.TableHeaderColumn,{dataField:"type",dataFormat:this.formatType.bind(this),dataAlign:"center",width:"70"},"Type"),l.a.createElement(gt.TableHeaderColumn,{dataField:"grade",dataSort:!0,dataAlign:"center",width:"70"},"Grade"),l.a.createElement(gt.TableHeaderColumn,{dataField:"fa",dataSort:!0,dataFormat:this.formatFa.bind(this),sortFunc:this.sortFa.bind(this),dataAlign:"center",width:"70"},"FA"),l.a.createElement(gt.TableHeaderColumn,{dataField:"numTicks",dataSort:!0,dataAlign:"center",width:"50"},"Ticks"),l.a.createElement(gt.TableHeaderColumn,{dataField:"stars",dataSort:!0,dataFormat:this.formatStars.bind(this),dataAlign:"center",width:"70"},"Stars"),l.a.createElement(gt.TableHeaderColumn,{dataField:"numImages",dataSort:!0,dataFormat:this.formatNumImages.bind(this),sortFunc:this.sortNumImages.bind(this),dataAlign:"center",width:"50"},l.a.createElement(j.FontAwesomeIcon,{icon:"camera"})),l.a.createElement(gt.TableHeaderColumn,{dataField:"numMovies",dataSort:!0,dataFormat:this.formatNumMovies.bind(this),sortFunc:this.sortNumMovies.bind(this),dataAlign:"center",width:"50"},l.a.createElement(j.FontAwesomeIcon,{icon:"video"}))),l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,this.state.data.metadata.title),l.a.createElement("meta",{name:"description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:url",content:this.state.data.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:this.state.data.metadata.title}),l.a.createElement("meta",{property:"og:image",content:this.state.data.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:this.state.data.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:this.state.data.metadata.og.imageHeight})),l.a.createElement(w.Breadcrumb,null,l.a.createElement(m.Link,{to:"/"},"Home")," / Finder [",this.state.data.grade,"] (problems: ",this.state.data.problems.length,")"),e,a)},e}(s.Component),Et=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),vt=function(t){function e(e){var a=t.call(this,e)||this;return a.state={showAll:!1,btnLabel:"More"},a}return Et(e,t),e.prototype.handleOnClick=function(t){t.preventDefault(),!0===this.state.showAll?this.setState({showAll:!1,btnLabel:"More"}):this.setState({showAll:!0,btnLabel:"Less"})},e.prototype.render=function(){var t=!0===this.state.showAll?this.props.data:this.props.data.map(function(t,e){if(e<10)return t});return l.a.createElement("div",{style:{backgroundColor:"#FFF",position:"relative",padding:"45px 15px 15px",borderColor:"#e3e3e3",borderStyle:"solid",borderWidth:"1px",borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:"4px"}},t,l.a.createElement("div",{style:{position:"absolute",top:"15px",left:"15px",fontSize:"12px",fontWeight:700,color:"#959595",textTransform:"uppercase",letterSpacing:"1px"}},this.props.title),l.a.createElement("a",{style:{float:"right",display:"inline-block",position:"relative",right:"-16px",top:"15px",background:"#FFF",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px",border:"1px solid #e3e3e3",borderTop:"none",padding:"4px 8px",marginBottom:"20px"},href:"#",onClick:this.handleOnClick.bind(this)},this.state.btnLabel))},e}(s.Component),wt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Ct=function(t){function e(e){return t.call(this,e)||this}return wt(e,t),e.prototype.render=function(){var t=null;return this.props&&this.props.data?(t=this.props.data.inPhoto?l.a.createElement("i",null,"Photographer: ",l.a.createElement(m.Link,{to:"/user/"+this.props.data.idCreator},this.props.data.creator),", in photo: ",this.props.data.inPhoto):l.a.createElement("i",null,"Photographer: ",l.a.createElement(m.Link,{to:"/user/"+this.props.data.idCreator},this.props.data.creator)),l.a.createElement(w.Well,{style:{marginBottom:"15px",textAlign:"center"}},l.a.createElement("h4",null,l.a.createElement(m.Link,{to:"/problem/"+this.props.data.idProblem},this.props.data.problem)," ",this.props.data.grade),l.a.createElement(m.Link,{to:"/problem/"+this.props.data.idProblem},l.a.createElement("img",{style:{maxWidth:"100%"},src:H(this.props.data.idMedia,480),alt:this.props.data.problem})),l.a.createElement("br",null),t)):l.a.createElement(w.Well,{style:{marginBottom:"15px",textAlign:"center"}},"No data")},e}(s.Component),St=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),kt=function(t){function e(e){return t.call(this,e)||this}return St(e,t),e.prototype.render=function(){return l.a.createElement(l.a.Fragment,null,this.props.showLogoPlay&&l.a.createElement("a",{href:"https://play.google.com/store/apps/details?id=org.jossi.android.bouldering&pcampaignid=MKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1",rel:"noopener",target:"_blank"},l.a.createElement("img",{style:{maxWidth:"100%"},alt:"Get it on Google Play",src:"https://play.google.com/intl/en_us/badges/images/generic/en_badge_web_generic.png"})),this.props.showLogoSis&&l.a.createElement("a",{href:"http://sissportssenter.no/",rel:"noopener",target:"_blank"},l.a.createElement("img",{style:{marginBottom:"10px",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",borderBottomLeftRadius:"8px",borderBottomRightRadius:"8px",paddingLeft:"10px",paddingRight:"10px",maxWidth:"100%",backgroundColor:"#00A0E0"},src:"/png/sis-sportssenter.png",alt:"SiS Sportssenter"})),this.props.showLogoBrv&&l.a.createElement("a",{href:"http://brv.no/",rel:"noopener",target:"_blank"},l.a.createElement("img",{style:{marginBottom:"10px",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",borderBottomLeftRadius:"8px",borderBottomRightRadius:"8px",paddingLeft:"10px",paddingRight:"10px",maxWidth:"100%",backgroundColor:"#FFFFFF"},src:"/png/brv.png",alt:"Bratte Rogalands venner"})))},e}(s.Component),It=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),At=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a},n}return It(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh()},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated!==t.isAuthenticated&&this.refresh()},e.prototype.refresh=function(){var t=this;this.props.fetchInitialData(this.props.auth.getAccessToken()).then(function(e){return t.setState(function(){return{data:e}})})},e.prototype.render=function(){if(!this.state||!this.state.data)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var t=this.state.data.fas.map(function(t,e){return l.a.createElement("p",{key:e},l.a.createElement(m.Link,{to:"/problem/"+t.idProblem},t.problem)," ",t.grade," ",l.a.createElement(Q,{visibility:t.visibility}),l.a.createElement("br",null),l.a.createElement("small",{style:{color:"#777"}},l.a.createElement(m.Link,{to:"/area/"+t.idArea,style:{color:"#777"}},t.area)," ",l.a.createElement(Q,{visibility:t.areaVisibility})," / ",l.a.createElement(m.Link,{to:"/sector/"+t.idSector,style:{color:"#777"}},t.sector)," ",l.a.createElement(Q,{visibility:t.sectorVisibility})," ",t.date))}),e=this.state.data.ascents.map(function(t,e){return l.a.createElement("p",{key:e},l.a.createElement(m.Link,{to:"/problem/"+t.idProblem},t.problem)," ",t.grade," ",l.a.createElement(Q,{visibility:t.visibility}),l.a.createElement("br",null),l.a.createElement("small",{style:{color:"#777"}},l.a.createElement(m.Link,{to:"/user/"+t.idUser,style:{color:"#777"}},t.user)," ",t.date))}),a=this.state.data.medias.map(function(t,e){var a="image"===t.type?l.a.createElement(j.FontAwesomeIcon,{icon:"camera"}):l.a.createElement(j.FontAwesomeIcon,{icon:"video"});return l.a.createElement("p",{key:e},a," ",l.a.createElement(m.Link,{to:"/problem/"+t.idProblem},t.problem)," ",l.a.createElement("small",null,t.grade)," ",l.a.createElement(Q,{visibility:t.visibility}))}),n=this.state.data.comments.map(function(t,e){return l.a.createElement("p",{key:e},l.a.createElement("small",null,t.date)," ",l.a.createElement(m.Link,{to:"/problem/"+t.idProblem},t.problem)," ",l.a.createElement(Q,{visibility:t.visibility}))});return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,this.state.data.metadata.title),l.a.createElement("meta",{name:"description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:this.state.data.metadata.description}),l.a.createElement("meta",{property:"og:url",content:this.state.data.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:this.state.data.metadata.title}),l.a.createElement("meta",{property:"og:image",content:this.state.data.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:this.state.data.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:this.state.data.metadata.og.imageHeight})),l.a.createElement(w.Grid,null,l.a.createElement(w.Row,null,l.a.createElement(w.Well,{style:{textAlign:"center"}},"Total: ",this.state.data.numProblems," (",this.state.data.numProblemsWithCoordinates," with coordinates",this.state.data.numProblemsWithTopo>0?", "+this.state.data.numProblemsWithTopo+" on topo":"",") | Public ascents: ",this.state.data.numTicks," | Images: ",this.state.data.numImages," | Ascents on video: ",this.state.data.numMovies)),l.a.createElement(w.Row,null,l.a.createElement(w.Col,{xs:8,md:9,style:{paddingLeft:"3px",paddingRight:"3px"}},l.a.createElement(Ct,{data:this.state.data.randomMedia})),l.a.createElement(w.Col,{xs:4,md:3,style:{paddingLeft:"3px",paddingRight:"3px"}},l.a.createElement(kt,{showLogoPlay:this.state.data.showLogoPlay,showLogoSis:this.state.data.showLogoSis,showLogoBrv:this.state.data.showLogoBrv}))),l.a.createElement(w.Row,null,l.a.createElement(w.Col,{xs:6,lg:3,style:{paddingLeft:"3px",paddingRight:"3px"}},l.a.createElement(vt,{title:"Newest",data:t})),l.a.createElement(w.Col,{xs:6,lg:3,style:{paddingLeft:"3px",paddingRight:"3px"}},l.a.createElement(vt,{title:"Latest ascents",data:e})),l.a.createElement(w.Clearfix,{visibleXsBlock:!0}),l.a.createElement(w.Col,{xs:6,lg:3,style:{paddingLeft:"3px",paddingRight:"3px"}},l.a.createElement(vt,{title:"Newest media",data:a})),l.a.createElement(w.Col,{xs:6,lg:3,style:{paddingLeft:"3px",paddingRight:"3px"}},l.a.createElement(vt,{title:"Latest comments",data:n})))))},e}(s.Component),Ft=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ft(e,t),e.prototype.componentDidMount=function(){this.props.auth.logout(),this.setState({pushUrl:"/"})},e.prototype.render=function(){return this.state&&this.state.pushUrl?l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0}):l.a.createElement(w.Well,null,"Logging out, please wait...")},e}(s.Component),Mt=a(13),_t=a.n(Mt),Tt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Ot=function(t){function e(e){return t.call(this,e)||this}return Tt(e,t),e.prototype.refresh=function(t){var e=null;t.date?e=t.date:-1==t.idTick&&(e=q(new Date)),this.setState({idTick:t.idTick,idProblem:t.idProblem,date:e,comment:t.comment?t.comment:"",grade:t.grade,stars:t.stars?t.stars:0,grades:t.grades})},e.prototype.componentDidMount=function(){this.refresh(this.props)},e.prototype.componentWillReceiveProps=function(t){this.refresh(t)},e.prototype.onDateChanged=function(t){this.setState({date:t})},e.prototype.onCommentChanged=function(t){this.setState({comment:t.target.value})},e.prototype.onStarsChanged=function(t,e){this.setState({stars:t})},e.prototype.onGradeChanged=function(t,e){this.setState({grade:t})},e.prototype.delete=function(t){var e=this;Z(this.props.auth.getAccessToken(),!0,this.state.idTick,this.state.idProblem,this.state.comment,this.state.date,this.state.stars,this.state.grade).then(function(t){e.props.onHide()}).catch(function(t){console.warn(t),alert(t.toString())})},e.prototype.save=function(t){var e=this;Z(this.props.auth.getAccessToken(),!1,this.state.idTick,this.state.idProblem,this.state.comment,this.state.date,this.state.stars,this.state.grade).then(function(t){e.props.onHide()}).catch(function(t){console.warn(t),alert(t.toString())})},e.prototype.render=function(){var t=this,e=new Date;e.setDate(e.getDate()-1);var a="No stars";return this.state&&(1===this.state.stars?a=l.a.createElement("span",null,l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Nice"):2===this.state.stars?a=l.a.createElement("span",null,l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Very nice"):3===this.state.stars&&(a=l.a.createElement("span",null,l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Fantastic!"))),l.a.createElement(w.Modal,{show:this.props.show,onHide:this.props.onHide.bind(this)},l.a.createElement(w.Modal.Header,{closeButton:!0},l.a.createElement(w.Modal.Title,null,"Tick")),l.a.createElement(w.Modal.Body,null,l.a.createElement(w.FormGroup,null,l.a.createElement(w.ControlLabel,null,"Date (yyyy-mm-dd)"),l.a.createElement("br",null),l.a.createElement(_t.a,{format:"YYYY-MM-DD",computableFormat:"YYYY-MM-DD",date:this.state&&this.state.date,onChange:this.onDateChanged.bind(this)}),l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{onClick:this.onDateChanged.bind(this,q(e))},"Yesterday"),l.a.createElement(w.Button,{onClick:this.onDateChanged.bind(this,q(new Date))},"Today"))),l.a.createElement(w.FormGroup,null,l.a.createElement(w.ControlLabel,null,"Grade"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:this.state?this.state.grade:"Loading",id:"bg-nested-dropdown"},this.state&&this.state.grades&&this.state.grades.map(function(e,a){return l.a.createElement(w.MenuItem,{key:a,eventKey:a,onSelect:t.onGradeChanged.bind(t,e.grade)},e.grade)}))),l.a.createElement(w.FormGroup,null,l.a.createElement(w.ControlLabel,null,"Stars"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:a,id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{eventKey:"0",onSelect:this.onStarsChanged.bind(this,0)},"No stars"),l.a.createElement(w.MenuItem,{eventKey:"1",onSelect:this.onStarsChanged.bind(this,1)},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Nice"),l.a.createElement(w.MenuItem,{eventKey:"2",onSelect:this.onStarsChanged.bind(this,2)},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Very nice"),l.a.createElement(w.MenuItem,{eventKey:"3",onSelect:this.onStarsChanged.bind(this,3)},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Fantastic!"))),l.a.createElement(w.FormGroup,null,l.a.createElement(w.ControlLabel,null,"Comment"),l.a.createElement(w.FormControl,{componentClass:"textarea",placeholder:"textarea",style:{height:"100px"},value:this.state&&this.state.comment,onChange:this.onCommentChanged.bind(this)}))),l.a.createElement(w.Modal.Footer,null,l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{onClick:this.save.bind(this),bsStyle:"success"},"Save"),this.state&&this.state.idTick>1?l.a.createElement(w.Button,{onClick:this.delete.bind(this),bsStyle:"warning"},"Delete tick"):"",l.a.createElement(w.Button,{onClick:this.props.onHide.bind(this)},"Close"))))},e}(s.Component),Pt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pt(e,t),e.prototype.refresh=function(t){this.setState({idProblem:t.idProblem,comment:""})},e.prototype.componentDidMount=function(){this.refresh(this.props)},e.prototype.componentWillReceiveProps=function(t){this.refresh(t)},e.prototype.onCommentChanged=function(t){this.setState({comment:t.target.value})},e.prototype.save=function(t){var e=this;this.state.comment&&function(t,e,a){return V(t,"/comments",{method:"POST",body:JSON.stringify({idProblem:e,comment:a}),headers:{"Content-Type":"application/json"}})}(this.props.auth.getAccessToken(),this.state.idProblem,this.state.comment).then(function(t){e.props.onHide()}).catch(function(t){console.warn(t),alert(t.toString())})},e.prototype.render=function(){return l.a.createElement(w.Modal,{show:this.props.show,onHide:this.props.onHide.bind(this)},l.a.createElement(w.Modal.Header,{closeButton:!0},l.a.createElement(w.Modal.Title,null,"Add comment")),l.a.createElement(w.Modal.Body,null,l.a.createElement(w.FormGroup,{controlId:"formControlsTextArea"},l.a.createElement(w.ControlLabel,null,"Comment"),l.a.createElement(w.FormControl,{style:{height:"100px"},componentClass:"textarea",placeholder:"Comment",value:this.state&&this.state.comment,onChange:this.onCommentChanged.bind(this)}))),l.a.createElement(w.Modal.Footer,null,l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{onClick:this.save.bind(this),bsStyle:"success"},"Save"),l.a.createElement(w.Button,{onClick:this.props.onHide.bind(this)},"Close"))))},e}(s.Component),Nt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),jt=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a,tabIndex:1,showTickModal:!1,showCommentModal:!1},n}return Nt(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.problemId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.problemId===this.props.match.params.problemId||this.refresh(this.props.match.params.problemId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.handleTabsSelection=function(t){this.setState({tabIndex:t})},e.prototype.intersperse=function(t,e){return 0===t.length?[]:t.slice(1).reduce(function(t,a,n){return t.concat([e,a])},[t[0]])},e.prototype.closeTickModal=function(t){this.setState({showTickModal:!1}),this.refresh(this.props.match.params.problemId)},e.prototype.openTickModal=function(t){this.setState({showTickModal:!0})},e.prototype.closeCommentModal=function(t){this.setState({showCommentModal:!1}),this.refresh(this.props.match.params.problemId)},e.prototype.openCommentModal=function(t){this.setState({showCommentModal:!0})},e.prototype.onRemoveMedia=function(t){var e=this.state.data.media.filter(function(e){return e.id!=t});this.setState({media:e})},e.prototype.render=function(){var t=this.state.data;if(!t)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var e=[];t.lat>0&&t.lng>0&&e.push({lat:t.lat,lng:t.lng,title:t.name+" ["+t.grade+"]",label:t.name.charAt(0),url:"/problem/"+t.id,icon:{url:t.ticks&&t.ticks.filter(function(t){return t.writable}).length>0?"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-a.png":"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-b.png",labelOriginX:11,labelOriginY:13}}),t.sectorLat>0&&t.sectorLng>0&&e.push({lat:t.sectorLat,lng:t.sectorLng,title:"Parking",labelContent:t.sectorName,icon:{url:"https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png",scaledSizeW:32,scaledSizeH:32},url:"/sector/"+t.sectorId});var a=e.length>0?l.a.createElement(x,{markers:e,defaultCenter:{lat:e[0].lat,lng:e[0].lng},defaultZoom:16}):null,n=t.media&&t.media.length>0?l.a.createElement(X,{auth:this.props.auth,isAdmin:this.state.data.metadata.isAdmin,alt:t.name+" "+t.grade+" ("+t.areaName+" - "+t.sectorName+")",media:t.media,showThumbnails:!1,removeMedia:this.onRemoveMedia.bind(this)}):null,r=null;a&&n?r=l.a.createElement(w.Tabs,{activeKey:this.state.tabIndex,animation:!1,onSelect:this.handleTabsSelection.bind(this),id:"problem_tab",unmountOnExit:!0},l.a.createElement(w.Tab,{eventKey:1,title:"Media"},1==this.state.tabIndex&&n),l.a.createElement(w.Tab,{eventKey:2,title:"Map"},2==this.state.tabIndex&&a)):a?r=a:n&&(r=n);var o=t.fa?t.fa.map(function(t,e){return l.a.createElement(m.Link,{key:e,to:"/user/"+t.id},t.firstname," ",t.surname)}):[];o=this.intersperse(o,", ");var i=null;if(t.ticks){var s=t.ticks.map(function(t,e){var a=t.writable?"success":"",n=null;return.5===t.stars?n=l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"}):1===t.stars?n=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})):1.5===t.stars?n=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"})):2===t.stars?n=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})):2.5===t.stars?n=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"})):3===t.stars&&(n=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}))),n&&(n=l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Popover,{id:"Guidelines",title:"Guidelines"},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Very nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Fantastic!")},n)),l.a.createElement("tr",{className:a,key:e},l.a.createElement("td",null,t.date),l.a.createElement("td",null,l.a.createElement(m.Link,{to:"/user/"+t.idUser},t.name)),l.a.createElement("td",null,t.suggestedGrade),l.a.createElement("td",null,t.comment),l.a.createElement("td",null,n))});i=l.a.createElement(w.Table,{striped:!0,condensed:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"When"),l.a.createElement("th",null,"Name"),l.a.createElement("th",null,"Grade"),l.a.createElement("th",null,"Comment"),l.a.createElement("th",null,"Stars"))),l.a.createElement("tbody",null,s))}var c=null;if(t.comments){var p=t.comments.map(function(t,e){var a=l.a.createElement("span",null,l.a.createElement(m.Link,{to:"/user/"+t.idUser},t.name)," ",l.a.createElement("small",null,l.a.createElement("i",null,t.date)));return l.a.createElement(w.Panel,{key:e},l.a.createElement(w.Panel.Heading,null,a),l.a.createElement(w.Panel.Body,null,t.message))});c=l.a.createElement("span",null,p)}var u=null;if(t.sections){var d=t.sections.map(function(t,e){return l.a.createElement("tr",{key:e},l.a.createElement("td",null,t.nr),l.a.createElement("td",null,t.grade),l.a.createElement("td",null,t.description))});u=l.a.createElement("span",null,l.a.createElement("strong",null,"Sections:"),l.a.createElement("br",null),l.a.createElement(w.Table,{striped:!0,bordered:!0,condensed:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("td",null,"#"),l.a.createElement("td",null,"Grade"),l.a.createElement("td",null,"Description"))),l.a.createElement("tbody",null,d)))}var h=null;t.metadata&&t.metadata.isAuthenticated&&(h=l.a.createElement("div",{style:{float:"right"}},l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:"Tick problem"},"Tick problem")},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall",onClick:this.openTickModal.bind(this)},"Tick")),l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:"Add comment"},"Add comment")},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall",onClick:this.openCommentModal.bind(this)},l.a.createElement(j.FontAwesomeIcon,{icon:"comment",inverse:!0}))),t.metadata.isAdmin?l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:t.id},"Edit problem")},l.a.createElement(C.LinkContainer,{to:{pathname:"/problem/edit/"+t.id,query:{idSector:t.sectorId,lat:t.sectorLat,lng:t.sectorLng}}},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"edit",inverse:!0})))):l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:t.id},"Add image(s)")},l.a.createElement(C.LinkContainer,{to:{pathname:"/problem/edit/media/"+t.id}},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"image",inverse:!0})))))));this.props.auth.getAccessToken();var f=null;if(t.ticks){var g=t.ticks.filter(function(t){return t.writable});g&&g.length>0&&(f=l.a.createElement(Ot,{auth:this.props.auth,idTick:g[0].id,idProblem:t.id,date:g[0].date,comment:g[0].comment,grade:g[0].suggestedGrade,grades:t.metadata.grades,stars:g[0].stars,show:this.state.showTickModal,onHide:this.closeTickModal.bind(this)}))}return f||(f=l.a.createElement(Ot,{auth:this.props.auth,idTick:-1,idProblem:t.id,grade:t.originalGrade,grades:t.metadata.grades,show:this.state.showTickModal,onHide:this.closeTickModal.bind(this)})),l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,t.metadata.canonical&&l.a.createElement("link",{rel:"canonical",href:t.metadata.canonical}),l.a.createElement("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(t.metadata.jsonLd)}}),l.a.createElement("title",null,t.metadata.title),l.a.createElement("meta",{name:"description",content:t.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:t.metadata.description}),l.a.createElement("meta",{property:"og:url",content:t.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:t.metadata.title}),l.a.createElement("meta",{property:"og:image",content:t.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:t.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:t.metadata.og.imageHeight})),f,l.a.createElement(Lt,{auth:this.props.auth,idProblem:t.id,show:this.state.showCommentModal,onHide:this.closeCommentModal.bind(this)}),l.a.createElement(w.Breadcrumb,null,h,l.a.createElement(m.Link,{to:"/"},"Home")," / ",l.a.createElement(m.Link,{to:"/browse"},"Browse")," / ",l.a.createElement(m.Link,{to:"/area/"+t.areaId},t.areaName)," ",l.a.createElement(Q,{visibility:t.areaVisibility})," / ",l.a.createElement(m.Link,{to:"/sector/"+t.sectorId},t.sectorName)," ",l.a.createElement(Q,{visibility:t.sectorVisibility})," / ",t.name," ",t.grade," ",l.a.createElement(Q,{visibility:t.visibility})),r,l.a.createElement(w.Well,{bsSize:"small"},!t.metadata.isBouldering&&l.a.createElement("span",null,l.a.createElement("strong",null,"Type:")," ",t.t.type+" - "+t.t.subType,l.a.createElement("br",null)),l.a.createElement("strong",null,"Comment:")," ",t.comment,l.a.createElement("br",null),l.a.createElement("strong",null,"FA:")," ",o,l.a.createElement("br",null),l.a.createElement("strong",null,"FA date:")," ",t.faDateHr,l.a.createElement("br",null),l.a.createElement("strong",null,"Original grade:")," ",t.originalGrade,l.a.createElement("br",null),t.sectorLat>0&&t.sectorLng>0&&l.a.createElement("span",null,l.a.createElement("a",{href:"http://maps.google.com/maps?q=loc:"+t.sectorLat+","+t.sectorLng+"&navigate=yes",rel:"noopener",target:"_blank"},"Start navigation"),l.a.createElement("br",null)),u),i,c)},e}(s.Component),Dt=a(28),Bt=a.n(Dt),Gt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Rt=function(t){function e(e){var a=t.call(this,e)||this;return a.state={multiValue:e.users,options:[]},a}return Gt(e,t),e.prototype.componentDidMount=function(){var t=this;Y(this.props.auth.getAccessToken(),"").then(function(e){return t.setState({options:e.map(function(t){return{value:t.id,label:t.name}})})})},e.prototype.handleOnChange=function(t){this.props.onUsersUpdated(t),this.setState({multiValue:t})},e.prototype.isValidNewOption=function(t){return 0==this.state.options.filter(function(e){return e.label&&t.toLowerCase()===e.label.toLowerCase()}).length},e.prototype.render=function(){return l.a.createElement("div",{style:{position:"relative",width:"100%"}},l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(Bt.a,{isMulti:!0,options:this.state.options,onChange:this.handleOnChange.bind(this),isValidNewOption:this.isValidNewOption.bind(this),value:this.state.multiValue})))},e}(s.Component),Ut=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Vt=function(t){function e(e){var a=t.call(this,e)||this;return a.state={sections:e.sections,grades:e.grades},a}return Ut(e,t),e.prototype.onNumberOfSectionsChange=function(t){var e=null;if(t>1){for(e=this.state.sections?this.state.sections:[];t>e.length;)e.push({id:-1*e.length,nr:e.length+1,grade:"n/a",description:null});for(;t<e.length;)e.pop()}this.props.onSectionsUpdated(e),this.setState({sections:e})},e.prototype.onNrChanged=function(t,e){var a=this.state.sections;a.find(function(e){return e.id===t}).nr=e.target.value,this.props.onSectionsUpdated(a),this.setState({sections:a})},e.prototype.onGradeChanged=function(t,e){var a=this.state.sections;a.find(function(e){return e.id===t}).grade=e,this.props.onSectionsUpdated(a),this.setState({sections:a})},e.prototype.onDescriptionChanged=function(t,e){var a=this.state.sections;a.find(function(e){return e.id===t}).description=e.target.value,this.props.onSectionsUpdated(a),this.setState({sections:a})},e.prototype.render=function(){var t=this,e=this.state.sections&&this.state.sections.length>1&&this.state.sections.map(function(e,a){return l.a.createElement(w.Form,{componentClass:"fieldset",inline:!0,key:a},l.a.createElement(w.FormGroup,{controlId:"formNr"},l.a.createElement(w.FormControl,{type:"number",value:e.nr,onChange:t.onNrChanged.bind(t,e.id),style:{width:"50px"}}))," ",l.a.createElement(w.FormGroup,{controlId:"formGrade"},l.a.createElement(w.DropdownButton,{title:e.grade,id:"bg-nested-dropdown"},t.state.grades.map(function(a,n){return l.a.createElement(w.MenuItem,{key:n,eventKey:n,onSelect:t.onGradeChanged.bind(t,e.id,a.grade)},a.grade)})))," ",l.a.createElement(w.FormGroup,{controlId:"formDescription"},l.a.createElement(w.FormControl,{type:"text",value:e.description?e.description:"",onChange:t.onDescriptionChanged.bind(t,e.id),style:{width:"500px"}})))});return l.a.createElement(w.Well,null,l.a.createElement(w.FormGroup,{controlId:"formControlsNumSections"},l.a.createElement(w.DropdownButton,{title:this.state.sections?this.state.sections.length:1,id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{key:1,eventKey:1,onSelect:this.onNumberOfSectionsChange.bind(this,1)},"1"),l.a.createElement(w.MenuItem,{key:2,eventKey:2,onSelect:this.onNumberOfSectionsChange.bind(this,2)},"2"),l.a.createElement(w.MenuItem,{key:3,eventKey:3,onSelect:this.onNumberOfSectionsChange.bind(this,3)},"3"),l.a.createElement(w.MenuItem,{key:4,eventKey:4,onSelect:this.onNumberOfSectionsChange.bind(this,4)},"4"),l.a.createElement(w.MenuItem,{key:5,eventKey:5,onSelect:this.onNumberOfSectionsChange.bind(this,5)},"5"),l.a.createElement(w.MenuItem,{key:6,eventKey:6,onSelect:this.onNumberOfSectionsChange.bind(this,6)},"6"),l.a.createElement(w.MenuItem,{key:7,eventKey:7,onSelect:this.onNumberOfSectionsChange.bind(this,7)},"7"),l.a.createElement(w.MenuItem,{key:8,eventKey:8,onSelect:this.onNumberOfSectionsChange.bind(this,8)},"8"),l.a.createElement(w.MenuItem,{key:9,eventKey:9,onSelect:this.onNumberOfSectionsChange.bind(this,9)},"9"),l.a.createElement(w.MenuItem,{key:10,eventKey:10,onSelect:this.onNumberOfSectionsChange.bind(this,10)},"10"),l.a.createElement(w.MenuItem,{key:11,eventKey:11,onSelect:this.onNumberOfSectionsChange.bind(this,11)},"11"),l.a.createElement(w.MenuItem,{key:12,eventKey:12,onSelect:this.onNumberOfSectionsChange.bind(this,12)},"12"),l.a.createElement(w.MenuItem,{key:13,eventKey:13,onSelect:this.onNumberOfSectionsChange.bind(this,13)},"13"),l.a.createElement(w.MenuItem,{key:14,eventKey:14,onSelect:this.onNumberOfSectionsChange.bind(this,14)},"14"),l.a.createElement(w.MenuItem,{key:15,eventKey:15,onSelect:this.onNumberOfSectionsChange.bind(this,15)},"15"),l.a.createElement(w.MenuItem,{key:16,eventKey:16,onSelect:this.onNumberOfSectionsChange.bind(this,16)},"16"),l.a.createElement(w.MenuItem,{key:17,eventKey:17,onSelect:this.onNumberOfSectionsChange.bind(this,17)},"17"),l.a.createElement(w.MenuItem,{key:18,eventKey:18,onSelect:this.onNumberOfSectionsChange.bind(this,18)},"18"),l.a.createElement(w.MenuItem,{key:19,eventKey:19,onSelect:this.onNumberOfSectionsChange.bind(this,19)},"19"),l.a.createElement(w.MenuItem,{key:20,eventKey:20,onSelect:this.onNumberOfSectionsChange.bind(this,20)},"20"))),e)},e}(s.Component),Ht=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),qt=Object(k.withScriptjs)(Object(k.withGoogleMap)(function(t){return l.a.createElement(k.GoogleMap,{defaultZoom:t.defaultZoom,defaultCenter:t.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN,onClick:t.onClick.bind(void 0)},t.markers)})),Kt=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a},n}return Ht(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.problemId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.problemId===this.props.match.params.problemId||this.refresh(this.props.match.params.problemId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.onNameChanged=function(t){var e=this.state.data;e.name=t.target.value,this.setState({data:e})},e.prototype.onNrChanged=function(t){var e=this.state.data;e.nr=parseInt(t.target.value),this.setState({data:e})},e.prototype.onLatChanged=function(t){var e=this.state.data;e.lat=parseFloat(t.target.value),this.setState({data:e})},e.prototype.onLngChanged=function(t){var e=this.state.data;e.lng=parseFloat(t.target.value),this.setState({data:e})},e.prototype.onVisibilityChanged=function(t,e){var a=this.state.data;a.visibility=t,this.setState({data:a})},e.prototype.onCommentChanged=function(t){var e=this.state.data;e.comment=t.target.value,this.setState({data:e})},e.prototype.onFaDateChanged=function(t){var e=this.state.data;e.faDate=t,this.setState({data:e})},e.prototype.onOriginalGradeChanged=function(t,e){var a=this.state.data;a.originalGrade=t,this.setState({data:a})},e.prototype.onTypeIdChanged=function(t,e){var a=this.state.data;a.typeId=t,this.setState({data:a})},e.prototype.onNewMediaChanged=function(t){var e=this.state.data;e.newMedia=t,this.setState({data:e})},e.prototype.save=function(t){var e=this;t.preventDefault(),this.setState({isSaving:!0});var a=this.state.data;(function(t,e,a,n,r,o,i,s,l,c,m,p,u,d,h){var f=new FormData,g=h.map(function(t){return{name:t.file.name.replace(/[^-a-z0-9.]/gi,"_"),photographer:t.photographer,inPhoto:t.inPhoto}});return f.append("json",JSON.stringify({sectorId:e,id:a,visibility:n,name:r,comment:o,originalGrade:i,fa:s,faDate:l,nr:c,t:m,lat:p,lng:u,sections:d,newMedia:g})),h.forEach(function(t){return f.append(t.file.name.replace(/[^-a-z0-9.]/gi,"_"),t.file)}),V(t,"/problems",{method:"POST",body:f,headers:{Accept:"application/json"}}).then(function(t){return t.json()})})(this.props.auth.getAccessToken(),this.props.location.query.idSector,a.id,a.visibility,a.name,a.comment,a.originalGrade,a.fa,a.faDate,a.nr,a.typeId?a.metadata.types.find(function(t){return t.id===a.typeId}):a.metadata.types[0],a.lat,a.lng,a.sections,a.newMedia).then(function(t){e.setState({pushUrl:"/problem/"+t.id})}).catch(function(t){console.warn(t),e.setState({error:t})})},e.prototype.onMapClick=function(t){var e=this.state.data;e.lat=t.latLng.lat(),e.lng=t.latLng.lng(),this.setState({data:e})},e.prototype.onUsersUpdated=function(t){var e=this.state.data;e.fa=t.map(function(t){return{id:"string"==typeof t.value||t.value instanceof String?-1:t.value,firstname:t.label,surname:null}}),this.setState({data:e})},e.prototype.onSectionsUpdated=function(t){var e=this.state.data;e.sections=t,this.setState({data:e})},e.prototype.onCancel=function(){window.history.back()},e.prototype.render=function(){var t=this,e=this.state.data;if(this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});if(this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});if(!(this.props&&this.props.match&&this.props.match.params&&this.props.match.params.problemId&&this.props.location&&this.props.location.query&&this.props.location.query.idSector))return l.a.createElement("span",null,l.a.createElement("h3",null,"Invalid action..."));if(!e)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));e.metadata.isAdmin||this.setState({pushUrl:"/login",error:null});var a=new Date;a.setDate(a.getDate()-1);var n="Visible for everyone";1===e.visibility?n="Only visible for administrators":2===e.visibility&&(n="Only visible for super administrators");var r,o,i=e.typeId?e.metadata.types.find(function(t){return t.id===e.typeId}):e.metadata.types[0];0!=e.lat&&0!=e.lng?(r={lat:e.lat,lng:e.lng},o=15):this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?(r={lat:parseFloat(this.props.location.query.lat),lng:parseFloat(this.props.location.query.lng)},o=14):(r=e.metadata.defaultCenter,o=e.metadata.defaultZoom);var s=null;return e.metadata.isBouldering||(s=l.a.createElement(w.FormGroup,{controlId:"formControlsSections"},l.a.createElement(w.ControlLabel,null,"Section(s)"),l.a.createElement("br",null),l.a.createElement(Vt,{sections:e.sections,grades:e.metadata.grades,onSectionsUpdated:this.onSectionsUpdated.bind(this)}))),l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,e.metadata.title)),l.a.createElement(w.Well,null,l.a.createElement("form",{onSubmit:this.save.bind(this)},l.a.createElement(w.FormGroup,{controlId:"formControlsName"},l.a.createElement(w.ControlLabel,null,"Problem name"),l.a.createElement(w.FormControl,{type:"text",value:e.name,placeholder:"Enter name",onChange:this.onNameChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsFaDate"},l.a.createElement(w.ControlLabel,null,"FA date (yyyy-mm-dd)"),l.a.createElement("br",null),l.a.createElement(_t.a,{format:"YYYY-MM-DD",computableFormat:"YYYY-MM-DD",date:e.faDate,onChange:this.onFaDateChanged.bind(this)}),l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{onClick:this.onFaDateChanged.bind(this,q(a))},"Yesterday"),l.a.createElement(w.Button,{onClick:this.onFaDateChanged.bind(this,q(new Date))},"Today"))),l.a.createElement(w.FormGroup,{controlId:"formControlsTypeId"},l.a.createElement(w.ControlLabel,null,"Type"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:i.type+(i.subType?" - "+i.subType:""),id:"bg-nested-dropdown"},e.metadata.types.map(function(e,a){return l.a.createElement(w.MenuItem,{key:a,eventKey:a,onSelect:t.onTypeIdChanged.bind(t,e.id)},e.type," ",e.subType?" - "+e.subType:"")}))),l.a.createElement(w.FormGroup,{controlId:"formControlsGrade"},l.a.createElement(w.ControlLabel,null,"Grade"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:e.originalGrade,id:"bg-nested-dropdown"},e.metadata.grades.map(function(e,a){return l.a.createElement(w.MenuItem,{key:a,eventKey:a,onSelect:t.onOriginalGradeChanged.bind(t,e.grade)},e.grade)}))),l.a.createElement(w.FormGroup,{controlId:"formControlsFA"},l.a.createElement(w.ControlLabel,null,"FA"),l.a.createElement("br",null),l.a.createElement(Rt,{auth:this.props.auth,users:e.fa?e.fa.map(function(t){return{value:t.id,label:t.firstname+" "+t.surname}}):[],onUsersUpdated:this.onUsersUpdated.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsVisibility"},l.a.createElement(w.ControlLabel,null,"Visibility"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:n,id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{eventKey:"0",onSelect:this.onVisibilityChanged.bind(this,0)},"Visible for everyone"),l.a.createElement(w.MenuItem,{eventKey:"1",onSelect:this.onVisibilityChanged.bind(this,1)},"Only visible for administrators"),e.metadata.isSuperAdmin&&l.a.createElement(w.MenuItem,{eventKey:"2",onSelect:this.onVisibilityChanged.bind(this,2)},"Only visible for super administrators"))),l.a.createElement(w.FormGroup,{controlId:"formControlsSectorNr"},l.a.createElement(w.ControlLabel,null,"Sector number"),l.a.createElement(w.FormControl,{type:"text",value:e.nr,placeholder:"Enter sector number",onChange:this.onNrChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsComment"},l.a.createElement(w.ControlLabel,null,"Comment"),l.a.createElement(w.FormControl,{style:{height:"100px"},componentClass:"textarea",placeholder:"Enter comment",value:e.comment,onChange:this.onCommentChanged.bind(this)})),s,l.a.createElement(w.FormGroup,{controlId:"formControlsMedia"},l.a.createElement(it,{auth:this.props.auth,onMediaChanged:this.onNewMediaChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsMap"},l.a.createElement(w.ControlLabel,null,"Click to mark problem on map"),l.a.createElement("br",null),l.a.createElement("section",{style:{height:"600px"}},l.a.createElement(qt,{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyCpaVd5518yMB-oiIyP5JnTVWMfrOv4sAI&v=3.exp",loadingElement:l.a.createElement("div",{style:{height:"100%"}}),containerElement:l.a.createElement("div",{style:{height:"100%"}}),mapElement:l.a.createElement("div",{style:{height:"100%"}}),defaultZoom:o,defaultCenter:r,onClick:this.onMapClick.bind(this),markers:0!=e.lat&&0!=e.lng?l.a.createElement(k.Marker,{position:{lat:e.lat,lng:e.lng}}):""})),l.a.createElement(w.ControlLabel,null,"Latitude"),l.a.createElement(w.FormControl,{type:"text",value:e.lat,placeholder:"Latitude",onChange:this.onLatChanged.bind(this)}),l.a.createElement(w.ControlLabel,null,"Longitude"),l.a.createElement(w.FormControl,{type:"text",value:e.lng,placeholder:"Longitude",onChange:this.onLngChanged.bind(this)})),l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),l.a.createElement(w.Button,{type:"submit",bsStyle:"success",disabled:this.state.isSaving},this.state.isSaving?"Saving...":"Save problem")))))},e}(s.Component),zt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return zt(e,t),e.prototype.componentDidMount=function(){this.refresh(this.props.match.params.problemId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.problemId===this.props.match.params.problemId||this.refresh(this.props.match.params.problemId)},e.prototype.refresh=function(t){var e=this;z(this.props.auth.getAccessToken(),t).then(function(t){return e.setState({id:t.id,isAuthenticated:t.metadata.isAuthenticated})})},e.prototype.onNewMediaChanged=function(t){this.setState({newMedia:t})},e.prototype.save=function(t){var e=this;t.preventDefault(),this.setState({isSaving:!0}),function(t,e,a){var n=new FormData,r=a.map(function(t){return{name:t.file.name.replace(/[^-a-z0-9.]/gi,"_"),photographer:t.photographer,inPhoto:t.inPhoto}});return n.append("json",JSON.stringify({id:e,newMedia:r})),a.forEach(function(t){return n.append(t.file.name.replace(/[^-a-z0-9.]/gi,"_"),t.file)}),V(t,"/problems/media",{method:"POST",body:n,headers:{Accept:"application/json"}}).then(function(t){return t.json()})}(this.props.auth.getAccessToken(),this.state.id,this.state.newMedia).then(function(t){e.setState({pushUrl:"/problem/"+t.id})}).catch(function(t){console.warn(t)})},e.prototype.onCancel=function(){window.history.back()},e.prototype.render=function(){return this.state&&this.state.id?this.state.pushUrl?l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0}):(this.state.isAuthenticated||this.setState({pushUrl:"/login"}),l.a.createElement(w.Well,null,l.a.createElement("form",{onSubmit:this.save.bind(this)},l.a.createElement(w.FormGroup,{controlId:"formControlsMedia"},l.a.createElement(it,{auth:this.props.auth,onMediaChanged:this.onNewMediaChanged.bind(this)})),l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),l.a.createElement(w.Button,{type:"submit",bsStyle:"success",disabled:this.state.isSaving},this.state.isSaving?"Saving...":"Save"))))):l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}))},e}(s.Component),Yt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Zt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Yt(e,t),e.prototype.intersperse=function(t,e){return 0===t.length?[]:t.slice(1).reduce(function(t,a,n){return t.concat([e,a])},[t[0]])},e.prototype.render=function(){var t="";if(this.props.problem.comment)if(this.props.problem.comment.length>40){var e=l.a.createElement(w.Tooltip,{id:this.props.problem.id},this.props.problem.comment);t=l.a.createElement(w.OverlayTrigger,{key:this.props.problem.id,placement:"top",overlay:e},l.a.createElement("span",null,this.props.problem.comment.substring(0,40)+"..."))}else t=this.props.problem.comment;var a=this.props.problem.fa?this.props.problem.fa.map(function(t,e){return l.a.createElement(m.Link,{key:e,to:"/user/"+t.id},t.firstname," ",t.surname)}):[];a=this.intersperse(a,", ");var n,r=this.props.problem.ticked?"success":"",o=null;if(.5===this.props.problem.stars?o=l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"}):1===this.props.problem.stars?o=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})):1.5===this.props.problem.stars?o=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"})):2===this.props.problem.stars?o=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})):2.5===this.props.problem.stars?o=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"})):3===this.props.problem.stars&&(o=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}))),o&&(o=l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Popover,{id:"Guidelines",title:"Guidelines"},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Very nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Fantastic!")},o)),!this.props.isBouldering){var i,s=this.props.problem.t.subtype;switch(this.props.problem.t.id){case 2:i=l.a.createElement("img",{height:"20",src:"/jpg/bolt.jpg",alt:s});break;case 3:i=l.a.createElement("img",{height:"20",src:"/jpg/trad.jpg",alt:s});break;case 4:i=l.a.createElement("img",{height:"20",src:"/jpg/mixed.jpg",alt:s});break;case 5:i=l.a.createElement("img",{height:"20",src:"/jpg/toprope.jpg",alt:s})}n=l.a.createElement("td",null,l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Popover,{id:this.props.problem.t.id,title:"Type"},this.props.problem.t.type+" - "+this.props.problem.t.subType)},i))}return l.a.createElement("tr",{className:r},l.a.createElement("td",null,this.props.problem.nr),l.a.createElement("td",null,l.a.createElement(m.Link,{to:"/problem/"+this.props.problem.id},this.props.problem.name)," ",l.a.createElement(Q,{visibility:this.props.problem.visibility})),l.a.createElement("td",null,t),n,l.a.createElement("td",null,this.props.problem.grade),l.a.createElement("td",null,a),l.a.createElement("td",null,this.props.problem.numTicks),l.a.createElement("td",null,o),l.a.createElement("td",null,this.props.problem.numImages),l.a.createElement("td",null,this.props.problem.numMovies),l.a.createElement("td",null,(this.props.problem.lat>0&&this.props.problem.lng>0||this.props.problemsInTopo.indexOf(this.props.problem.id)>=0)&&l.a.createElement(j.FontAwesomeIcon,{icon:"check"})))},e}(s.Component),Jt=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a,tabIndex:1},n}return Yt(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.sectorId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.sectorId===this.props.match.params.sectorId||this.refresh(this.props.match.params.sectorId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.handleTabsSelection=function(t){this.setState({tabIndex:t})},e.prototype.onRemoveMedia=function(t){var e=this.state.data.media.filter(function(e){return e.id!=t});this.setState({media:e})},e.prototype.render=function(){var t=this.state.data;if(!t)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var e=[];t.media&&t.media.forEach(function(t){t.svgs&&t.svgs.forEach(function(t){return e.push(t.problemId)})});var a=t.problems.map(function(a,n){return l.a.createElement(Zt,{isBouldering:t.metadata.isBouldering,problem:a,problemsInTopo:e,key:n})}),n=t.problems.filter(function(t){return 0!=t.lat&&0!=t.lng}).map(function(t){return{lat:t.lat,lng:t.lng,title:t.nr+" - "+t.name+" ["+t.grade+"]",label:t.name.charAt(0),url:"/problem/"+t.id,icon:{url:t.ticked?"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-a.png":"https://mt.google.com/vt/icon?name=icons/spotlight/spotlight-waypoint-b.png",labelOriginX:11,labelOriginY:13}}});t.lat>0&&t.lng>0&&n.push({lat:t.lat,lng:t.lng,title:"Parking",icon:{url:"https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png",scaledSizeW:32,scaledSizeH:32},url:"/sector/"+t.id});var r=t.lat&&t.lat>0?{lat:t.lat,lng:t.lng}:t.metadata.defaultCenter,o=t.lat&&t.lat>0?15:t.metadata.defaultZoom,i=n.length>0?l.a.createElement(x,{markers:n,defaultCenter:r,defaultZoom:o}):null,s=t.media&&t.media.length>0?l.a.createElement(X,{auth:this.props.auth,isAdmin:this.state.data.metadata.isAdmin,alt:t.name+" ("+t.areaName+")",media:t.media,showThumbnails:t.media.length>1,removeMedia:this.onRemoveMedia.bind(this)}):null,c=null;i&&s?c=l.a.createElement(w.Tabs,{activeKey:this.state.tabIndex,animation:!1,onSelect:this.handleTabsSelection.bind(this),id:"sector_tab",unmountOnExit:!0},l.a.createElement(w.Tab,{eventKey:1,title:"Topo"},1==this.state.tabIndex&&s),l.a.createElement(w.Tab,{eventKey:2,title:"Map"},2==this.state.tabIndex&&i)):i?c=i:s&&(c=s);var p=t.problems.length>0?t.problems[t.problems.length-1].nr+1:1;return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,t.metadata.canonical&&l.a.createElement("link",{rel:"canonical",href:t.metadata.canonical}),l.a.createElement("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(t.metadata.jsonLd)}}),l.a.createElement("title",null,t.metadata.title),l.a.createElement("meta",{name:"description",content:t.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:t.metadata.description}),l.a.createElement("meta",{property:"og:url",content:t.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:t.metadata.title}),l.a.createElement("meta",{property:"og:image",content:t.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:t.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:t.metadata.og.imageHeight})),l.a.createElement(w.Breadcrumb,null,this.state&&this.state.data&&this.state.data.metadata.isAdmin?l.a.createElement("div",{style:{float:"right"}},l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:"Add problem"},"Add problem")},l.a.createElement(C.LinkContainer,{to:{pathname:"/problem/edit/-1",query:{idSector:t.id,nr:p,lat:t.lat,lng:t.lng}}},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"plus-square",inverse:!0})))),l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:t.id},"Edit sector")},l.a.createElement(C.LinkContainer,{to:{pathname:"/sector/edit/"+t.id,query:{idArea:t.areaId,lat:t.lat,lng:t.lng}}},l.a.createElement(w.Button,{bsStyle:"primary",bsSize:"xsmall"},l.a.createElement(j.FontAwesomeIcon,{icon:"edit",inverse:!0})))))):null,l.a.createElement(m.Link,{to:"/"},"Home")," / ",l.a.createElement(m.Link,{to:"/browse"},"Browse")," / ",l.a.createElement(m.Link,{to:"/area/"+t.areaId},t.areaName)," ",l.a.createElement(Q,{visibility:t.areaVisibility})," / ",t.name," ",l.a.createElement(Q,{visibility:t.visibility})),c,t.comment?l.a.createElement(w.Well,null,t.comment):null,l.a.createElement(w.Table,{striped:!0,condensed:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,l.a.createElement(j.FontAwesomeIcon,{icon:"hashtag"})),l.a.createElement("th",null,"Name"),l.a.createElement("th",null,"Description"),!t.metadata.isBouldering&&l.a.createElement("th",null,"Type"),l.a.createElement("th",null,"Grade"),l.a.createElement("th",null,"FA"),l.a.createElement("th",null,"Ticks"),l.a.createElement("th",null,"Stars"),l.a.createElement("th",null,l.a.createElement(j.FontAwesomeIcon,{icon:"camera"})),l.a.createElement("th",null,l.a.createElement(j.FontAwesomeIcon,{icon:"video"})),l.a.createElement("th",null,l.a.createElement(j.FontAwesomeIcon,{icon:"map-marker"})))),l.a.createElement("tbody",null,a)))},e}(s.Component),Xt=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Qt=Object(k.withScriptjs)(Object(k.withGoogleMap)(function(t){var e=null;return 0!=t.parkingMarkerLat&&0!=t.parkingMarkerLng&&(e=l.a.createElement(k.Marker,{position:{lat:t.parkingMarkerLat,lng:t.parkingMarkerLng},icon:{url:"https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png",scaledSize:new google.maps.Size(32,32)}})),l.a.createElement(k.GoogleMap,{defaultZoom:t.defaultZoom,defaultCenter:t.defaultCenter,defaultMapTypeId:google.maps.MapTypeId.TERRAIN,onClick:t.onClick.bind(void 0),onRightClick:t.onRightClick.bind(void 0)},e,t.outline)})),$t=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a},n}return Xt(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.sectorId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.sectorId===this.props.match.params.sectorId||this.refresh(this.props.match.params.sectorId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.onNameChanged=function(t){var e=this.state.data;e.name=t.target.value,this.setState({data:e})},e.prototype.onVisibilityChanged=function(t,e){var a=this.state.data;a.visibility=t,this.setState({data:a})},e.prototype.onCommentChanged=function(t){var e=this.state.data;e.comment=t.target.value,this.setState({data:e})},e.prototype.onNewMediaChanged=function(t){var e=this.state.data;e.newMedia=t,this.setState({data:e})},e.prototype.save=function(t){var e=this;t.preventDefault(),this.setState({isSaving:!0}),function(t,e,a,n,r,o,i,s,l,c){var m=new FormData,p=c.map(function(t){return{name:t.file.name.replace(/[^-a-z0-9.]/gi,"_"),photographer:t.photographer,inPhoto:t.inPhoto}});return m.append("json",JSON.stringify({areaId:e,id:a,visibility:n,name:r,comment:o,lat:i,lng:s,polygonCoords:l,newMedia:p})),c.forEach(function(t){return m.append(t.file.name.replace(/[^-a-z0-9.]/gi,"_"),t.file)}),V(t,"/sectors",{method:"POST",body:m,headers:{Accept:"application/json"}}).then(function(t){return t.json()})}(this.props.auth.getAccessToken(),this.props.location.query.idArea,this.state.data.id,this.state.data.visibility,this.state.data.name,this.state.data.comment,this.state.data.lat,this.state.data.lng,this.state.data.polygonCoords,this.state.data.newMedia).then(function(t){e.setState({pushUrl:"/sector/"+t.id})}).catch(function(t){console.warn(t),e.setState({error:t})})},e.prototype.onMapClick=function(t){var e=this.state.data;e.lat=t.latLng.lat(),e.lng=t.latLng.lng(),this.setState({data:e})},e.prototype.onMapRightClick=function(t){var e=this.state.data,a=t.latLng.lat()+","+t.latLng.lng();e.polygonCoords?e.polygonCoords=e.polygonCoords+";"+a:e.polygonCoords=a,this.setState({data:e})},e.prototype.resetMapPolygon=function(t){var e=this.state.data;e.polygonCoords=null,this.setState({data:e})},e.prototype.onCancel=function(){window.history.back()},e.prototype.render=function(){if(this.state.error)return l.a.createElement("h3",null,this.state.error.toString());if(this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});if(!(this.props&&this.props.match&&this.props.match.params&&this.props.match.params.sectorId&&this.props.location&&this.props.location.query&&this.props.location.query.idArea))return l.a.createElement("span",null,l.a.createElement("h3",null,"Invalid action..."));if(!this.state.data)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));this.state.data.metadata.isAdmin||this.setState({pushUrl:"/login",error:null});var t=this.state.data.polygonCoords?this.state.data.polygonCoords.split(";").map(function(t,e){var a=t.split(",");return{lat:parseFloat(a[0]),lng:parseFloat(a[1])}}):[],e=null;1==t.length?e=l.a.createElement(k.Marker,{position:{lat:t[0].lat,lng:t[0].lng}}):t.length>1&&(e=l.a.createElement(k.Polygon,{paths:t,options:{strokeColor:"#FF3300",strokeOpacity:.5,strokeWeight:2,fillColor:"#FF3300",fillOpacity:.15},onClick:this.onMapClick.bind(this),onRightClick:this.onMapRightClick.bind(this)}));var a="Visible for everyone";1===this.state.data.visibility?a="Only visible for administrators":2===this.state.data.visibility&&(a="Only visible for super administrators");var n=this.props&&this.props.location&&this.props.location.query&&this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?{lat:parseFloat(this.props.location.query.lat),lng:parseFloat(this.props.location.query.lng)}:this.state.data.metadata.defaultCenter,r=this.props&&this.props.location&&this.props.location.query&&this.props.location.query.lat&&parseFloat(this.props.location.query.lat)>0?14:this.state.data.metadata.defaultZoom;return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,this.state.data.metadata.title)),l.a.createElement(w.Well,null,l.a.createElement("form",{onSubmit:this.save.bind(this)},l.a.createElement(w.FormGroup,{controlId:"formControlsName"},l.a.createElement(w.ControlLabel,null,"Sector name"),l.a.createElement(w.FormControl,{type:"text",value:this.state.data.name,placeholder:"Enter name",onChange:this.onNameChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsComment"},l.a.createElement(w.ControlLabel,null,"Comment"),l.a.createElement(w.FormControl,{style:{height:"100px"},componentClass:"textarea",placeholder:"Enter comment",value:this.state.data.comment,onChange:this.onCommentChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsVisibility"},l.a.createElement(w.ControlLabel,null,"Visibility"),l.a.createElement("br",null),l.a.createElement(w.DropdownButton,{title:a,id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{eventKey:"0",onSelect:this.onVisibilityChanged.bind(this,0)},"Visible for everyone"),l.a.createElement(w.MenuItem,{eventKey:"1",onSelect:this.onVisibilityChanged.bind(this,1)},"Only visible for administrators"),this.state.data.metadata.isSuperAdmin&&l.a.createElement(w.MenuItem,{eventKey:"2",onSelect:this.onVisibilityChanged.bind(this,2)},"Only visible for super administrators"))),l.a.createElement(w.FormGroup,{controlId:"formControlsMedia"},l.a.createElement(it,{auth:this.props.auth,onMediaChanged:this.onNewMediaChanged.bind(this)})),l.a.createElement(w.FormGroup,{controlId:"formControlsMap"},l.a.createElement(w.ControlLabel,null,"Left mouse button to position parking coordinate, right mouse button to add polygon points (sector outline)"),l.a.createElement("br",null),l.a.createElement("section",{style:{height:"600px"}},l.a.createElement(Qt,{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyCpaVd5518yMB-oiIyP5JnTVWMfrOv4sAI&v=3.exp",loadingElement:l.a.createElement("div",{style:{height:"100%"}}),containerElement:l.a.createElement("div",{style:{height:"100%"}}),mapElement:l.a.createElement("div",{style:{height:"100%"}}),defaultZoom:r,defaultCenter:n,onClick:this.onMapClick.bind(this),onRightClick:this.onMapRightClick.bind(this),parkingMarkerLat:this.state.data.lat,parkingMarkerLng:this.state.data.lng,outline:e}))),l.a.createElement(w.ButtonGroup,null,l.a.createElement(w.Button,{bsStyle:"warning",onClick:this.resetMapPolygon.bind(this)},"Clear polygon"),l.a.createElement(w.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),l.a.createElement(w.Button,{type:"submit",bsStyle:"success",disabled:this.state.isSaving},this.state.isSaving?"Saving...":"Save sector")))))},e}(s.Component),te=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),ee=function(t){function e(e){var a,n=t.call(this,e)||this;return(a=e.staticContext.data)&&(n.state={mediaId:a.mediaId,nr:a.nr,w:a.w,h:a.h,ctrl:a.ctrl,svgId:a.svgId,points:a.points,readOnlySvgs:a.readOnlySvgs,activePoint:a.activePoint,draggedPoint:a.draggedPoint,draggedCubic:a.draggedCubic,hasAnchor:a.hasAnchor,areaId:a.areaId,areaName:a.areaName,areaVisibility:a.areaVisibility,sectorId:a.sectorId,sectorName:a.sectorName,sectorVisibility:a.sectorVisibility,id:a.id,name:a.name,grade:a.grade,visibility:a.visibility,metadata:a.metadata}),n}return te(e,t),e.prototype.componentDidMount=function(){this.state&&this.state.id||this.refresh(this.props.match.params.problemIdMediaId),document&&(document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)))},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.problemIdMediaId===this.props.match.params.problemIdMediaId||this.refresh(this.props.match.params.problemIdMediaId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{mediaId:t.mediaId,nr:t.nr,w:t.w,h:t.h,ctrl:t.ctrl,svgId:t.svgId,points:t.points,readOnlySvgs:t.readOnlySvgs,activePoint:t.activePoint,draggedPoint:t.draggedPoint,draggedCubic:t.draggedCubic,hasAnchor:t.hasAnchor,areaId:t.areaId,areaName:t.areaName,areaVisibility:t.areaVisibility,sectorId:t.sectorId,sectorName:t.sectorName,sectorVisibility:t.sectorVisibility,id:t.id,name:t.name,grade:t.grade,visibility:t.visibility,metadata:t.metadata}})})},e.prototype.componentWillUnmount=function(){document&&(document.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.removeEventListener("keyup",this.handleKeyUp.bind(this)))},e.prototype.handleKeyDown=function(t){t.ctrlKey&&this.setState({ctrl:!0})},e.prototype.handleKeyUp=function(t){t.ctrlKey||this.setState({ctrl:!1})},e.prototype.setHasAnchor=function(t){this.setState({hasAnchor:t})},e.prototype.onCancel=function(){window.history.back()},e.prototype.save=function(t){var e=this;t.preventDefault(),function(t,e,a,n,r,o,i){return V(t,"/problems/svg?problemId="+e+"&mediaId="+a,{method:"POST",body:JSON.stringify({delete:n,id:r,path:o,hasAnchor:i}),headers:{"Content-Type":"application/json",Accept:"application/json"}})}(this.props.auth.getAccessToken(),this.state.id,this.state.mediaId,this.state.points.length<2,this.state.svgId,this.generatePath(),this.state.hasAnchor).then(function(t){e.setState({pushUrl:"/problem/"+e.state.id})}).catch(function(t){console.warn(t),e.setState({error:t})})},e.prototype.cancelDragging=function(t){this.setState({draggedPoint:!1,draggedCubic:!1})},e.prototype.getMouseCoords=function(t){var e=this.refs["buldreinfo-svg-edit-img"].getBoundingClientRect(),a=this.state.w/e.width,n=this.state.h/e.height;return{x:Math.round((t.clientX-e.left)*a),y:Math.round((t.clientY-e.top)*n)}},e.prototype.addPoint=function(t){if(this.state.ctrl){var e=this.getMouseCoords(t),a=this.state.points;a.push(e),this.setState({points:a,activePoint:a.length-1})}},e.prototype.generatePath=function(){var t="";return this.state.points.forEach(function(e,a){0===a?t+="M ":e.q?t+="Q "+e.q.x+" "+e.q.y+" ":e.c?t+="C "+e.c[0].x+" "+e.c[0].y+" "+e.c[1].x+" "+e.c[1].y+" ":e.a?t+="A "+e.a.rx+" "+e.a.ry+" "+e.a.rot+" "+e.a.laf+" "+e.a.sf+" ":t+="L ",t+=e.x+" "+e.y+" "}),t},e.prototype.handleMouseMove=function(t){return t.preventDefault(),this.state.ctrl||(this.state.draggedPoint?this.setPointCoords(this.getMouseCoords(t)):!1!==this.state.draggedCubic&&this.setCubicCoords(this.getMouseCoords(t),this.state.draggedCubic)),!1},e.prototype.setPointCoords=function(t){var e=this.state.points,a=this.state.activePoint;e[a].x=t.x,e[a].y=t.y,this.setState({points:e})},e.prototype.setCubicCoords=function(t,e){var a=this.state.points,n=this.state.activePoint;a[n].c[e].x=t.x,a[n].c[e].y=t.y,this.setState({points:a})},e.prototype.setDraggedPoint=function(t){this.state.ctrl||this.setState({activePoint:t,draggedPoint:!0})},e.prototype.setDraggedCubic=function(t,e){this.state.ctrl||this.setState({activePoint:t,draggedCubic:e})},e.prototype.setPointType=function(t){var e=this.state.points,a=this.state.activePoint;if(0!==a){switch(t){case"L":e[a]={x:e[a].x,y:e[a].y};break;case"C":e[a]={x:e[a].x,y:e[a].y,c:[{x:(e[a].x+e[a-1].x-50)/2,y:(e[a].y+e[a-1].y)/2},{x:(e[a].x+e[a-1].x+50)/2,y:(e[a].y+e[a-1].y)/2}]}}this.setState({points:e})}},e.prototype.removeActivePoint=function(t){var e=this.state.points,a=this.state.activePoint;e.length>1&&0!==a&&(e.splice(a,1),this.setState({points:e,activePoint:e.length-1}))},e.prototype.reset=function(t){this.setState({ctrl:!1,points:[],activePoint:0,draggedPoint:!1,draggedCubic:!1,hasAnchor:!1})},e.prototype.render=function(){var t=this;if(!this.state||!this.state.id)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));if(this.state.error)return l.a.createElement("h3",null,this.state.error.toString());if(this.state.pushUrl)return l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0});this.state.metadata.isAdmin||this.setState({pushUrl:"/login",error:null});var e=this.state.points.map(function(e,a,n){var r=[];return e.c&&r.push(l.a.createElement("g",{key:r.length,className:"buldreinfo-svg-edit-opacity"},l.a.createElement("line",{className:"buldreinfo-svg-pointer buldreinfo-svg-route",x1:n[a-1].x,y1:n[a-1].y,x2:e.c[0].x,y2:e.c[0].y,strokeWidth:.0026*t.state.w,strokeDasharray:.003*t.state.w}),l.a.createElement("line",{className:"buldreinfo-svg-pointer buldreinfo-svg-route",x1:e.x,y1:e.y,x2:e.c[1].x,y2:e.c[1].y,strokeWidth:.0026*t.state.w,strokeDasharray:.003*t.state.w}),l.a.createElement("circle",{className:"buldreinfo-svg-pointer buldreinfo-svg-ring",cx:e.c[0].x,cy:e.c[0].y,r:.003*t.state.w,onMouseDown:t.setDraggedCubic.bind(t,a,0)}),l.a.createElement("circle",{className:"buldreinfo-svg-pointer buldreinfo-svg-ring",cx:e.c[1].x,cy:e.c[1].y,r:.003*t.state.w,onMouseDown:t.setDraggedCubic.bind(t,a,1)}))),l.a.createElement("g",{key:a,className:"buldreinfo-svg-ring-group"+(t.state.activePoint===a?"  is-active":"")},r,l.a.createElement("circle",{className:"buldreinfo-svg-pointer buldreinfo-svg-ring",cx:e.x,cy:e.y,r:.003*t.state.w,onMouseDown:t.setDraggedPoint.bind(t,a)}))}),a=this.generatePath();return l.a.createElement(l.a.Fragment,null,l.a.createElement(w.Breadcrumb,null,l.a.createElement(m.Link,{to:"/"},"Home")," / ",l.a.createElement(m.Link,{to:"/browse"},"Browse")," / ",l.a.createElement(m.Link,{to:"/area/"+this.state.areaId},this.state.areaName)," ",l.a.createElement(Q,{visibility:this.state.areaVisibility})," / ",l.a.createElement(m.Link,{to:"/sector/"+this.state.sectorId},this.state.sectorName)," ",l.a.createElement(Q,{visibility:this.state.sectorVisibility})," / ",l.a.createElement(m.Link,{to:"/problem/"+this.state.id},this.state.nr," ",this.state.name," ",this.state.grade)," ",l.a.createElement(Q,{visibility:this.state.visibility})),l.a.createElement(w.Well,{bsSize:"small",onMouseUp:this.cancelDragging.bind(this),onMouseLeave:this.cancelDragging.bind(this)},l.a.createElement("form",{onSubmit:this.save.bind(this)},l.a.createElement(w.FormGroup,{controlId:"formControlsInfo"},l.a.createElement(w.Alert,{bsStyle:"info"},l.a.createElement("center",null,l.a.createElement("strong",null,"CTRL + CLICK")," to add a point | ",l.a.createElement("strong",null,"CLICK")," to select a point | ",l.a.createElement("strong",null,"CLICK AND DRAG")," to move a point",l.a.createElement("br",null),l.a.createElement(w.ButtonGroup,null,0!==this.state.activePoint&&l.a.createElement(w.DropdownButton,{title:this.state.points[this.state.activePoint].c?"Selected point: Curve to":"Selected point: Line to",id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{eventKey:"0",onSelect:this.setPointType.bind(this,"L")},"Selected point: Line to"),l.a.createElement(w.MenuItem,{eventKey:"1",onSelect:this.setPointType.bind(this,"C")},"Selected point: Curve to")),0!==this.state.activePoint&&l.a.createElement(w.Button,{onClick:this.removeActivePoint.bind(this)},"Remove this point"),l.a.createElement(w.DropdownButton,{title:!0===this.state.hasAnchor?"Route has anchor":"No anchor on route",disabled:0===this.state.points.length,id:"bg-nested-dropdown"},l.a.createElement(w.MenuItem,{eventKey:"0",onSelect:this.setHasAnchor.bind(this,!1)},"No anchor on route"),l.a.createElement(w.MenuItem,{eventKey:"1",onSelect:this.setHasAnchor.bind(this,!0)},"Route has anchor")),l.a.createElement(w.Button,{bsStyle:"warning",disabled:0===this.state.points.length,onClick:this.reset.bind(this)},"Reset path"),l.a.createElement(w.Button,{bsStyle:"danger",onClick:this.onCancel.bind(this)},"Cancel"),l.a.createElement(w.Button,{type:"submit",bsStyle:"success"},this.state.points.length>=2?"Save":"Delete path"))))),l.a.createElement(w.FormGroup,{controlId:"formControlsImage"},l.a.createElement("svg",{viewBox:"0 0 "+this.state.w+" "+this.state.h,onClick:this.addPoint.bind(this),onMouseMove:this.handleMouseMove.bind(this)},l.a.createElement("image",{ref:"buldreinfo-svg-edit-img",xlinkHref:H(this.state.mediaId,null),width:"100%",height:"100%"}),function(t,e,a){for(var n=[],r=0,o=t;r<o.length;r++){var i=o[r];n.push(l.a.createElement("path",{key:n.length,d:i.path,className:"buldreinfo-svg-opacity buldreinfo-svg-route",strokeWidth:.003*e,strokeDasharray:.006*e}));var s=Object(P.parseSVG)(i.path);Object(P.makeAbsolute)(s),n.push(G(s,i.nr,i.hasAnchor,e,a))}return n}(this.state.readOnlySvgs,this.state.w,this.state.h),l.a.createElement("path",{className:"buldreinfo-svg-route",d:a,strokeWidth:.002*this.state.w}),e)),l.a.createElement(w.FormGroup,{controlId:"formControlsPath"},a))))},e}(s.Component),ae=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),ne=function(t){function e(e){return t.call(this,e)||this}return ae(e,t),e.prototype.render=function(){var t=[];this.props.data.map(function(e){var a=t.filter(function(t){return t.gradeNumber===e.gradeNumber});a[0]?e.fa?a[0].fa++:a[0].tick++:t.push({gradeNumber:e.gradeNumber,grade:e.grade,fa:e.fa?1:0,tick:e.fa?0:1})}),t.sort(function(t,e){return e.gradeNumber-t.gradeNumber});var e=Math.max.apply(Math,t.map(function(t){return t.fa+t.tick})),a=t.map(function(t,a){var n=t.fa/e*100+"%",r=t.tick/e*100+"%";return l.a.createElement("tr",{key:a},l.a.createElement("td",{style:{padding:0,textAlign:"center"}},t.grade),l.a.createElement("td",{style:{padding:0,textAlign:"center"}},t.fa),l.a.createElement("td",{style:{padding:0,textAlign:"center"}},t.tick),l.a.createElement("td",{style:{padding:0,textAlign:"center"}},l.a.createElement("strong",null,t.fa+t.tick)),l.a.createElement("td",{style:{width:"100%",verticalAlign:"middle"}},l.a.createElement("div",{style:{width:n,height:"10px",backgroundColor:"#3182bd",float:"left"}}),l.a.createElement("div",{style:{width:r,height:"10px",backgroundColor:"#6baed6",marginLeft:n}})))});return l.a.createElement(w.Table,{responsive:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Grade"),l.a.createElement("th",null,"FA"),l.a.createElement("th",null,"Tick"),l.a.createElement("th",null,"Total"),l.a.createElement("th",null))),l.a.createElement("tbody",null,a))},e}(s.Component),re=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),oe=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.data,n.state={data:a,showTickModal:!1},n}return re(e,t),e.prototype.componentDidMount=function(){this.state.data||this.refresh(this.props.match.params.userId)},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated===t.isAuthenticated&&t.match.params.userId===this.props.match.params.userId||this.refresh(this.props.match.params.userId)},e.prototype.refresh=function(t){var e=this;this.props.fetchInitialData(this.props.auth.getAccessToken(),t).then(function(t){return e.setState(function(){return{data:t}})})},e.prototype.closeTickModal=function(t){this.setState({showTickModal:!1}),this.refresh(this.props.match.params.userId)},e.prototype.openTickModal=function(t,e){this.setState({currTick:t,showTickModal:!0})},e.prototype.formatName=function(t,e){return l.a.createElement("span",null,l.a.createElement(m.Link,{to:"/problem/"+e.idProblem},e.name)," ",l.a.createElement(Q,{visibility:e.visibility}))},e.prototype.formatComment=function(t,e){if(e.comment){if(e.comment.length>40){var a=l.a.createElement(w.Tooltip,{id:e.idProblem},e.comment);return l.a.createElement(w.OverlayTrigger,{key:e.idProblem,placement:"top",overlay:a},l.a.createElement("span",null,e.comment.substring(0,40)+"..."))}return e.comment}return""},e.prototype.formatStars=function(t,e){var a=null;if(.5===e.stars)a=l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"});else if(1===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}));else if(1.5===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"}));else if(2===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}));else if(2.5===e.stars)a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star-half"}));else{if(3!==e.stars)return"";a=l.a.createElement("div",{style:{whiteSpace:"nowrap"}},l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}))}return l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Popover,{id:"Guidelines",title:"Guidelines"},l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Very nice",l.a.createElement("br",null),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"}),l.a.createElement(j.FontAwesomeIcon,{icon:"star"})," Fantastic!")},a)},e.prototype.formatFa=function(t,e){return t?l.a.createElement(j.FontAwesomeIcon,{icon:"check"}):""},e.prototype.formatEdit=function(t,e){return 0==this.state.data.readOnly&&0!=e.id?l.a.createElement(w.OverlayTrigger,{placement:"top",overlay:l.a.createElement(w.Tooltip,{id:e.id},"Edit tick")},l.a.createElement(w.Button,{bsSize:"xsmall",bsStyle:"primary",onClick:this.openTickModal.bind(this,e)},l.a.createElement(j.FontAwesomeIcon,{icon:"edit",inverse:!0}))):""},e.prototype.sortDate=function(t,e,a){var n=t.date?(parseInt(t.date.substring(0,2))<50?"20":"19")+t.date:"",r=e.date?(parseInt(e.date.substring(0,2))<50?"20":"19")+e.date:"";return"asc"===a?n.localeCompare(r):r.localeCompare(n)},e.prototype.sortGrade=function(t,e,a){var n=t.gradeNumber?t.gradeNumber:0,r=e.gradeNumber?e.gradeNumber:0;return"asc"===a?n<r?-1:n>r?1:0:r<n?-1:r>n?1:0},e.prototype.sortComment=function(t,e,a){var n=t.comment?t.comment:"",r=e.comment?e.comment:"";return"asc"===a?n.localeCompare(r):r.localeCompare(n)},e.prototype.render=function(){var t=this.state.data;if(!t)return l.a.createElement("center",null,l.a.createElement(j.FontAwesomeIcon,{icon:"spinner",spin:!0,size:"3x"}));var e=t.ticks.filter(function(t){return!t.fa}).length,a=t.ticks.filter(function(t){return t.fa}).length,n=t.ticks.length>0?l.a.createElement(ne,{data:t.ticks}):null;return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,t.metadata.title),l.a.createElement("meta",{name:"description",content:t.metadata.description}),l.a.createElement("meta",{property:"og:type",content:"website"}),l.a.createElement("meta",{property:"og:description",content:t.metadata.description}),l.a.createElement("meta",{property:"og:url",content:t.metadata.og.url}),l.a.createElement("meta",{property:"og:title",content:t.metadata.title}),l.a.createElement("meta",{property:"og:image",content:t.metadata.og.image}),l.a.createElement("meta",{property:"og:image:width",content:t.metadata.og.imageWidth}),l.a.createElement("meta",{property:"og:image:height",content:t.metadata.og.imageHeight})),this.state.currTick?l.a.createElement(Ot,{auth:this.props.auth,idTick:this.state.currTick.id,idProblem:this.state.currTick.idProblem,date:this.state.currTick.date,comment:this.state.currTick.comment,grade:this.state.currTick.grade,grades:t.metadata.grades,stars:this.state.currTick.stars,show:this.state.showTickModal,onHide:this.closeTickModal.bind(this)}):"",l.a.createElement(w.Breadcrumb,null,l.a.createElement(m.Link,{to:"/"},"Home")," / ",t.name),l.a.createElement(w.Well,{bsSize:"small"},"First ascents: ",a,l.a.createElement("br",null),"Public ascents: ",e,l.a.createElement("br",null),"Pictures taken: ",t.numImagesCreated,l.a.createElement("br",null),"Appearance in pictures: ",t.numImageTags,l.a.createElement("br",null),"Videos created: ",t.numVideosCreated,l.a.createElement("br",null),"Appearance in videos: ",t.numVideoTags),n,l.a.createElement(gt.BootstrapTable,{data:t.ticks,condensed:!0,hover:!0,columnFilter:!1},l.a.createElement(gt.TableHeaderColumn,{dataField:"idProblem",isKey:!0,hidden:!0},"idProblem"),l.a.createElement(gt.TableHeaderColumn,{dataField:"dateHr",dataSort:!0,sortFunc:this.sortDate.bind(this),dataAlign:"center",width:"70"},"Date"),l.a.createElement(gt.TableHeaderColumn,{dataField:"name",dataSort:!0,dataFormat:this.formatName.bind(this),width:"300"},"Name"),l.a.createElement(gt.TableHeaderColumn,{dataField:"grade",dataSort:!0,sortFunc:this.sortGrade.bind(this),dataAlign:"center",width:"70"},"Grade"),l.a.createElement(gt.TableHeaderColumn,{dataField:"comment",dataSort:!0,sortFunc:this.sortComment.bind(this),dataFormat:this.formatComment.bind(this),width:"300"},"Comment"),l.a.createElement(gt.TableHeaderColumn,{dataField:"stars",dataSort:!0,dataFormat:this.formatStars.bind(this),dataAlign:"center",width:"70"},"Stars"),l.a.createElement(gt.TableHeaderColumn,{dataField:"fa",dataSort:!0,dataFormat:this.formatFa.bind(this),dataAlign:"center",width:"50"},"FA"),l.a.createElement(gt.TableHeaderColumn,{dataField:"edit",dataFormat:this.formatEdit.bind(this),dataAlign:"center",width:"30"}," ")))},e}(s.Component),ie=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),se=[{path:"/",exact:!0,component:At,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t){return V(t,"/frontpage",null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}(t)}},{path:"/browse",exact:!1,component:pt,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t){return V(t,"/browse",null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}(t)}},{path:"/callback",exact:!1,component:dt},{path:"/ethics",exact:!1,component:ft,fetchInitialData:function(t,e){return void 0===e&&(e=""),K(t)}},{path:"/area/:areaId",exact:!0,component:et,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){return V(t,"/areas?id="+e,null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}(t,parseInt(e.split("/").pop()))}},{path:"/area/edit/:areaId",exact:!0,component:ct,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){return-1==e?K(t).then(function(t){return{id:-1,visibility:0,name:"",comment:"",lat:0,lng:0,newMedia:[],metadata:{title:"New area | "+t.metadata.title,defaultZoom:t.metadata.defaultZoom,defaultCenter:t.metadata.defaultCenter,isAdmin:t.metadata.isAdmin,isSuperAdmin:t.metadata.isSuperAdmin}}}).catch(function(t){return console.warn(t),null}):V(t,"/areas?id="+e,null).then(function(t){return t.json()}).then(function(t){return{id:t.id,visibility:t.visibility,name:t.name,comment:t.comment,lat:t.lat,lng:t.lng,newMedia:[],metadata:t.metadata}}).catch(function(t){return console.warn(t),null})}(t,parseInt(e.split("/").pop()))}},{path:"/sector/:sectorId",exact:!0,component:Jt,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){return V(t,"/sectors?id="+e,null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}(t,parseInt(e.split("/").pop()))}},{path:"/sector/edit/:sectorId",exact:!0,component:$t,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){return-1===e?K(t).then(function(t){return{id:-1,visibility:0,name:"",comment:"",lat:0,lng:0,newMedia:[],metadata:{title:"New sector | "+t.metadata.title,defaultZoom:t.metadata.defaultZoom,defaultCenter:t.metadata.defaultCenter,isAdmin:t.metadata.isAdmin,isSuperAdmin:t.metadata.isSuperAdmin}}}).catch(function(t){return console.warn(t),null}):V(t,"/sectors?id="+e,null).then(function(t){return t.json()}).then(function(t){return{id:t.id,visibility:t.visibility,name:t.name,comment:t.comment,lat:t.lat,lng:t.lng,polygonCoords:t.polygonCoords,newMedia:[],metadata:t.metadata}}).catch(function(t){return console.warn(t),null})}(t,parseInt(e.split("/").pop()))}},{path:"/problem/:problemId",exact:!0,component:jt,fetchInitialData:function(t,e){return void 0===e&&(e=""),z(t,parseInt(e.split("/").pop()))}},{path:"/problem/edit/:problemId",exact:!0,component:Kt,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){return-1===e?K(t).then(function(t){return{id:-1,visibility:0,name:"",comment:"",originalGrade:"n/a",fa:[],faDate:q(new Date),nr:0,lat:0,lng:0,newMedia:[],metadata:{title:"New problem | "+t.metadata.title,defaultZoom:t.metadata.defaultZoom,defaultCenter:t.metadata.defaultCenter,grades:t.metadata.grades,types:t.metadata.types,isAdmin:t.metadata.isAdmin,isSuperAdmin:t.metadata.isSuperAdmin,isBouldering:t.metadata.isBouldering}}}).catch(function(t){return console.warn(t),null}):V(t,"/problems?id="+e,null).then(function(t){return t.json()}).then(function(t){return t[0]}).then(function(t){return{id:t.id,visibility:t.visibility,name:t.name,comment:t.comment,originalGrade:t.originalGrade,fa:t.fa,faDate:t.faDate,nr:t.nr,typeId:t.t.id,lat:t.lat,lng:t.lng,sections:t.sections,metadata:t.metadata,newMedia:[]}}).catch(function(t){return console.warn(t),null})}(t,parseInt(e.split("/").pop()))}},{path:"/problem/edit/media/:problemId",exact:!0,component:Wt},{path:"/problem/svg-edit/:problemIdMediaId",exact:!0,component:ee,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){var a=e.split("-"),n=a[0],r=a[1];return V(t,"/problems?id="+n,null).then(function(t){return t.json()}).then(function(t){return t[0]}).then(function(t){var e=t.media.filter(function(t){return t.id==r})[0],a=[],n=0,o=[];if(e.svgs)for(var i=0,s=e.svgs;i<s.length;i++){var l=s[i];l.problemId===t.id?(n=l.id,o=R(l.path)):a.push({nr:l.nr,hasAnchor:l.hasAnchor,path:l.path})}return{mediaId:e.id,nr:t.nr,w:e.width,h:e.height,ctrl:!1,svgId:n,points:o,readOnlySvgs:a,activePoint:0,draggedPoint:!1,draggedCubic:!1,hasAnchor:!0,areaId:t.areaId,areaName:t.areaName,areaVisibility:t.areaVisibility,sectorId:t.sectorId,sectorName:t.sectorName,sectorVisibility:t.sectorVisibility,id:t.id,name:t.name,grade:t.grade,visibility:t.visibility,metadata:t.metadata}}).catch(function(t){return console.warn(t),null})}(t,e.split("/").pop())}},{path:"/finder/:grade",exact:!0,component:bt,fetchInitialData:function(t,e){return void 0===e&&(e=""),function(t,e){return V(t,"/finder?grade="+e,null).then(function(t){return t.json()}).catch(function(t){return console.warn(t),null})}(t,e.split("/").pop())}},{path:"/user",exact:!0,component:oe,fetchInitialData:function(t,e){return void 0===e&&(e=""),W(t,e.split("/").pop())}},{path:"/user/:userId",exact:!0,component:oe,fetchInitialData:function(t,e){return void 0===e&&(e=""),W(t,e.split("/").pop())}},{path:"/logout",exact:!1,component:xt},{path:"*",status:404,component:function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ie(e,t),e.prototype.render=function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,null,l.a.createElement("title",null,"Page not found")),l.a.createElement(w.Well,null,l.a.createElement("h1",null,"404"),"Page not found"))},e}(s.Component)}],le=a(29),ce=a.n(le),me=a(30),pe=a(16),ue=a.n(pe),de=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),he=function(){return(he=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},fe=function(t){var e,a="#4caf50";return"A"===t.value.avatar?a="#ff5722":"S"===t.value.avatar&&(a="#673ab7"),e="U"===t.value.avatar?l.a.createElement(ue.a,{name:t.label,size:"25",round:!0,textSizeRatio:2.25,style:{marginRight:"10px"}}):l.a.createElement(ue.a,{value:t.value.avatar,size:"25",color:a,round:!0,textSizeRatio:2.25,style:{marginRight:"10px"}}),l.a.createElement(me.components.Option,he({},t),l.a.createElement("div",null,e,t.label," ",l.a.createElement(Q,{visibility:t.value.visibility})))},ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return de(e,t),e.prototype.componentDidUpdate=function(t){this.state&&this.state.pushUrl&&this.setState({pushUrl:null})},e.prototype.search=function(t,e){t?function(t,e){return V(t,"/search",{method:"POST",body:JSON.stringify({value:e}),headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(t){return t.json()})}(this.props.auth.getAccessToken(),t).then(function(t){var a=t.map(function(t){return{value:t,label:t.value}});e(a)}):e(null)},e.prototype.onChange=function(t){t&&t.value&&t.value.url&&this.setState({pushUrl:t.value.url})},e.prototype.render=function(){return this.state&&this.state.pushUrl?l.a.createElement(S.Redirect,{to:this.state.pushUrl,push:!0}):l.a.createElement(ce.a,{instanceId:"buldreinfo-navigation-search",placeholder:"Search",loadOptions:this.search.bind(this),filterOptions:function(t,e,a){return t},ignoreAccents:!1,onChange:this.onChange.bind(this),components:{Option:fe}})},e}(s.Component),ye=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),be=function(t){function e(e){var a,n=t.call(this,e)||this;return a=e.staticContext.metadata,n.state={metadata:a,logo:"/png/buldreinfo_logo_gray.png"},n}return ye(e,t),e.prototype.componentDidMount=function(){this.state.metadata||this.refresh()},e.prototype.componentDidUpdate=function(t){this.props.isAuthenticated!==t.isAuthenticated&&this.refresh()},e.prototype.refresh=function(){var t=this;K(this.props.auth.getAccessToken()).then(function(e){return t.setState(function(){return{metadata:e.metadata}})})},e.prototype.hoverImage=function(t){var e=t?"/png/buldreinfo_logo_white.png":"/png/buldreinfo_logo_gray.png";this.setState({logo:e})},e.prototype.login=function(){localStorage.setItem("redirect",this.props.location.pathname),this.props.auth.login()},e.prototype.render=function(){return l.a.createElement(w.Navbar,{inverse:!0},l.a.createElement(w.Navbar.Header,null,l.a.createElement(w.Navbar.Brand,null,l.a.createElement(C.LinkContainer,{to:"/"},l.a.createElement("a",{href:"/",onMouseOver:this.hoverImage.bind(this,!0),onMouseOut:this.hoverImage.bind(this,!1)},l.a.createElement("img",{src:this.state.logo,alt:"Logo"})))),l.a.createElement(w.Navbar.Toggle,null)),l.a.createElement(w.Navbar.Collapse,null,l.a.createElement(w.Nav,null,l.a.createElement(C.LinkContainer,{to:"/browse"},l.a.createElement(w.NavItem,{eventKey:1},"Browse")),l.a.createElement(w.NavDropdown,{eventKey:2,title:"Finder",id:"basic-nav-dropdown"},this.state.metadata&&this.state.metadata.isSuperAdmin&&l.a.createElement(C.LinkContainer,{to:"/finder/-1"},l.a.createElement(w.MenuItem,{eventKey:2},"Grade: ",l.a.createElement("strong",null,"superadmin"))),this.state.metadata&&this.state.metadata.grades&&this.state.metadata.grades.map(function(t,e){return l.a.createElement(C.LinkContainer,{key:"2."+e,to:"/finder/"+t.id},l.a.createElement(w.MenuItem,{eventKey:"3."+e},"Grade: ",l.a.createElement("strong",null,t.grade)))}))),l.a.createElement(w.Navbar.Form,{pullLeft:!0},l.a.createElement(w.FormGroup,{style:{width:"350px"}},l.a.createElement(ge,{auth:this.props.auth}))),l.a.createElement(w.Nav,{pullRight:!0},this.props.isAuthenticated?l.a.createElement(w.NavDropdown,{eventKey:4,title:"Logged in",id:"basic-nav-dropdown"},l.a.createElement(C.LinkContainer,{to:"/user"},l.a.createElement(w.MenuItem,{eventKey:4.1},"My profile")),l.a.createElement(w.MenuItem,{divider:!0}),l.a.createElement(C.LinkContainer,{to:"/logout"},l.a.createElement(w.MenuItem,{eventKey:4.2},"Log out"))):l.a.createElement(w.NavItem,{eventKey:5,onClick:this.login.bind(this)},"Sign in"),l.a.createElement(w.NavDropdown,{eventKey:6,title:"More",id:"basic-nav-dropdown"},l.a.createElement(C.LinkContainer,{to:"/ethics"},l.a.createElement(w.NavItem,{eventKey:6},"Ethics")),l.a.createElement(w.MenuItem,{divider:!0}),l.a.createElement(w.MenuItem,{eventKey:6.1,href:"mailto:jostein.oygarden@gmail.com"},"Contact"),l.a.createElement(w.MenuItem,{eventKey:6.2,href:"/gpl-3.0.txt",rel:"noopener",target:"_blank"},"GNU Public License"),l.a.createElement(w.MenuItem,{divider:!0}),l.a.createElement(w.MenuItem,{eventKey:6.3,href:"https://buldreinfo.com",rel:"noopener",target:"_blank"},"buldreinfo.com"),l.a.createElement(w.MenuItem,{eventKey:6.4,href:"https://buldring.bergen-klatreklubb.no",rel:"noopener",target:"_blank"},"buldring.bergen-klatreklubb.no"),l.a.createElement(w.MenuItem,{eventKey:6.5,href:"https://buldring.fredrikstadklatreklubb.org",rel:"noopener",target:"_blank"},"buldring.fredrikstadklatreklubb.org"),l.a.createElement(w.MenuItem,{eventKey:6.6,href:"https://buldring.jotunheimenfjellsport.com",rel:"noopener",target:"_blank"},"buldring.jotunheimenfjellsport.com"),l.a.createElement(w.MenuItem,{divider:!0}),l.a.createElement(w.MenuItem,{eventKey:6.7,href:"https://brattelinjer.no",rel:"noopener",target:"_blank"},"brattelinjer.no"),l.a.createElement(w.MenuItem,{eventKey:6.7,href:"https://klatring.jotunheimenfjellsport.com",rel:"noopener",target:"_blank"},"klatring.jotunheimenfjellsport.com")))))},e}(s.Component),Ee=(a(33),a(31)),ve=a.n(Ee),we=function(){function t(t){this.auth0=new ve.a.WebAuth({domain:"climbing.eu.auth0.com",clientID:"DNJNVzhxbF7PtaBFh7H6iBSNLh2UJWHt",redirectUri:global.myOrigin+"/callback",responseType:"token id_token",scope:"openid email profile"}),this.cookies=t,this.login=this.login.bind(this),this.logout=this.logout.bind(this),this.handleAuthentication=this.handleAuthentication.bind(this),this.isAuthenticated=this.isAuthenticated.bind(this),this.getAccessToken=this.getAccessToken.bind(this),this.silentAuthentication=this.silentAuthentication.bind(this),this.scheduleRenewal()}return t.prototype.login=function(){this.auth0.authorize()},t.prototype.handleAuthentication=function(){var t=this;this.auth0.parseHash(function(e,a){a&&a.accessToken&&a.idToken?t.setCookies(a):e&&(console.log(e),alert("Error: "+e.error+". Check the console for further details."))})},t.prototype.setCookies=function(t){var e=JSON.stringify(1e3*t.expiresIn+(new Date).getTime()),a={path:"/",expires:new Date((new Date).getTime()+6048e5)};this.cookies.set("access_token",t.accessToken,a),this.cookies.set("id_token",t.idToken,a),this.cookies.set("expires_at",e,a),this.scheduleRenewal()},t.prototype.getAccessToken=function(){var t=this.cookies.get("access_token");return t||null},t.prototype.logout=function(){this.cookies.remove("access_token"),this.cookies.remove("id_token"),this.cookies.remove("expires_at"),clearTimeout(this.tokenRenewalTimeout)},t.prototype.isAuthenticated=function(){var t=this.cookies.get("expires_at");if(!t)return!1;var e=JSON.parse(t);return(new Date).getTime()<e},t.prototype.renewToken=function(){var t=this;this.auth0.checkSession({},function(e,a){e?(console.log("Could not get a new token ("+e.error+": "+e.error_description+")."),t.logout()):t.setCookies(a)})},t.prototype.scheduleRenewal=function(){var t=this,e=this.cookies.get("expires_at");if(e){var a=JSON.parse(e)-Date.now();a>0&&(this.tokenRenewalTimeout=setTimeout(function(){t.renewToken()},a))}},t.prototype.silentAuthentication=function(){this.cookies.get("expires_at")&&!this.isAuthenticated()&&this.renewToken()},t}(),Ce=a(9),Se=a(10);function ke(t){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ie(){return(Ie=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t}).apply(this,arguments)}function Ae(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}function Fe(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xe(t){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Me(t,e){return(Me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Te(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Oe(t){return null}Ce.library.add(Se.faCamera),Ce.library.add(Se.faCheck),Ce.library.add(Se.faComment),Ce.library.add(Se.faEdit),Ce.library.add(Se.faHashtag),Ce.library.add(Se.faImage),Ce.library.add(Se.faLock),Ce.library.add(Se.faMapMarker),Ce.library.add(Se.faPlane),Ce.library.add(Se.faPlusSquare),Ce.library.add(Se.faSpinner),Ce.library.add(Se.faStar),Ce.library.add(Se.faStarHalf),Ce.library.add(Se.faTrash),Ce.library.add(Se.faUserSecret),Ce.library.add(Se.faVideo);var Pe=function(t){function e(t){var a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Te(_e(_e(a=function(t,e){return!e||"object"!==ke(e)&&"function"!=typeof e?_e(t):e}(this,xe(e).call(this,t)))),"auth",void 0);var n=t.cookies;return a.auth=new we(n),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Me(t,e)}(e,s["Component"]),function(t,e,a){e&&Fe(t.prototype,e),a&&Fe(t,a)}(e,[{key:"componentDidMount",value:function(){var t=E.a.findDOMNode(this).querySelector("nav.navbar"),e=t.querySelector("div.navbar-collapse"),a=t.querySelector("button.navbar-toggle");t.addEventListener("click",function(t){"A"===t.target.tagName&&!t.target.classList.contains("dropdown-toggle")&&e.classList.contains("in")&&a.click()},!1),this.auth.silentAuthentication()}},{key:"render",value:function(){var t=this,e=this.auth.isAuthenticated();return l.a.createElement(m.Switch,null,se.map(function(a){var n=a.path,r=a.exact,o=a.component,i=Ae(a,["path","exact","component"]);return l.a.createElement(m.Route,{key:n,path:n,exact:r,render:function(a){return l.a.createElement("div",null,l.a.createElement(Oe,a),l.a.createElement(be,Ie({isAuthenticated:e,auth:t.auth},a)),l.a.createElement("div",{className:"container"},l.a.createElement(o,Ie({isAuthenticated:e,auth:t.auth},a,i))),l.a.createElement("footer",{style:{paddingTop:"10px",marginTop:"40px",color:"#777",textAlign:"center",borderTop:"1px solid #e5e5e5"}},"Buldreinfo & Bratte Linjer © 2006-2018"))}})}))}}]),e}();Te(Pe,"propTypes",{cookies:Object(v.instanceOf)(d.Cookies).isRequired});var Le=Object(d.withCookies)(Pe),Ne=r()(),je=a(34);Ne.use(i()()),Ne.use(je()),Ne.use(r.a.static("build")),Ne.get("*",function(t,e,a){var n=f()();global.myOrigin="localhost:3000"===t.headers.host?"http://localhost:3000":"https://"+t.headers.host;var r=se.find(function(e){return Object(m.matchPath)(t.url,e)})||{},o=t.universalCookies.get("access_token");(r.fetchInitialData?r.fetchInitialData(o,t.path):Promise.resolve()).then(function(a){var o={data:a},i=Object(c.renderToString)(l.a.createElement(d.CookiesProvider,{cookies:t.universalCookies},l.a.createElement(g.MetaTagsContext,{extract:n.extract},l.a.createElement(m.StaticRouter,{location:t.url,context:o},l.a.createElement(Le,null))))),s=n.renderToString(),p='\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset="utf-8">\n          '.concat(s,'\n          <meta name="viewport" content="width=device-width, initial-scale=1">\n          <link rel="icon" href="/favicon.ico">\n          <meta name="author" content="Jostein Øygarden">\n          <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">\n          <link rel="stylesheet" type="text/css" href="/css/image-gallery.css">\n          <link rel="stylesheet" type="text/css" href="/css/buldreinfo.css">\n          <script async src="/js/bundle.js" defer><\/script>\n          <script>window.__INITIAL_METADATA__ = ').concat(u()(a?a.metadata:null),"<\/script>\n          <script>window.__INITIAL_DATA__ = ").concat(u()(a),'<\/script>\n        </head>\n\n        <body>\n          <div id="app">').concat(i,"</div>\n        </body>\n      </html>\n    ");r.status?e.status(r.status).send(p):e.send(p)}).catch(function(t){return console.warn(t)})}),Ne.listen(3e3,function(){console.log("Server is listening on port: 3000")})}]);